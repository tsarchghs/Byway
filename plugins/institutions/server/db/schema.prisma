generator client {
engineType = "node-api"
  provider = "prisma-client-js"
  output   = "./generated"
}

datasource db {
  provider = "sqlite"
  url      = "file:./institutions.db"
}

//
// --- Added by Byway GQL8 Patch (institutions) ---
model Institution {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  type        String?
  location    String?
  email       String?
  phone       String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  classrooms  Classroom[]
  departments Department[]
  members     InstitutionMember[]
  invites     InstitutionInvite[]
}

model Classroom {
  id            String      @id @default(cuid())
  institutionId String
  departmentId  String?
  teacherId     String?
  title         String
  code          String      @unique
  capacity      Int?
  status        String?     // e.g. ACTIVE, INACTIVE, ARCHIVED
  startsAt      DateTime?
  endsAt       DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  institution   Institution @relation(fields: [institutionId], references: [id])
  department    Department? @relation(fields: [departmentId], references: [id])
  enrollments   ClassroomEnrollment[]
}

model Department {
  id            String        @id @default(cuid())
  institutionId String
  name          String
  slug          String
  contact       String?
  head          String?
  active        Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  institution   Institution   @relation(fields: [institutionId], references: [id])
  classrooms    Classroom[]

  @@unique([institutionId, slug])
}

model InstitutionMember {
  id            String   @id @default(cuid())
  institutionId String
  userId        String
  role          String   // admin | teacher | student
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  institution   Institution @relation(fields: [institutionId], references: [id])

  @@unique([institutionId, userId])
}

model ClassroomEnrollment {
  id           String    @id @default(cuid())
  classroomId  String
  studentId    String
  status       String    @default("ENROLLED") // ENROLLED | INVITED | DROPPED
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  classroom    Classroom @relation(fields: [classroomId], references: [id])

  @@unique([classroomId, studentId])
}

model InstitutionInvite {
  id            String    @id @default(cuid())
  institutionId String
  code          String    @unique
  role          String    @default("student")
  expiresAt     DateTime?
  createdAt     DateTime  @default(now())

  institution   Institution @relation(fields: [institutionId], references: [id])
}
