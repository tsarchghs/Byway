generator client {
  provider = "prisma-client-js"
  output   = "./generated"
}

datasource db {
  provider = "sqlite"
  url      = "file:./students.db"
}

model Student {
  id           String         @id @default(cuid())
  userId       String?
  displayName  String?
  email        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  enrollments  StudentCourse[]
  grades       Grade[]
}

model CourseMirror {
  id        String   @id
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model StudentCourse {
  id           String    @id @default(cuid())
  studentId    String
  courseId     String
  progressPct  Int       @default(0)
  lastActivity DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  student    Student  @relation(fields: [studentId], references: [id])

  @@unique([studentId, courseId])
}

model Grade {
  id           String   @id @default(cuid())
  studentId    String
  courseId     String
  assignmentId String
  grade        Float
  updatedAt    DateTime @updatedAt

  student  Student @relation(fields: [studentId], references: [id])

  @@unique([studentId, assignmentId])
}

model Rubric {
  id       String @id @default(cuid())
  courseId String @unique
  json     Json
  updatedAt DateTime @updatedAt
}

model Enrollment {
  id        String   @id @default(cuid())
  studentId String
  courseId  String
  progress  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserRole {
  id     String @id @default(cuid())
  userId String @unique
  role   String
}


//
// --- Added by Byway GQL8 Patch ---
model Enrollment {
  id        String   @id @default(cuid())
  studentId String
  courseId  String
  progress  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([studentId, courseId])
}

model GradeItem {
  id        String   @id @default(cuid())
  courseId  String
  studentId String
  label     String
  score     Float    @default(0)
  weight    Float    @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Rubric {
  id        String   @id @default(cuid())
  courseId  String   @unique
  items     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserRole {
  id        String   @id @default(cuid())
  userId    String   @unique
  role      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
