generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:gjergji21@localhost:3306/bloggrs_students"
}

/* ---------------- ENUMS ---------------- */
enum LessonStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum SubmissionType {
  ASSIGNMENT
  LAB
  FILE
}

enum LabState {
  PENDING
  RUNNING
  STOPPED
}

/* ---------------- MODELS ---------------- */

model Student {
  id            String            @id @default(cuid())
  userId        String?
  displayName   String?
  courses       StudentCourse[]
  lessonProgress LessonProgress[]
  submissions   StudentSubmission[]
  labs          LabInstance[]
  quizzes       QuizAttempt[]
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
}

/* ---- Course enrollment ---- */
model StudentCourse {
  id          String    @id @default(cuid())
  studentId   String
  courseId    String
  completed   Boolean   @default(false)
  progress    Int?
  enrolledAt  DateTime  @default(now())

  student     Student   @relation(fields: [studentId], references: [id])

  @@unique([studentId, courseId])
}

/* ---- Lesson progress ---- */
model LessonProgress {
  id            String        @id @default(cuid())
  studentId     String
  lessonId      String
  status        LessonStatus  @default(NOT_STARTED)
  score         Float?
  startedAt     DateTime?     @default(now())
  updatedAt     DateTime?     @updatedAt
  completedAt   DateTime?

  student       Student       @relation(fields: [studentId], references: [id])

  @@unique([studentId, lessonId])
}

/* ---- Lesson submissions ---- */
model StudentSubmission {
  id            String           @id @default(cuid())
  studentId     String
  lessonId      String
  type          SubmissionType
  content       String?
  grade         Float?
  submittedAt   DateTime         @default(now())

  student       Student          @relation(fields: [studentId], references: [id])

  @@index([studentId, lessonId])
}

/* ---- Labs (future) ---- */
model LabInstance {
  id            String     @id @default(cuid())
  studentId     String
  lessonId      String
  url           String?
  containerId   String?
  state         LabState   @default(PENDING)
  config        Json?
  apiLastRun    Json?
  uiLastRun     Json?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  student       Student    @relation(fields: [studentId], references: [id])

  @@unique([studentId, lessonId])
}

/* ---- Quizzes (future) ---- */
model QuizAttempt {
  id            String    @id @default(cuid())
  studentId     String
  lessonId      String
  answers       Json
  score         Float?
  startedAt     DateTime  @default(now())
  submittedAt   DateTime?

  student       Student   @relation(fields: [studentId], references: [id])

  @@index([studentId, lessonId])
}
