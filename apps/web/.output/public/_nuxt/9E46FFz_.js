import{g as ke,r as a,j as p,k as W,aJ as be,ad as $,l as y,c as A,b as o,w as s,I as x,p as r,o as f,a as k,J as E,q as b,d as m,t as v,K as Y}from"./DQDUwbr-.js";const Ae={class:"flex flex-wrap items-center gap-3 justify-between"},Se={class:"flex flex-wrap items-center gap-4"},Ce={class:"flex items-center gap-2"},xe={style:{"max-width":"260px"}},Le={style:{opacity:".75"}},Ne="byway.uni.panel.v1",Re="byway:uni:columns",Be=ke({__name:"ModuleUniversityPanel",setup(Ue){const g=a("overview"),F=a(""),K=a("Comfort");a(!1);const L=p([{key:"lessons",label:"Lessons",value:12,hint:"Videos & readings"},{key:"assign",label:"Assignments",value:5,hint:"Due this term"},{key:"cohorts",label:"Cohorts",value:3,hint:"Active"},{key:"progress",label:"Avg Progress",value:"42%",hint:"Across roster"}]),N=p([{title:"Kickoff lecture",type:"Lecture",when:"Mon 09:00"},{title:"Lab 1 published",type:"Lab",when:"Wed 09:00"},{title:"Quiz 1 opens",type:"Quiz",when:"Fri 12:00"}]),R=p([{id:"c1",name:"Fall 2025 A",start:"2025-09-15",end:"2025-12-15",students:35},{id:"c2",name:"Fall 2025 B",start:"2025-09-16",end:"2025-12-16",students:28}]);a(!1),p({name:"",start:null,end:null}),a("");const u=p([{id:"s1",name:"A. Student",email:"a@student.edu",role:"Student"},{id:"s2",name:"B. Student",email:"b@student.edu",role:"Student"}]);a("All");const U=p([{id:"a1",title:"Homework 1",due:"2025-11-18",status:"Pending"},{id:"a2",title:"Project Proposal",due:"2025-11-25",status:"Submitted"}]);a(!1),p({title:"",due:null,points:100}),p([{id:"g1",student:"A. Student",item:"Quiz 1",score:8},{id:"g2",student:"B. Student",item:"Homework 1",score:12}]),p([{id:"d1",title:"Clarification on Lab 1",author:"A. Student",body:"How do we set the seed?"}]),p({title:"",body:""}),p([{id:"r1",name:"Syllabus.pdf",type:"PDF"},{id:"r2",name:"Slides-Week1.pptx",type:"Slides"}]);const z=a(null),j=a(!1);W(()=>{window.addEventListener("keydown",I)}),be(()=>window.removeEventListener("keydown",I)),$([g,F,K,z],()=>{try{console.debug("setItem replaced"),JSON.stringify({tab:g.value,q:F.value,density:K.value,dateRange:z.value})}catch{}});function I(e){if(e.key==="/"){e.preventDefault();const t=document.querySelector(".panel-toolbar input");t instanceof HTMLInputElement&&t.focus()}else e.key.toLowerCase()==="g"?g.value="grading":e.key.toLowerCase()==="c"?g.value="cohorts":e.key.toLowerCase()==="o"?g.value="overview":e.key.toLowerCase()==="e"&&X()}function Z(e,t){if(!e?.length)return"";const n=Object.keys(e[0]),l=w=>{const _=w==null?"":String(w);return/[",\n]/.test(_)?'"'+_.replace(/"/g,'""')+'"':_},c=n.map(l).join(","),V=e.map(w=>n.map(_=>l(w[_])).join(",")).join(`
`);return c+`
`+V}function G(e,t){const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.download=e,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)}function X(){try{j.value=!0;let e=[],t="export";const n=String(g.value||"overview").toLowerCase();if(n.includes("cohort")?(e=typeof R<"u"&&Array.isArray(R)?R:[],t="cohorts"):n.includes("assign")||n.includes("grade")?(e=typeof U<"u"&&Array.isArray(U)?U:[],e.length||(e=typeof u<"u"&&Array.isArray(u)?u:[]),t="grading"):(e=typeof N<"u"&&Array.isArray(N)?N:[],e.length||(e=typeof L<"u"&&Array.isArray(L)?L:[]),t="overview"),!e.length){j.value=!1;return}const l=Z(e);G(`module-${t}.csv`,l)}finally{j.value=!1}}const ee=a([]),te=e=>e?.id||e?.userId||e?.email||e?.username||e?.name,ne=y(()=>{const e=new Set(ee.value);return Array.isArray(u)?u.filter(t=>e.has(te(t))):[]});y(()=>ne.value.map(e=>e.email||e.contactEmail).filter(Boolean)),a(null),a(!1),a(""),a("");const ae=a([]);function oe(){try{ae.value=JSON.parse("[]")}catch{}}oe();const J=a(""),B=a(new Set);y(()=>{let e=Array.isArray(u)?u.slice():[];if(J.value){const t=J.value.toLowerCase();e=e.filter(n=>[n.name,n.email,n.username,n.studentId].some(l=>String(l||"").toLowerCase().includes(t)))}if(B.value.has("atRisk")&&(e=e.filter(t=>(t.grade??t.score??0)<=60||(t.missingSubmissions??0)>0)),B.value.has("inactive14")){const t=Date.now();e=e.filter(n=>{const l=new Date(n.lastActive||n.lastSeen||n.updatedAt||0).getTime();return!l||t-l>336*3600*1e3})}return B.value.has("top")&&(e=e.filter(t=>(t.grade??t.score??0)>=85)),e});const M=a(!1),O=a(!1),P=a(!1),d=a(null),T=a(""),D=y(()=>{const e=u&&u[0]||null;return e?Object.keys(e).filter(t=>!["id","activities"].includes(t)).map(t=>({key:t,title:t.replace(/([A-Z])/g," $1").replace(/^./,n=>n.toUpperCase())})):[]}),h=a([]);W(()=>{try{const e=JSON.parse("[]");Array.isArray(e)&&e.length&&(h.value=e)}catch{}}),$(h,e=>{try{console.debug("setItem replaced"),JSON.stringify(e)}catch{}},{deep:!0});const se=()=>h.value=D.value.map(e=>e.key),le=()=>{const e=["name","email","cohort","progress","lastActive"].filter(t=>D.value.some(n=>n.key===t));h.value=e},ie=y(()=>(u||[]).map(e=>({value:e.name||e.email,id:e.id}))),re=(e,t)=>{const n=t?.id,l=(u||[]).find(c=>c.name===e||c.email===e||n&&c.id===n);l&&(d.value=l,P.value=!0)},ue=async()=>{if(typeof fetch=="function")try{O.value=!0;const e=await fetch("/api/students-internal/university/roster",{method:"POST"}).catch(()=>null);if(e&&e.ok){const t=await e.json().catch(()=>null);t&&Array.isArray(t.roster)&&u.splice(0,u.length,...t.roster)}}finally{O.value=!1}},ce=y(()=>{const e=(u||[]).map(t=>Number(t.progress??0)).filter(t=>!Number.isNaN(t));return e.length?Math.round(e.reduce((t,n)=>t+n,0)/e.length):0}),q=y(()=>{const e=u||[],t={low:0,medium:0,high:0};for(const n of e){const l=(n.risk||"low").toLowerCase();t[l]!=null&&t[l]++}return[{label:"Low",color:"success",count:t.low},{label:"Medium",color:"warning",count:t.medium},{label:"High",color:"error",count:t.high}]}),de=y(()=>q.value.reduce((e,t)=>e+t.count,0));return(e,t)=>{const n=r("a-statistic"),l=r("a-tag"),c=r("a-space"),V=r("a-auto-complete"),w=r("a-checkbox"),_=r("a-checkbox-group"),H=r("a-divider"),S=r("a-button"),me=r("a-popover"),pe=r("a-switch"),fe=r("a-card"),C=r("a-descriptions-item"),ve=r("a-descriptions"),ye=r("a-empty"),_e=r("a-typography-title"),Q=r("a-timeline-item"),ge=r("a-timeline"),he=r("a-drawer");return f(),A(x,null,[o(fe,{class:"uni-analytics-bar",bordered:!1,style:{margin:"12px 0"}},{default:s(()=>[k("div",Ae,[k("div",Se,[o(n,{title:"Students",value:u&&u.length||0},null,8,["value"]),o(n,{title:"Avg Progress",precision:0,value:ce.value,suffix:"%"},null,8,["value"]),o(n,{title:"At Risk",value:de.value},null,8,["value"]),o(c,null,{default:s(()=>[(f(!0),A(x,null,E(q.value,i=>(f(),b(l,{key:i.label,color:i.color},{default:s(()=>[m(v(i.label)+": "+v(i.count),1)]),_:2},1032,["color"]))),128))]),_:1})]),k("div",Ce,[o(V,{style:{width:"220px"},options:ie.value,value:T.value,"onUpdate:value":t[0]||(t[0]=i=>T.value=i),placeholder:"Find student...",onSelect:re},null,8,["options","value"]),o(me,{placement:"bottomRight",title:"Show / hide columns"},{content:s(()=>[k("div",xe,[o(_,{value:h.value,"onUpdate:value":t[1]||(t[1]=i=>h.value=i)},{default:s(()=>[(f(!0),A(x,null,E(D.value,i=>(f(),A("div",{key:i.key,class:"py-1"},[o(w,{value:i.key},{default:s(()=>[m(v(i.title),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"]),o(H),o(c,null,{default:s(()=>[o(S,{size:"small",onClick:se},{default:s(()=>[...t[4]||(t[4]=[m("Select all",-1)])]),_:1}),o(S,{size:"small",onClick:le},{default:s(()=>[...t[5]||(t[5]=[m("Defaults",-1)])]),_:1})]),_:1})])]),default:s(()=>[o(S,null,{default:s(()=>[...t[6]||(t[6]=[m("Columns",-1)])]),_:1})]),_:1}),o(pe,{checked:M.value,"onUpdate:checked":t[2]||(t[2]=i=>M.value=i),"checked-children":"Dense","un-checked-children":"Comfort"},null,8,["checked"]),o(S,{onClick:ue,loading:O.value},{default:s(()=>[...t[7]||(t[7]=[m("Refresh",-1)])]),_:1},8,["loading"])])])]),_:1}),o(he,{open:P.value,"onUpdate:open":t[3]||(t[3]=i=>P.value=i),width:"460",title:d.value?.name||"Student"},{extra:s(()=>[d.value?.risk?(f(),b(l,{key:0,color:d.value.risk==="high"?"error":d.value.risk==="medium"?"warning":"success"},{default:s(()=>[m(v((d.value?.risk||"ok").toUpperCase()),1)]),_:1},8,["color"])):Y("",!0)]),default:s(()=>[d.value?(f(),b(ve,{key:0,size:"small",layout:"vertical",column:1},{default:s(()=>[o(C,{label:"Email"},{default:s(()=>[m(v(d.value.email||"–"),1)]),_:1}),o(C,{label:"Cohort"},{default:s(()=>[m(v(d.value.cohort||"–"),1)]),_:1}),o(C,{label:"Progress"},{default:s(()=>[m(v((d.value.progress??0)+"%"),1)]),_:1}),o(C,{label:"Last Active"},{default:s(()=>[m(v(d.value.lastActive||"–"),1)]),_:1})]),_:1})):(f(),b(ye,{key:1,description:"Pick a student from search to preview."})),o(H),o(_e,{level:5},{default:s(()=>[...t[8]||(t[8]=[m("Recent activity",-1)])]),_:1}),o(ge,null,{default:s(()=>[(f(!0),A(x,null,E(d.value?.activities||[],(i,we)=>(f(),b(Q,{key:we},{default:s(()=>[k("strong",null,v(i.title||i.kind||"Activity"),1),k("div",Le,v(i.date||i.when||""),1)]),_:2},1024))),128)),d.value?.activities?.length?Y("",!0):(f(),b(Q,{key:0},{default:s(()=>[...t[9]||(t[9]=[m("No recent activity",-1)])]),_:1}))]),_:1})]),_:1},8,["open","title"])],64)}}});export{Be as default};
