import{_ as Ve}from"./Cv_gb3jg.js";import{g as We,ai as se,aj as Qe,l as d,r as p,j as Ye,k as je,ad as re,c as ue,b as e,a as H,w as t,I as ie,p as s,ak as Je,o as c,d as l,t as r,a9 as M,q as _,K as P,x as f,m as b,al as de,am as ce,an as Xe,ac as Ge,J as Ze,n as u,_ as et}from"./DQDUwbr-.js";import{g as pe}from"./Cq7Gmhky.js";import{H as tt}from"./CN_SqyUH.js";import{u as at}from"./CLh6bXrM.js";import{u as ot}from"./CI-SnmTa.js";const lt={class:"course-page"},nt={class:"muted"},st=We({__name:"courses-detail",setup(rt){const V=Qe(),$=Je(),{user:I}=ot(),{addToCart:W,isInCart:_e,loading:fe,fetchCart:R}=at(),me=pe`query Me { me { id email roles displayName } }`,ve=pe`
  query Course($id: String!) {
    course(id: $id) {
      id
      title
      description
      category
      difficulty
      price
      discount
      coverUrl
      teacherId
      modules {
        id
        title
        lessons {
          id
          title
          duration
        }
      }
    }
  }
`,{data:ge,loading:ye}=se(me),{data:be,loading:Ce,refetch:ke}=se(ve,{variables:{id:V.params.id}});d(()=>ge?.me||null);const n=d(()=>be?.course||null),L=d(()=>Ce.value||ye.value),T=p(!1),S=d(()=>n.value?_e(n.value.id):!1),O=p(!1),k=p(!1),B=p(""),Q=p(!1),q=p(!1),h=p(0),Y=p("details"),he=p("/course-placeholder.png"),we=d(()=>{if(!n.value)return 0;const o=n.value.price||0,a=h.value>0?o*h.value/100:0;return o-a}),xe=d(()=>n.value?.price||0),$e=d(()=>h.value>0),Ie=d(()=>`-${h.value}%`),C=Ye({name:"Instructor Name",title:"Course Instructor",avatar:"/instructor.png",bio:""}),j=d(()=>n.value?.modules?n.value.modules.reduce((o,a)=>o+(a.lessons?.length||0),0):0),J=d(()=>n.value?.modules?n.value.modules.reduce((o,a)=>{const m=a.lessons?.reduce((v,E)=>v+(E.duration||0),0)||0;return o+m},0):0),X=d(()=>{const o=Math.floor(J.value/60),a=J.value%60;return o>0?`${o}h ${a}m`:`${a}m`}),G=d(()=>n.value?.modules?n.value.modules.map(o=>({id:o.id,title:o.title,lessons:o.lessons?.length||0,items:o.lessons||[],durationLabel:o.lessons?.reduce((a,m)=>a+(m.duration||0),0)||0})):[]);function Z(o){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o)}async function Le(){if(!n.value){u.error("Course not loaded");return}if(!I.value?.id){u.warning("Please log in to add courses to your cart"),$.push("/login");return}T.value=!0;try{await W(n.value.id,1),u.success(`Added "${n.value.title}" to cart`),await R()}catch(o){o?.message?.includes("authenticated")?(u.warning("Please log in to add courses to your cart"),$.push("/login")):o?.message?.includes("Already enrolled")?u.info(`You're already enrolled in "${n.value.title}"`):u.error(o?.message||"Failed to add course to cart")}finally{T.value=!1}}const ee=Le;async function te(){if(!n.value){u.error("Course not loaded");return}if(!I.value?.id){u.warning("Please log in to purchase courses"),$.push("/login");return}O.value=!0;try{S.value||await W(n.value.id,1),$.push("/checkout")}catch(o){u.error(o?.message||"Failed to proceed to checkout")}finally{O.value=!1}}function Se(){k.value=!k.value,u.info(k.value?"Added to wishlist":"Removed from wishlist")}async function Ue(){if(!n.value||!B.value.trim()){u.warning("Please enter a coupon code");return}q.value=!0;try{u.success("Coupon applied!"),Q.value=!0,h.value=10}catch(o){u.error(o?.message||"Invalid coupon code")}finally{q.value=!1}}function z(o){const a=typeof window<"u"?window.location.href:"",m=n.value?.title||"Course";if(o==="link"){navigator.clipboard?.writeText(a),u.success("Link copied to clipboard!");return}const v={x:`https://twitter.com/intent/tweet?url=${encodeURIComponent(a)}&text=${encodeURIComponent(m)}`,linkedin:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(a)}`};v[o]&&window.open(v[o],"_blank","width=600,height=400")}return je(async()=>{I.value?.id&&await R()}),re(()=>V.params.id,o=>{o&&ke()},{immediate:!0}),re(()=>n.value?.id,async o=>{o&&I.value?.id&&await R()},{immediate:!0}),(o,a)=>{const m=Ve,v=s("a-breadcrumb-item"),E=s("a-breadcrumb"),U=s("a-skeleton"),x=s("a-typography-title"),A=s("a-typography-paragraph"),w=s("a-typography-text"),F=s("a-divider"),g=s("a-space"),ae=s("a-avatar"),oe=s("a-col"),Ae=s("a-image"),De=s("a-tag"),Ne=s("a-alert"),y=s("a-button"),Pe=s("a-input"),Re=s("a-input-group"),Te=s("a-popover"),D=s("a-card"),Oe=s("a-affix"),Be=s("a-row"),N=s("a-descriptions-item"),qe=s("a-descriptions"),K=s("a-tab-pane"),ze=s("a-list"),Ee=s("a-collapse-panel"),Fe=s("a-collapse"),Ke=s("a-empty"),He=s("a-tabs"),le=s("a-float-button"),Me=s("a-float-button-group");return c(),ue(ie,null,[e(tt),H("div",lt,[e(D,{class:"course-hero",bordered:!0},{default:t(()=>[e(E,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(v,null,{default:t(()=>[e(m,{to:"/"},{default:t(()=>[...a[5]||(a[5]=[l("Home",-1)])]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(m,{to:"/categories"},{default:t(()=>[...a[6]||(a[6]=[l("Categories",-1)])]),_:1})]),_:1}),e(v,null,{default:t(()=>[l(r(n.value?.title||"Course"),1)]),_:1})]),_:1}),e(Be,{gutter:[24,24],align:"top"},{default:t(()=>[e(oe,{xs:24,lg:16},{default:t(()=>[e(g,{direction:"vertical",size:"small",style:{width:"100%"}},{default:t(()=>[e(x,{level:1,style:{margin:"0"}},{default:t(()=>[e(U,{loading:L.value,active:"",title:!0,paragraph:!1},{default:t(()=>[l(r(n.value?.title||"—"),1)]),_:1},8,["loading"])]),_:1}),e(U,{loading:L.value,active:"",paragraph:{rows:2}},{default:t(()=>[e(A,{class:"subtitle"},{default:t(()=>[l(r(n.value?.description||"—"),1)]),_:1})]),_:1},8,["loading"]),e(g,{align:"center",wrap:"",class:"meta"},{default:t(()=>[e(w,null,{default:t(()=>[l(r(X.value)+" · "+r(j.value)+" Lectures · "+r(n.value?.difficulty||"All levels"),1)]),_:1}),e(F,{type:"vertical"}),n.value?.category?(c(),_(w,{key:0},{default:t(()=>[l(" Category: "+r(n.value.category),1)]),_:1})):P("",!0)]),_:1}),e(g,{align:"center"},{default:t(()=>[e(ae,{size:40,src:C.avatar||"/instructor.png"},null,8,["src"]),e(w,null,{default:t(()=>[a[7]||(a[7]=l(" Created by ",-1)),e(w,{strong:""},{default:t(()=>[l(r(C.name),1)]),_:1})]),_:1})]),_:1}),M(o.$slots,"hero-extra",{},void 0,!0)]),_:3})]),_:3}),e(oe,{xs:24,lg:8},{default:t(()=>[e(Oe,{"offset-top":84},{default:t(()=>[e(D,{hoverable:"",class:"sidebar-card",bodyStyle:{padding:"16px"}},{default:t(()=>[e(U,{loading:L.value,active:"",paragraph:{rows:6}},{default:t(()=>[e(Ae,{src:n.value?.coverUrl||he.value,alt:"Course thumbnail",preview:!0,class:"thumb"},null,8,["src"]),e(F,{style:{margin:"12px 0"}}),e(g,{align:"baseline",wrap:""},{default:t(()=>[e(x,{level:3,style:{margin:"0"}},{default:t(()=>[l(r(Z(we.value)),1)]),_:1}),$e.value?(c(),_(w,{key:0,type:"secondary",delete:""},{default:t(()=>[l(r(Z(xe.value)),1)]),_:1})):P("",!0),h.value>0?(c(),_(De,{key:1,color:"green"},{default:t(()=>[l(r(Ie.value),1)]),_:1})):P("",!0)]),_:1}),e(Ne,{type:"success","show-icon":"",message:"30-day money-back guarantee",style:{margin:"12px 0"}}),e(g,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(y,{type:"primary",block:"",icon:b(f(de)),onClick:f(ee),loading:T.value||f(fe),disabled:S.value},{default:t(()=>[l(r(S.value?"In Cart":"Add To Cart"),1)]),_:1},8,["icon","onClick","loading","disabled"]),e(y,{block:"",icon:b(f(ce)),onClick:te,loading:O.value},{default:t(()=>[...a[8]||(a[8]=[l(" Buy Now ",-1)])]),_:1},8,["icon","loading"]),e(y,{block:"",icon:b(f(Xe)),type:k.value?"primary":"default",ghost:!k.value,onClick:Se},{default:t(()=>[l(r(k.value?"Wishlisted":"Add to Wishlist"),1)]),_:1},8,["icon","type","ghost"])]),_:1}),e(F,{style:{margin:"12px 0"}}),e(Re,{compact:"",style:{"margin-bottom":"8px"}},{default:t(()=>[e(Pe,{value:B.value,"onUpdate:value":a[0]||(a[0]=i=>B.value=i),style:{width:"65%"},placeholder:"Coupon code"},null,8,["value"]),e(y,{style:{width:"35%"},onClick:Ue,loading:q.value},{default:t(()=>[...a[9]||(a[9]=[l(" Apply ",-1)])]),_:1},8,["loading"])]),_:1}),Q.value?(c(),_(w,{key:0,type:"success"},{default:t(()=>[...a[10]||(a[10]=[l(" Coupon applied! ",-1)])]),_:1})):P("",!0),e(g,{style:{"margin-top":"10px"}},{default:t(()=>[e(Te,{trigger:"click"},{content:t(()=>[e(g,null,{default:t(()=>[e(y,{type:"text",onClick:a[1]||(a[1]=i=>z("link"))},{default:t(()=>[...a[11]||(a[11]=[l("Copy link",-1)])]),_:1}),e(y,{type:"text",onClick:a[2]||(a[2]=i=>z("x"))},{default:t(()=>[...a[12]||(a[12]=[l("Share on X",-1)])]),_:1}),e(y,{type:"text",onClick:a[3]||(a[3]=i=>z("linkedin"))},{default:t(()=>[...a[13]||(a[13]=[l("LinkedIn",-1)])]),_:1})]),_:1})]),default:t(()=>[e(y,{type:"link",icon:b(f(Ge))},{default:t(()=>[...a[14]||(a[14]=[l("Share",-1)])]),_:1},8,["icon"])]),_:1}),M(o.$slots,"cta-extra",{},void 0,!0)]),_:3})]),_:3},8,["loading"])]),_:3})]),_:3})]),_:3})]),_:3})]),_:3}),e(D,{class:"course-details",bordered:!0},{default:t(()=>[e(He,{activeKey:Y.value,"onUpdate:activeKey":a[4]||(a[4]=i=>Y.value=i)},{default:t(()=>[e(K,{key:"details",tab:"Details"},{default:t(()=>[e(x,{level:4},{default:t(()=>[...a[15]||(a[15]=[l("Course Description",-1)])]),_:1}),e(U,{loading:L.value,active:"",paragraph:{rows:4}},{default:t(()=>[e(A,null,{default:t(()=>[l(r(n.value?.description||"—"),1)]),_:1})]),_:1},8,["loading"]),e(x,{level:4,style:{"margin-top":"16px"}},{default:t(()=>[...a[16]||(a[16]=[l(" Course Info ",-1)])]),_:1}),e(qe,{bordered:"",size:"small"},{default:t(()=>[e(N,{label:"Category"},{default:t(()=>[l(r(n.value?.category||"—"),1)]),_:1}),e(N,{label:"Difficulty"},{default:t(()=>[l(r(n.value?.difficulty||"—"),1)]),_:1}),e(N,{label:"Lectures"},{default:t(()=>[l(r(j.value),1)]),_:1}),e(N,{label:"Total duration"},{default:t(()=>[l(r(X.value),1)]),_:1})]),_:1})]),_:1}),e(K,{key:"instructor",tab:"Instructor"},{default:t(()=>[e(D,{bordered:"",class:"instructor-card"},{default:t(()=>[e(g,{align:"start"},{default:t(()=>[e(ae,{size:90,src:C.avatar||"/instructor.png"},null,8,["src"]),H("div",null,[e(x,{level:5,style:{margin:"0",color:"#1677ff"}},{default:t(()=>[l(r(C.name),1)]),_:1}),H("div",nt,r(C.title),1)])]),_:1}),C.bio?(c(),_(A,{key:0,style:{"margin-top":"12px"}},{default:t(()=>[l(r(C.bio),1)]),_:1})):(c(),_(A,{key:1,class:"muted",style:{"margin-top":"12px"}},{default:t(()=>[...a[17]||(a[17]=[l(" Instructor profile will be available soon. ",-1)])]),_:1}))]),_:1})]),_:1}),e(K,{key:"syllabus",tab:"Syllabus"},{default:t(()=>[G.value.length?(c(),_(Fe,{key:0,accordion:""},{default:t(()=>[(c(!0),ue(ie,null,Ze(G.value,i=>(c(),_(Ee,{key:i.id,header:i.title,extra:b("span",{class:"muted"},`${i.lessons} Lessons · ${i.durationLabel}`)},{default:t(()=>[e(ze,{size:"small","data-source":i.items,renderItem:ne=>b("div",{class:"lesson-row"},`${ne.title||"Lesson"} · ${ne.duration||"0"} min`)},null,8,["data-source","renderItem"])]),_:2},1032,["header","extra"]))),128))]),_:1})):(c(),_(Ke,{key:1}))]),_:1}),M(o.$slots,"tabs-extra",{},void 0,!0)]),_:3},8,["activeKey"])]),_:3}),e(Me,{shape:"square",style:{right:"24px"}},{default:t(()=>[e(le,{icon:b(f(de)),tooltip:"Add to cart",onClick:f(ee),disabled:S.value},null,8,["icon","onClick","disabled"]),e(le,{icon:b(f(ce)),tooltip:"Buy now",onClick:te},null,8,["icon"])]),_:1})])],64)}}}),ft=et(st,[["__scopeId","data-v-75902442"]]);export{ft as default};
