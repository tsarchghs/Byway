import{g as xs,r as g,l as A,j as P,aJ as Ds,k as Mt,ad as tt,q as f,w as t,x as L,bg as Gs,a0 as js,ai as Vs,p,aj as Js,ak as Hs,o as d,b as s,L as st,a as _,K as y,c as h,I as q,J as oe,d as n,t as u,S as Qs,b5 as Ys,bh as qt,bi as Ks,bj as Bt,ae as Ws,aF as xt,b3 as Dt,bk as Xs,R as Zs,bl as ea,bm as ta,bn as sa,aA as aa,ag as Gt,aa as la,bo as oa,B as na,bp as ia,m as jt,bq as ra,br as ua,n as k,_ as da}from"./DQDUwbr-.js";import{g as ca}from"./Cq7Gmhky.js";import{t as Vt}from"./DFP984fK.js";const pa={class:"global-banners"},ma={class:"muted"},fa={class:"ml-1"},va={class:"ml-1"},ba={class:"ml-1"},ga={class:"ml-1"},ya={class:"ml-1"},ka={class:"sider-inner"},ha={key:0,class:"cover-meta"},_a={class:"cover-title"},wa={class:"cover-tags"},Ca={key:1,class:"mt-2"},Sa={class:"ml-1"},La={class:"muted"},Pa={class:"muted"},Ia={key:2,class:"enroll-cta"},Ua={class:"muted"},za={class:"muted"},Na={key:0},$a={class:"mt-1"},Aa={key:1},Ta={key:0},Oa={class:"video-controls"},Fa={key:0,class:"video-wrap"},Ra=["src"],Ea={key:1,class:"video-fallback"},Ma=["href"],qa=["playbackRate"],Ba=["src"],xa={key:1},Da={key:2},Ga={key:3},ja={key:0,class:"mt-1"},Va={key:1,class:"mt-1"},Ja={key:2,class:"mt-1"},Ha={key:4},Qa=["href"],Ya={key:5},Ka={class:"nav-actions"},Wa={class:"right-inner"},Xa={key:0,class:"mb-1"},Za=["href"],el={key:0,class:"mb-1"},tl=["href"],Re="http://localhost:4000/api/students-internal/graphql",sl="http://localhost:4000/api/teach-internal/graphql",Q="http://localhost:4000/api/teacher-course-lab",al=xs({__name:"module-listing",setup(ll){const Jt=ca`query Me { me { id email displayName roles } }`;let at=null,Ht=null,lt=null,W=g(!1);function ot(){if(typeof window>"u"||W.value)return;const a=window.localStorage?.getItem("token");if(!a){console.warn("[Auth] No token found in localStorage, delaying Apollo client initialization");return}try{lt=Gs("students-internal",a),js(lt),W.value=!0;try{at=Vs(Jt),Ht=A(()=>at.result.value?.me||null)}catch(e){console.warn("[Auth] Error initializing me query:",e)}}catch(e){console.error("[Auth] Failed to initialize Apollo client:",e)}}const Qt={en:{Course:"Course","Choose a module":"Choose a module",Overview:"Overview",min:"min",Online:"Online",Offline:"Offline",Mock:"Mock",Live:"Live",View:"View","Toggle dark":"Toggle dark","Increase font size":"Increase font size","Decrease font size":"Decrease font size","Keyboard shortcuts":"Keyboard shortcuts","Debug & mocks":"Debug & mocks","Import / Export":"Import / Export",Reload:"Reload",Resume:"Resume","Restart lab":"Restart lab","Update container with saved code":"Update container with saved code","Updating container with your saved code...":"Updating container with your saved code...","Container refreshed with your latest workspace":"Container refreshed with your latest workspace","Failed to update container":"Failed to update container","Lab session restarted":"Lab session restarted","Failed to restart lab session":"Failed to restart lab session",lessons:"lessons","Search lessons":"Search lessons",All:"All",Video:"Video",Reading:"Reading",Quiz:"Quiz","Assign.":"Assign.",Lab:"Lab","Hide completed":"Hide completed",Sort:"Sort","Pick a module to see its lessons":"Pick a module to see its lessons","Untitled lesson":"Untitled lesson",Done:"Done",Locked:"Locked",Preview:"Preview","Course overview":"Course overview","Browse modules and jump in — everything runs in this page.":"Browse modules and jump in — everything runs in this page.","No modules yet":"No modules yet","Enroll to unlock full access":"Enroll to unlock full access","You can still watch previews and read public materials.":"You can still watch previews and read public materials.","Enroll now":"Enroll now","See pricing":"See pricing",Lesson:"Lesson","Course progress":"Course progress","Bookmark current lesson":"Bookmark current lesson","Print lesson":"Print lesson","This lesson is locked":"This lesson is locked","Complete prerequisite lesson(s):":"Complete prerequisite lesson(s):","Unlocks at:":"Unlocks at:",Enroll:"Enroll","Go to next available":"Go to next available","Bookmark timestamp":"Bookmark timestamp","Video URL:":"Video URL:",Notes:"Notes","Lesson content":"Lesson content","No content":"No content",Highlights:"Highlights","No highlights":"No highlights","(empty)":"(empty)",Option:"Option","Your answer":"Your answer",True:"True",False:"False","Submit quiz":"Submit quiz","Mark complete":"Mark complete","Unsupported lesson type.":"Unsupported lesson type.","Your notes for this lesson":"Your notes for this lesson","Mark as incomplete":"Mark as incomplete",Previous:"Previous",Next:"Next","Auto-next on complete":"Auto-next on complete",Progress:"Progress",Resources:"Resources",Attachments:"Attachments","No resources":"No resources",Attachment:"Attachment","Your notes":"Your notes","Lesson notes":"Lesson notes","Type highlight and press +":"Type highlight and press +",Remove:"Remove","Q&A":"Q&A","Questions & Answers":"Questions & Answers","Ask a question":"Ask a question",Post:"Post",Clear:"Clear",Bookmarks:"Bookmarks",Go:"Go","Import / Export progress":"Import / Export progress",Export:"Export","Download your progress as JSON.":"Download your progress as JSON.","Export JSON":"Export JSON",Import:"Import","Paste JSON below and import.":"Paste JSON below and import.",Pricing:"Pricing","Enroll now (mock)":"Enroll now (mock)","Basic · Free preview":"Basic · Free preview","Pro · Full course + certificate":"Pro · Full course + certificate","Team · Up to 10 seats":"Team · Up to 10 seats","Submit assignment":"Submit assignment","Assignment brief":"Assignment brief",Rubric:"Rubric","Link to work (URL)":"Link to work (URL)","Attach files (mock)":"Attach files (mock)","Click to attach":"Click to attach",Cancel:"Cancel",Submit:"Submit","No lessons found":"No lessons found","Open lab":"Open lab","Start lab session":"Start lab session","Open VS Code":"Open VS Code","Open in new tab":"Open in new tab","Submit lab":"Submit lab","Restart lab":"Restart lab",Challenge:"Challenge",Difficulty:"Difficulty",Description:"Description","Session status":"Session status","VS Code URL":"VS Code URL","Latest submission":"Latest submission",Grade:"Grade",Feedback:"Feedback","Please log in to start a lab session":"Please log in to start a lab session","Lab challenge not found for this lesson. Please contact your teacher.":"Lab challenge not found for this lesson. Please contact your teacher.","Lab session started":"Lab session started","Session started. Code server will be available shortly.":"Session started. Code server will be available shortly.","Failed to start lab session":"Failed to start lab session","No active lab session":"No active lab session","Please start a lab session first":"Please start a lab session first","Please log in to submit lab work":"Please log in to submit lab work","Lab work submitted. Grading in progress...":"Lab work submitted. Grading in progress...","Failed to submit lab work":"Failed to submit lab work","Lab session restarted":"Lab session restarted","Failed to restart lab session":"Failed to restart lab session","Grading complete":"Grading complete","Failed to submit":"Failed to submit","Starting lab session...":"Starting lab session...","Opening VS Code in new tab...":"Opening VS Code in new tab...","Session started. Code server will be available shortly. Please refresh in a moment.":"Session started. Code server will be available shortly. Please refresh in a moment.","Code server is ready!":"Code server is ready!","Session encountered an error. Please try again.":"Session encountered an error. Please try again.","Submitting lab work...":"Submitting lab work...","Lab session must be running to submit. Please start a session first.":"Lab session must be running to submit. Please start a session first.","Grading complete! Your lab passed.":"Grading complete! Your lab passed.","Grading complete. Some tests failed.":"Grading complete. Some tests failed.","Grading is taking longer than expected. Please check back later.":"Grading is taking longer than expected. Please check back later.","Please log in to view submission status":"Please log in to view submission status","Session created but no session data returned":"Session created but no session data returned","No submission data returned":"No submission data returned","Lab challenge not found for this lesson. Please contact your teacher to set up this lab.":"Lab challenge not found for this lesson. Please contact your teacher to set up this lab."}};function l(a){return Qt.en[a]||a}const Yt=a=>{if(!a)return{};if(typeof a=="string")try{return JSON.parse(a)}catch{return{}}return typeof a=="object"?a:{}};function Kt(a){if(!a)return;const e=a.kind||"BACKEND_NODE";return{kind:e,dockerImage:a.dockerImage||"node:22-alpine",buildCmd:a.buildCmd||"npm install",startCmd:a.startCmd||(e==="FRONTEND_NUXT"?"npm run dev":"npm start"),devPort:Number(a.devPort||0)||3e3,traefikHost:a.traefikHost||"",apiTests:a.apiTests||[],uiTests:a.uiTests||[]}}function Wt(a){const e=Yt(a.metadata),r=e.lab?Kt(e.lab):void 0;return{...a,metadata:e,lab:r,resources:e.resources||a.resources||[],attachments:e.attachments||a.attachments||[],tags:e.tags||a.tags||[],prerequisites:e.prerequisites||a.prerequisites||[],unlockAt:e.unlockAt??a.unlockAt,preview:e.preview??a.preview??!1,quiz:e.quiz||a.quiz}}const ve=g(!1),be=g(!1),nt=g(!1),it=g("progress"),Ee=g(""),ge=g("all"),Me=g(!1),ye=g(["title"]),qe=A(()=>ye.value[0]||"title"),Xt=g(15),rt=g(!0),X=Js(),Zt=Hs(),ut=g(!1),Be=g(!1),I=P({id:"",title:"",category:"",difficulty:"Beginner",coverUrl:""}),ne=g([]),U=g([]),Z=g(null),B=g(0),ee=P({completedLessonIds:[],lastLessonId:void 0}),ie=g(!0),es=g(null),xe=g(1),G=P({global:{text:"",highlights:[]}}),dt=g("");P([]);const ke=g(""),ct=P([]),pt=P({}),ts=P([]),de=g(typeof navigator<"u"?navigator.onLine:!0),ce=g(!1),he=g(""),De=g(!1),Ge=g(!1),je=g(""),Ve=g(!1),Je=g(!1),mt=g("pro"),He=g(!1),Qe=g(!1),ss=g(!1),_e=P({notes:"",url:""}),E=P({}),C=P({}),F=P({}),we=P({}),Ce=P({}),Se=P({}),Le=P({}),pe=P({}),Pe=P({resource:!1,attachment:!1}),Ie=A(()=>String(X?.params?.module_id||"")),R=A(()=>String(X?.params?.course_id||X?.params?.courseId||"")),x=A(()=>String(X?.params?.student_id||X?.params?.studentId||"")),Ue=A(()=>ne.value.length>0),ft=A(()=>!!Z.value&&U.value.length>0),vt=a=>{if(!a)return"";if(/youtube\.com|youtu\.be/.test(a)){const e=a.match(/(?:v=|be\/)([A-Za-z0-9_-]{6,})/)?.[1];return e?`https://www.youtube.com/embed/${e}?rel=0`:""}return""},bt=a=>a.unlockAt?new Date(a.unlockAt).toLocaleString():"",i=A(()=>U.value[B.value]),gt=A(()=>U.value.reduce((a,e)=>a+(e.duration||0),0)),as=A(()=>U.value.length?Math.round(ee.completedLessonIds.length/U.value.length*100):0),ls=A(()=>({backgroundImage:I.coverUrl?`url('${I.coverUrl}')`:"linear-gradient(135deg,#111,#334155)"})),yt=A(()=>{const a=i.value;if(!a)return[];const e=a.resources||[],r=(pe[a.id]||[]).filter(c=>c.kind==="resource");return[...e,...r.map(c=>({title:c.title,url:c.url,name:c.title}))]}),kt=A(()=>{const a=i.value;if(!a)return[];const e=a.attachments||[],r=(pe[a.id]||[]).filter(c=>c.kind==="attachment");return[...e,...r.map(c=>({name:c.title,url:c.url}))]}),os=A(()=>{let a=U.value.slice();const e=Ee.value.trim().toLowerCase();return e&&(a=a.filter(r=>(r.title||"").toLowerCase().includes(e)||(r.type||"").toLowerCase().includes(e))),ge.value!=="all"&&(a=a.filter(r=>r.type===ge.value)),Me.value&&(a=a.filter(r=>!D(r.id))),qe.value==="title"?a.sort((r,c)=>(r.title||"").localeCompare(c.title||"")):qe.value==="duration"?a.sort((r,c)=>(r.duration||0)-(c.duration||0)):qe.value==="type"&&a.sort((r,c)=>(r.type||"").localeCompare(c.type||"")),a});function ns({key:a}){ye.value=[a]}const D=a=>ee.completedLessonIds.includes(a),is=a=>U.value.find(e=>e.id===a)?.title||"";function ht(a){return!1}let ze=new Set;Ds(()=>{ze.forEach(a=>a.abort()),ze.clear()});async function Ne(a,e,r=Re,c=8e3){const v=typeof window<"u"?window.localStorage?.getItem("token"):null;if(!v)throw new Error("Authentication required: No token found in localStorage. Please log in.");if(De.value)throw new Error("Forced mock mode");const m=new AbortController;ze.add(m);const w=setTimeout(()=>m.abort(),c);try{const T=await fetch(r,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({query:a,variables:e}),signal:m.signal}),V=await T.json().catch(()=>({}));if(!T.ok)throw new Error(V?.errors?.[0]?.message||T.statusText||"Request failed");if(V.errors?.length)throw new Error(V.errors[0]?.message||"GraphQL error");return V.data}finally{clearTimeout(w),ze.delete(m)}}async function rs(a){const e=typeof window<"u"?window.localStorage?.getItem("token"):null;if(!e)throw new Error("Authentication required: No token found in localStorage.");const r=await fetch("/api/students-internal/files/upload",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include",body:JSON.stringify({fileName:a.fileName,data:a.base64,courseId:a.courseId,moduleId:a.moduleId,lessonId:a.lessonId,kind:a.kind})});if(!r.ok){const c=await r.text();throw new Error(c||`HTTP ${r.status}`)}return r.json()}async function us(a){return typeof window>"u"?null:new Promise(e=>{const r=document.createElement("input");r.type="file",r.onchange=async()=>{const c=r.files?.[0];if(!c)return e(null);const v=new FileReader;v.onload=async()=>{try{const m=v.result,w=R.value,T=Z.value?.id||null,V=i.value?.id||null;if(!w)throw new Error("Missing courseId in route");const b=await rs({fileName:c.name,base64:String(m),courseId:w,moduleId:T,lessonId:V,kind:a});e(b?.file||null)}catch(m){console.error("[students-internal] file upload failed",m),k.error(m?.message||"Upload failed"),e(null)}},v.onerror=()=>e(null),v.readAsDataURL(c)},r.click()})}const $e={myCourses:`
    query MyCourses($studentId:String!) {
      myCourses(studentId:$studentId) {
        id
        studentId
        courseId
        completed
        progress
        course { id title category difficulty coverUrl }
      }
    }
  `,myProgress:`
    query MyProgress {
      myProgress {
        id
        lessonId
        updatedAt
      }
    }
  `,updateProgress:`
    mutation UpdateProgress($studentId:String!, $lessonId:String!, $completed:Boolean!, $score:Int) {
      updateProgress(studentId:$studentId, lessonId:$lessonId, completed:$completed, score:$score) {
        id
        lessonId
        completed
        updatedAt
      }
    }
  `,modulesByCourse:`
    query ModulesByCourse($courseId:String!) {
      modulesByCourse(courseId:$courseId) {
        id
        title
        lessons { id duration title type content videoUrl rubric metadata moduleId }
      }
    }
  `,lessonShares:`
    query LessonShares($courseId:String!, $moduleId:String, $lessonId:String) {
      lessonShares(courseId:$courseId, moduleId:$moduleId, lessonId:$lessonId) {
        id
        kind
        title
        url
        size
        mimeType
        metadata
      }
    }
  `},re=P({course:!1,modules:!1,progress:!1});async function ds(){if(W.value&&!(!R.value||!x.value)){re.course=!0,re.modules=!0,ce.value=!1,he.value="";try{const{myCourses:a}=await Ne($e.myCourses,{studentId:x.value},Re),e=a?.find(m=>m.courseId===R.value);e?.course?(Object.assign(I,e.course),ie.value=!!e.completed||e.progress>0||!0):ie.value=!1;const{modulesByCourse:r}=await Ne($e.modulesByCourse,{courseId:R.value},sl),c=(r||[]).map(m=>({...m,lessons:(m.lessons||[]).map(w=>Wt(w))}))||[];ne.value=c.map(m=>({id:m.id,title:m.title,lessonCount:m.lessons?.length??0,minutes:m.lessons?.reduce((w,T)=>w+(T.duration||0),0)}));const v=c.find(m=>m.id===Ie.value)||c[0]||null;Z.value=v,U.value=v?.lessons||[],B.value=0,await ws(),i.value?.id&&await wt(i.value.id)}catch(a){console.warn("[Course] Falling back to mocks:",a?.message||a),ce.value=!0,he.value=a?.message||"Network error",ps()}finally{re.course=!1,re.modules=!1}}}async function cs(){if(W.value&&x.value){re.progress=!0;try{const{myProgress:a}=await Ne($e.myProgress,{studentId:x.value},Re);ee.completedLessonIds.length=0;const e=(a||[]).filter(c=>c.completed).map(c=>c.lessonId);ee.completedLessonIds.push(...e);const r=a?.[0];if(ee.lastLessonId=r?.lessonId,ee.lastLessonId){const c=U.value.findIndex(v=>v.id===ee.lastLessonId);c>=0&&(B.value=c)}}catch(a){console.warn("[Progress] Using local-only mock progress:",a?.message||a)}finally{re.progress=!1}}}function ps(){I.id=R.value||"mock-course",I.title="Mock Full Stack Course",I.category="Software",I.difficulty="Intermediate";const a="mock-module-1";ne.value=[{id:a,title:"Getting started",lessonCount:3,minutes:30}];const e=[{id:"l1",moduleId:a,title:"Welcome",type:"video",duration:5,preview:!0},{id:"l2",moduleId:a,title:"Setup",type:"reading",duration:10},{id:"l3",moduleId:a,title:"First project",type:"lab",duration:15}];Z.value={id:a,courseId:I.id,title:"Getting started",lessons:e},U.value=e,B.value=0}async function Ye(){try{await ds(),await cs()}catch(a){console.error("[Bootstrap] Failed:",a)}}Mt(()=>{ot(),tt(()=>W.value,a=>{a&&Ye()},{immediate:!0}),tt(()=>[R.value,Ie.value,x.value],()=>{W.value&&Ye()}),tt(()=>i.value?.id,async a=>{a&&i.value?.type==="lab"&&Ae(a).then(e=>{e&&te(e.id,a)}),a&&await wt(a)},{immediate:!0}),window.addEventListener("online",()=>{de.value=!0,W.value&&Ye()}),window.addEventListener("offline",()=>{de.value=!1})}),Mt(()=>{ot()});function ms(a){U.value[a]&&(B.value=a,ua(()=>{document.querySelector(`[data-test-id="lesson-row-${a}"]`)?.scrollIntoView({block:"center",behavior:"smooth"})}))}function _t(a){return G[a]||(G[a]={text:"",highlights:[]}),G[a]}function Ke(a){a&&Zt.replace({name:X.name,params:{...X.params,module_id:a}})}function j(){const a=typeof window<"u"?window.localStorage?.getItem("token"):null;return a?{"Content-Type":"application/json",Authorization:`Bearer ${a}`}:{"Content-Type":"application/json"}}async function Ae(a){if(!a||!R.value)return null;try{if(E[a])return E[a];const e=await fetch(`${Q}/challenges/by-lesson/${a}`,{method:"GET",headers:j(),credentials:"include"}).catch(()=>null);if(e?.ok){const c=await e.json();if(c.challenge)return E[a]=c.challenge,c.challenge}else e&&e.status===401&&console.warn("[Lab] Not authenticated to fetch lesson challenge");const r=await fetch(`${Q}/challenges`,{method:"GET",headers:j(),credentials:"include"});if(r.ok){const v=(await r.json()).items?.find(m=>m.lessonId===a&&(m.courseId===R.value||!m.courseId));if(v)return E[a]=v,v}else r.status===401&&console.warn("[Lab] Not authenticated to fetch challenges")}catch(e){console.warn("[Lab] Failed to fetch challenge:",e)}return null}async function te(a,e){if(!(!a||!x.value)){try{const r=await fetch(`${Q}/sessions/me`,{method:"GET",headers:j(),credentials:"include"});if(r.ok){const v=(await r.json()).sessions?.find(m=>m.challengeId===a&&m.userId===x.value);if(v){if(C[e]=v,v.submissions&&v.submissions.length>0){const m=v.submissions[0];F[e]=m}return v}}}catch(r){console.warn("[Lab] Failed to fetch session:",r)}return null}}async function We(a){if(a?.id){if(!x.value)return k.warning(l("Please log in to start a lab session"));we[a.id]=!0;try{let e=E[a.id];if(e||(e=await Ae(a.id)),!e){try{const c=await fetch(`${Q}/challenges/by-lesson/${a.id}`,{method:"GET",headers:j(),credentials:"include"}).catch(()=>null);if(c?.ok){const v=await c.json();v.challenge&&(e=v.challenge,E[a.id]=e)}}catch(c){console.warn("[Lab] Failed to fetch challenge metadata:",c)}if(!e)return k.error(l("Lab challenge not found for this lesson. Please contact your teacher to set up this lab."))}let r=await te(e.id,a.id);if(!r||r.status==="stopped"||r.status==="error"){k.loading(l("Starting lab session..."),0);const c=await fetch(`${Q}/session/start`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({challengeId:e.id})});if(k.destroy(),!c.ok){const m=await c.json().catch(()=>({error:l("Failed to start session")}));throw new Error(m.error||`HTTP ${c.status}`)}if(r=(await c.json()).session,!r)throw new Error(l("Session created but no session data returned"));C[a.id]=r,k.success(l("Lab session started")),!r.codeServerUrl&&(r.status==="starting"||r.status==="running")?fs(r.id,e.id,a.id).catch(()=>{}):await te(e.id,a.id)}else await te(e.id,a.id);r?.codeServerUrl?(window.open(r.codeServerUrl,"_blank"),k.success(l("Opening VS Code in new tab..."))):k.info(l("Session started. Code server will be available shortly. Please refresh in a moment."))}catch(e){console.error("[Lab] Failed to start session:",e),k.error(e?.message||l("Failed to start lab session"))}finally{we[a.id]=!1}}}async function fs(a,e,r,c=10){let v=0;const m=async()=>{v++;try{const w=await te(e,r);if(w?.codeServerUrl)return C[r]=w,k.success(l("Code server is ready!")),!0;if(v<c&&(w?.status==="starting"||w?.status==="running"))setTimeout(m,2e3);else if(w?.status==="error")return k.error(l("Session encountered an error. Please try again.")),!1}catch(w){console.warn("[Lab] Poll error:",w),v<c&&setTimeout(m,2e3)}return!1};await m()}function vs(a){if(!a?.id)return;const e=C[a.id];e?.codeServerUrl?window.open(e.codeServerUrl,"_blank"):k.warning(l("No active lab session"))}async function bs(a){if(!a?.id)return;const e=C[a.id];if(!e?.id)return We(a);Se[a.id]=!0;try{await fetch(`${Q}/session/stop`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({id:e.id})}).catch(()=>null),await We(a),k.success(l("Lab session restarted"))}catch(r){console.error("[Lab] Failed to restart session:",r),k.error(l("Failed to restart lab session"))}finally{Se[a.id]=!1}}async function gs(a){if(!a?.id)return;const e=C[a.id];if(!e?.id)return k.warning(l("Please start a lab session first"));Le[a.id]=!0;try{k.loading(l("Updating container with your saved code..."),0);const r=await fetch(`${Q}/session/refresh`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({id:e.id,challengeId:e.challengeId})});k.destroy();const c=await r.json().catch(()=>({}));if(!r.ok)throw new Error(c?.error||l("Failed to update container"));c.session&&(C[a.id]=c.session,k.success(l("Container refreshed with your latest workspace")))}catch(r){console.error("[Lab] Failed to refresh container:",r),k.error(r?.message||l("Failed to update container"))}finally{Le[a.id]=!1}}async function ys(a){if(!a?.id)return;if(!x.value)return k.warning(l("Please log in to submit lab work"));let e=C[a.id];if(!e||!e.id){const r=await Ae(a.id);r&&(e=await te(r.id,a.id))}if(!e||!e.id)return k.warning(l("Please start a lab session first"));if(e.status!=="running"&&e.status!=="starting")return k.warning(l("Lab session must be running to submit. Please start a session first."));Ce[a.id]=!0;try{k.loading(l("Submitting lab work..."),0);const r=await fetch(`${Q}/submit`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({sessionId:e.id})});if(k.destroy(),!r.ok){const m=await r.json().catch(()=>({error:l("Failed to submit")}));throw new Error(m.error||`HTTP ${r.status}`)}const v=(await r.json()).submission;if(!v)throw new Error(l("No submission data returned"));F[a.id]=v,k.success(l("Lab work submitted. Grading in progress...")),await ks(e.id,a.id)}catch(r){console.error("[Lab] Failed to submit:",r),k.error(r?.message||l("Failed to submit lab work"))}finally{Ce[a.id]=!1}}async function ks(a,e,r=30){let c=0;const v=async()=>{c++;try{if(!await hs(a,e)){c<r?setTimeout(v,2e3):k.warning(l("Grading is taking longer than expected. Please check back later."));return}const w=F[e];if(w?.status==="pending"||w?.status==="running")c<r?setTimeout(v,2e3):k.warning(l("Grading is taking longer than expected. Please check back later."));else if(w?.status==="passed"||w?.status==="failed"){const T=w.passed?l("Grading complete! Your lab passed."):l("Grading complete. Some tests failed.");w.passed?k.success(T):k.warning(T)}}catch(m){console.warn("[Lab] Poll error:",m),c<r&&setTimeout(v,2e3)}};setTimeout(v,2e3)}async function hs(a,e){try{const r=await fetch(`${Q}/sessions/me`,{method:"GET",headers:j(),credentials:"include"});if(r.ok){const v=(await r.json()).sessions?.find(m=>m.id===a);if(v&&(C[e]=v,v.submissions&&v.submissions.length>0)){const m=v.submissions[0],w=F[e]?.status;return F[e]=m,m.status!==w||m.status==="passed"||m.status==="failed"||m.status==="error"}}else r.status===401&&(console.warn("[Lab] Not authenticated to refresh submission"),k.warning(l("Please log in to view submission status")))}catch(r){console.warn("[Lab] Failed to refresh submission:",r)}return!1}function _s(a){switch(a){case"running":return"green";case"starting":return"blue";case"stopped":return"default";case"error":return"red";default:return"default"}}async function ws(){if(!R.value||!x.value||!Z.value||!U.value.length)return;const a=U.value.filter(e=>e.type==="lab");for(const e of a){const r=await Ae(e.id);r&&await te(r.id,e.id)}}async function wt(a){if(!(!a||!R.value))try{const{lessonShares:e}=await Ne($e.lessonShares,{courseId:R.value,moduleId:Z.value?.id||null,lessonId:a},Re);pe[a]=e||[]}catch(e){console.warn("[LessonShares] fallback to metadata",e)}}async function Ct(a){if(i.value&&R.value)try{Pe[a]=!0;const e=await us(a);if(!e)return;const r=i.value.id;pe[r]=[{id:e.shareId||e.filename||`local-${Date.now()}`,kind:a,title:e.name||i.value.title,url:e.url,size:e.size,mimeType:e.mimeType},...pe[r]||[]],k.success(l(a==="resource"?"Resource added":"Attachment added"))}catch(e){console.error("[LessonShare] add failed",e),k.error(e?.message||"Upload failed")}finally{Pe[a]=!1}}return(a,e)=>{const r=p("a-alert"),c=p("a-tag"),v=p("a-badge"),m=p("a-progress"),w=p("a-tooltip"),T=p("a-select-option"),V=p("a-select"),b=p("a-button"),Y=p("a-menu-item"),Cs=p("a-menu-divider"),Ss=p("KeyboardOutlined"),St=p("a-menu"),Lt=p("a-dropdown"),z=p("a-space"),Ls=p("a-page-header"),Pt=p("a-input-search"),It=p("a-segmented"),Ut=p("a-checkbox"),K=p("a-empty"),Xe=p("a-list-item-meta"),se=p("a-list-item"),ae=p("a-list"),zt=p("a-layout-sider"),S=p("a-breadcrumb-item"),M=p("a-breadcrumb"),N=p("a-card"),Ze=p("a-col"),Nt=p("a-row"),ue=p("a-divider"),$t=p("a-result"),le=p("a-typography-paragraph"),At=p("a-collapse-panel"),Ps=p("a-collapse"),Is=p("a-checkbox-group"),me=p("a-radio"),Tt=p("a-radio-group"),Ot=p("a-input"),$=p("a-descriptions-item"),Te=p("a-descriptions"),Us=p("a-typography-text"),Oe=p("a-textarea"),J=p("a-form-item"),Fe=p("a-form"),zs=p("a-rate"),Ns=p("a-spin"),$s=p("a-layout-content"),As=p("a-step"),Ts=p("a-steps"),fe=p("a-tab-pane"),Os=p("a-avatar"),Fs=p("a-comment"),Rs=p("a-input-textarea"),Es=p("a-tabs"),Ft=p("a-layout"),Ms=p("a-upload"),Rt=p("a-drawer"),et=p("a-modal"),qs=p("a-switch"),Bs=p("a-config-provider");return d(),f(Bs,{theme:{algorithm:ve.value?L(Vt).darkAlgorithm:L(Vt).defaultAlgorithm}},{default:t(()=>[s(Ft,{class:st(["student-wrap",ve.value?"is-dark":""]),"data-test-id":"student-wrap"},{default:t(()=>[_("div",pa,[de.value?y("",!0):(d(),f(r,{key:0,type:"warning",banner:"","show-icon":"",message:"You're offline. Working in mock/local mode; changes will sync when you reconnect.","data-test-id":"offline-banner"})),ce.value?(d(),f(r,{key:1,type:"info",banner:"","show-icon":"",message:`Mock data active${he.value?` · ${he.value}`:""}`,"data-test-id":"mock-banner"},null,8,["message"])):y("",!0)]),s(Ls,{class:"page-header",title:I.title||l("Course"),"sub-title":Z.value?.title||(Ue.value?l("Choose a module"):l("Overview")),"data-test-id":"page-header"},{tags:t(()=>[s(c,{color:"blue"},{default:t(()=>[n(u(I.category||"—"),1)]),_:1}),s(c,{color:"gold"},{default:t(()=>[n(u(I.difficulty||"—"),1)]),_:1}),gt.value?(d(),f(c,{key:0,color:"blue"},{default:t(()=>[s(L(xt)),n(" "+u(gt.value)+" "+u(l("min")),1)]),_:1})):y("",!0),s(v,{status:de.value?"processing":"default",text:de.value?l("Online"):l("Offline")},null,8,["status","text"]),s(v,{status:ce.value?"warning":"success",text:ce.value?l("Mock"):l("Live"),class:"ml-1"},null,8,["status","text"])]),extra:t(()=>[s(z,{wrap:""},{default:t(()=>[s(w,{title:l("Course progress")},{default:t(()=>[s(m,{type:"circle",percent:as.value,size:32},null,8,["percent"])]),_:1},8,["title"]),Ue.value?(d(),f(V,{key:0,value:Ie.value,style:{"min-width":"220px"},placeholder:"Select module",disabled:Be.value,onChange:Ke,"data-test-id":"module-switcher"},{default:t(()=>[(d(!0),h(q,null,oe(ne.value,o=>(d(),f(T,{key:o.id,value:o.id},{default:t(()=>[n(u(o.title)+" ",1),_("span",ma,"· "+u(o.lessonCount??"—")+" "+u(l("lessons")),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])):y("",!0),s(Lt,{trigger:"click"},{overlay:t(()=>[s(St,null,{default:t(()=>[s(Y,{onClick:e[0]||(e[0]=o=>ve.value=!ve.value)},{default:t(()=>[s(L(Ys)),_("span",fa,u(l("Toggle dark")),1)]),_:1}),s(Y,{onClick:a.increaseFont},{default:t(()=>[s(L(qt)),_("span",va,u(l("Increase font size")),1)]),_:1},8,["onClick"]),s(Y,{onClick:a.decreaseFont},{default:t(()=>[s(L(qt)),_("span",ba,u(l("Decrease font size")),1)]),_:1},8,["onClick"]),s(Cs),s(Y,{onClick:e[1]||(e[1]=o=>Ve.value=!0)},{default:t(()=>[s(Ss),_("span",ga,u(l("Keyboard shortcuts")),1)]),_:1}),s(Y,{onClick:e[2]||(e[2]=o=>He.value=!0)},{default:t(()=>[s(L(Ks)),_("span",ya,u(l("Debug & mocks")),1)]),_:1})]),_:1})]),default:t(()=>[s(b,null,{icon:t(()=>[s(L(Qs))]),default:t(()=>[n(" "+u(l("View")),1)]),_:1})]),_:1}),s(b,{type:"default",onClick:e[3]||(e[3]=o=>Ge.value=!0)},{icon:t(()=>[s(L(Bt))]),default:t(()=>[n(" "+u(l("Import / Export")),1)]),_:1}),s(w,{title:l("Resume last lesson")},{default:t(()=>[s(b,{type:"primary",onClick:a.resumeLast,disabled:!U.value.length,"data-test-id":"resume-button"},{icon:t(()=>[s(L(Ws))]),default:t(()=>[n(" "+u(l("Resume")),1)]),_:1},8,["onClick","disabled"])]),_:1},8,["title"])]),_:1})]),_:1},8,["title","sub-title"]),s(Ft,null,{default:t(()=>[s(zt,{width:"320",class:"left-sider",collapsible:"",collapsed:be.value,"onUpdate:collapsed":e[8]||(e[8]=o=>be.value=o),"collapsed-width":60,"data-test-id":"left-sider"},{default:t(()=>[_("div",ka,[_("div",{class:"cover",style:Dt(ls.value),"data-test-id":"cover"},[e[48]||(e[48]=_("div",{class:"cover-gradient"},null,-1)),be.value?y("",!0):(d(),h("div",ha,[_("div",_a,u(I.title||l("Course")),1),_("div",wa,[I.category?(d(),f(c,{key:0,color:"blue"},{default:t(()=>[n(u(I.category),1)]),_:1})):y("",!0),I.difficulty?(d(),f(c,{key:1,color:"gold"},{default:t(()=>[n(u(I.difficulty),1)]),_:1})):y("",!0)])]))],4),Ue.value?(d(),f(V,{key:0,class:"mt-2",size:"small",value:Ie.value,disabled:Be.value,style:{width:"100%"},onChange:Ke,"data-test-id":"module-switcher-mini"},{default:t(()=>[(d(!0),h(q,null,oe(ne.value,o=>(d(),f(T,{key:o.id,value:o.id},{default:t(()=>[n(u(o.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])):y("",!0),s(Pt,{value:Ee.value,"onUpdate:value":e[4]||(e[4]=o=>Ee.value=o),placeholder:l("Search lessons"),"allow-clear":"",class:"mt-2","data-test-id":"lesson-search"},null,8,["value","placeholder"]),be.value?y("",!0):(d(),h("div",Ca,[s(z,{wrap:""},{default:t(()=>[s(It,{value:ge.value,"onUpdate:value":e[5]||(e[5]=o=>ge.value=o),options:[{label:l("All"),value:"all"},{label:l("Video"),value:"video"},{label:l("Reading"),value:"reading"},{label:l("Quiz"),value:"quiz"},{label:l("Assign."),value:"assignment"},{label:l("Lab"),value:"lab"}],"data-test-id":"type-filter"},null,8,["value","options"]),s(Ut,{checked:Me.value,"onUpdate:checked":e[6]||(e[6]=o=>Me.value=o),"data-test-id":"hide-completed"},{default:t(()=>[n(u(l("Hide completed")),1)]),_:1},8,["checked"]),s(Lt,{trigger:"click"},{overlay:t(()=>[s(St,{selectedKeys:ye.value,"onUpdate:selectedKeys":e[7]||(e[7]=o=>ye.value=o),onClick:ns},{default:t(()=>[s(Y,{key:"title"},{default:t(()=>[n(u(l("Title")),1)]),_:1}),s(Y,{key:"duration"},{default:t(()=>[n(u(l("Duration")),1)]),_:1}),s(Y,{key:"type"},{default:t(()=>[n(u(l("Type")),1)]),_:1})]),_:1},8,["selectedKeys"])]),default:t(()=>[s(b,{size:"small"},{default:t(()=>[s(L(Xs)),_("span",Sa,u(l("Sort")),1)]),_:1})]),_:1})]),_:1})])),ft.value?(d(),f(ae,{key:3,class:"mt-2",size:"small","data-source":os.value,"row-key":o=>o.id,"data-test-id":"lesson-list"},{renderItem:t(({item:o,index:O})=>[s(se,{class:st(["lesson-row",B.value===O&&"active"]),onClick:H=>ms(O),"data-test-id":`lesson-row-${O}`},{actions:t(()=>[D(o.id)?(d(),f(c,{key:0,color:"green"},{default:t(()=>[n(u(l("Done")),1)]),_:1})):ht(o)?(d(),f(c,{key:1,color:"red"},{default:t(()=>[s(L(Zs)),n(" "+u(l("Locked")),1)]),_:1})):o.preview?(d(),f(c,{key:2,color:"cyan"},{default:t(()=>[n(u(l("Preview")),1)]),_:1})):y("",!0)]),default:t(()=>[s(Xe,{title:o.title||l("Untitled lesson"),description:(o.type||"—")+(o.duration?` · ${o.duration} ${l("min")}`:"")},null,8,["title","description"])]),_:2},1032,["class","onClick","data-test-id"])]),_:1},8,["data-source","row-key"])):(d(),f(K,{key:2,description:l("Pick a module to see its lessons"),class:"mt-2"},null,8,["description"]))])]),_:1},8,["collapsed"]),s($s,{class:"content",style:Dt({fontSize:`${Xt.value}px`}),"data-test-id":"content"},{default:t(()=>[ft.value?(d(),f(Ns,{key:1,spinning:Be.value},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[53]||(e[53]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[54]||(e[54]=[n("Modules",-1)])]),_:1})]),_:1}),i.value?(d(),f(N,{key:0,title:i.value.title||l("Lesson"),"data-test-id":"lesson-card"},{extra:t(()=>[s(z,null,{default:t(()=>[s(c,null,{default:t(()=>[n(u((i.value.type||"").toUpperCase()),1)]),_:1}),i.value.preview?(d(),f(c,{key:0,color:"cyan"},{default:t(()=>[n(u(l("Preview")),1)]),_:1})):y("",!0),_("span",Ua,[s(L(xt)),n(" "+u(i.value.duration||0)+" "+u(l("min")),1)]),s(w,{title:l("Bookmark current lesson")},{default:t(()=>[s(b,{size:"small",onClick:a.bookmarkCurrent,"data-test-id":"bookmark-btn"},{icon:t(()=>[s(L(na))]),_:1},8,["onClick"])]),_:1},8,["title"]),s(w,{title:l("Print lesson")},{default:t(()=>[s(b,{size:"small",onClick:a.printLesson},{icon:t(()=>[s(L(ia))]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1})]),default:t(()=>[ht(i.value)&&!i.value.preview?(d(),f($t,{key:0,status:"warning",title:l("This lesson is locked"),"data-test-id":"locked-result"},{subTitle:t(()=>[_("div",za,[i.value.prerequisites?.length?(d(),h("div",Na,[n(u(l("Complete prerequisite lesson(s):"))+" ",1),_("ul",$a,[(d(!0),h(q,null,oe(i.value.prerequisites,o=>(d(),h("li",{key:o},[_("span",{class:st(["preq",D(o)&&"ok"])},[n(u(is(o)||o)+" ",1),D(o)?(d(),h(q,{key:0},[n(" ✓")],64)):y("",!0)],2)]))),128))])])):y("",!0),bt(i.value)?(d(),h("div",Aa,u(l("Unlocks at:"))+" "+u(bt(i.value)),1)):y("",!0)])]),extra:t(()=>[s(z,null,{default:t(()=>[ie.value?(d(),f(b,{key:1,onClick:a.resumeLast},{default:t(()=>[n(u(l("Go to next available")),1)]),_:1},8,["onClick"])):(d(),f(b,{key:0,type:"primary",onClick:a.mockEnroll},{default:t(()=>[n(u(l("Enroll")),1)]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["title"])):(d(),h(q,{key:1},[i.value.type==="video"?(d(),h("div",Ta,[_("div",Oa,[s(z,null,{default:t(()=>[s(It,{value:xe.value,"onUpdate:value":e[10]||(e[10]=o=>xe.value=o),options:[.75,1,1.25,1.5,1.75,2].map(o=>({label:`${o}x`,value:o})),"data-test-id":"video-speed"},null,8,["value","options"]),s(b,{size:"small",onClick:a.bookmarkTimestamp,"data-test-id":"bookmark-ts"},{default:t(()=>[s(L(ea)),n(" "+u(l("Bookmark timestamp")),1)]),_:1},8,["onClick"])]),_:1})]),vt(i.value.videoUrl)?(d(),h("div",Fa,[_("iframe",{src:vt(i.value.videoUrl),frameborder:"0",allowfullscreen:"","data-test-id":"yt-iframe"},null,8,Ra)])):(d(),h("div",Ea,[s(le,null,{default:t(()=>[n(u(l("Video URL:"))+" ",1),_("a",{href:i.value.videoUrl,target:"_blank"},u(i.value.videoUrl||"—"),9,Ma)]),_:1}),i.value.videoUrl?(d(),h("video",{key:0,ref_key:"html5Video",ref:es,controls:"",onRatechange:e[11]||(e[11]=(...o)=>a.syncVideoSpeed&&a.syncVideoSpeed(...o)),playbackRate:xe.value,style:{width:"100%","border-radius":"10px"},"data-test-id":"html5-video"},[_("source",{src:i.value.videoUrl,type:"video/mp4"},null,8,Ba)],40,qa)):y("",!0)])),s(ue,null,{default:t(()=>[n(u(l("Notes")),1)]),_:1}),s(le,{style:{"white-space":"pre-wrap"}},{default:t(()=>[n(u(i.value.content),1)]),_:1})])):i.value.type==="reading"?(d(),h("div",xa,[s(Ps,{bordered:!1,class:"reading-collapse"},{default:t(()=>[s(At,{key:"content",header:l("Lesson content")},{default:t(()=>[s(le,{style:{"white-space":"pre-wrap"}},{default:t(()=>[n(u(i.value.content||l("No content")),1)]),_:1})]),_:1},8,["header"]),s(At,{key:"highlights",header:l("Highlights")},{default:t(()=>[G[i.value.id]?.highlights?.length?(d(),f(ae,{key:1,"data-source":G[i.value.id].highlights,size:"small"},{renderItem:t(({item:o})=>[s(se,null,{default:t(()=>[n(u(o),1)]),_:2},1024)]),_:1},8,["data-source"])):(d(),f(K,{key:0,description:l("No highlights")},null,8,["description"]))]),_:1},8,["header"])]),_:1})])):i.value.type==="assignment"?(d(),h("div",Da,[s(r,{type:"info","show-icon":"",message:l("Assignment brief"),class:"mb-1"},null,8,["message"]),s(le,{style:{"white-space":"pre-wrap"}},{default:t(()=>[n(u(i.value.content||l("No brief")),1)]),_:1}),i.value.rubric?(d(),f(r,{key:0,type:"success","show-icon":"",message:l("Rubric"),description:i.value.rubric},null,8,["message","description"])):y("",!0),s(ue),s(z,null,{default:t(()=>[s(b,{type:"primary",onClick:a.openSubmitDrawer,"data-test-id":"open-submit-drawer"},{default:t(()=>[n(u(l("Submit assignment")),1)]),_:1},8,["onClick"]),s(b,{onClick:e[12]||(e[12]=o=>a.markComplete(i.value,!0)),disabled:D(i.value.id)},{default:t(()=>[n(u(l("Mark complete")),1)]),_:1},8,["disabled"])]),_:1})])):i.value.type==="quiz"?(d(),h("div",Ga,[s(r,{type:"info","show-icon":"",message:l("Answer the questions and submit."),class:"mb-2"},null,8,["message"]),(d(!0),h(q,null,oe(i.value.quiz?.questions||[],(o,O)=>(d(),h("div",{key:o.id,class:"quiz-q"},[_("b",null,"Q"+u(O+1),1),n(": "+u(o.text||l("(empty)"))+" ",1),o.type==="mcq"?(d(),h("div",ja,[s(Is,{value:a.quizState[o.id],"onUpdate:value":H=>a.quizState[o.id]=H,options:(o.options||[]).map((H,Et)=>({label:H.text||`${l("Option")} ${Et+1}`,value:Et})),"data-test-id":"quiz-mcq"},null,8,["value","onUpdate:value","options"])])):o.type==="tf"?(d(),h("div",Va,[s(Tt,{value:a.quizState[o.id],"onUpdate:value":H=>a.quizState[o.id]=H,"data-test-id":"quiz-tf"},{default:t(()=>[s(me,{value:!0},{default:t(()=>[n(u(l("True")),1)]),_:1}),s(me,{value:!1},{default:t(()=>[n(u(l("False")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])])):(d(),h("div",Ja,[s(Ot,{value:a.quizState[o.id],"onUpdate:value":H=>a.quizState[o.id]=H,placeholder:l("Your answer"),"data-test-id":"quiz-short"},null,8,["value","onUpdate:value","placeholder"])])),s(ue,{class:"my-1"})]))),128)),s(z,null,{default:t(()=>[s(b,{type:"primary",onClick:a.submitQuiz,loading:a.quizSubmitting,"data-test-id":"submit-quiz"},{default:t(()=>[n(u(l("Submit quiz")),1)]),_:1},8,["onClick","loading"]),s(b,{onClick:e[13]||(e[13]=o=>a.markComplete(i.value,!0)),disabled:D(i.value.id)},{default:t(()=>[n(u(l("Mark complete")),1)]),_:1},8,["disabled"])]),_:1})])):i.value.type==="lab"?(d(),h("div",Ha,[s(r,{type:"info","show-icon":"",message:l("Interactive lab"),description:l("Your lab environment opens in a new tab/window."),class:"mb-2"},null,8,["message","description"]),E[i.value.id]?(d(),f(N,{key:0,size:"small",class:"mb-2"},{default:t(()=>[s(Te,{bordered:"",size:"small",column:1},{default:t(()=>[s($,{label:l("Challenge")},{default:t(()=>[n(u(E[i.value.id].title),1)]),_:1},8,["label"]),s($,{label:l("Difficulty")},{default:t(()=>[n(u(E[i.value.id].difficulty),1)]),_:1},8,["label"]),E[i.value.id].description?(d(),f($,{key:0,label:l("Description")},{default:t(()=>[n(u(E[i.value.id].description),1)]),_:1},8,["label"])):y("",!0)]),_:1})]),_:1})):y("",!0),C[i.value.id]?(d(),f(N,{key:1,size:"small",class:"mb-2"},{default:t(()=>[s(Te,{bordered:"",size:"small",column:1},{default:t(()=>[s($,{label:l("Session status")},{default:t(()=>[s(c,{color:_s(C[i.value.id].status)},{default:t(()=>[n(u(C[i.value.id].status?.toUpperCase()),1)]),_:1},8,["color"])]),_:1},8,["label"]),C[i.value.id].codeServerUrl?(d(),f($,{key:0,label:l("VS Code URL")},{default:t(()=>[_("a",{href:C[i.value.id].codeServerUrl,target:"_blank"},u(C[i.value.id].codeServerUrl),9,Qa)]),_:1},8,["label"])):y("",!0)]),_:1})]),_:1})):y("",!0),F[i.value.id]?(d(),f(N,{key:2,size:"small",class:"mb-2"},{default:t(()=>[s(Te,{bordered:"",size:"small",column:1},{default:t(()=>[s($,{label:l("Latest submission")},{default:t(()=>[s(c,{color:F[i.value.id].passed?"green":"red"},{default:t(()=>[n(u(F[i.value.id].status?.toUpperCase()),1)]),_:1},8,["color"])]),_:1},8,["label"]),F[i.value.id].gradePct!=null?(d(),f($,{key:0,label:l("Grade")},{default:t(()=>[n(u(F[i.value.id].gradePct)+"% ",1)]),_:1},8,["label"])):y("",!0),F[i.value.id].feedback?(d(),f($,{key:1,label:l("Feedback")},{default:t(()=>[s(le,{style:{"white-space":"pre-wrap",margin:"0"}},{default:t(()=>[n(u(F[i.value.id].feedback),1)]),_:1})]),_:1},8,["label"])):y("",!0)]),_:1})]),_:1})):y("",!0),s(z,{wrap:""},{default:t(()=>[s(b,{type:"primary",onClick:e[14]||(e[14]=o=>We(i.value)),loading:we[i.value.id],disabled:we[i.value.id],"data-test-id":"open-lab"},ta({default:t(()=>[n(" "+u(C[i.value.id]?.codeServerUrl?l("Open VS Code"):l("Start lab session")),1)]),_:2},[C[i.value.id]?.codeServerUrl?{name:"icon",fn:t(()=>[s(L(sa))]),key:"0"}:void 0]),1032,["loading","disabled"]),C[i.value.id]?.codeServerUrl?(d(),f(b,{key:0,onClick:e[15]||(e[15]=o=>vs(i.value)),disabled:!C[i.value.id]?.codeServerUrl,"data-test-id":"open-lab-url"},{default:t(()=>[n(u(l("Open in new tab")),1)]),_:1},8,["disabled"])):y("",!0),s(b,{type:"default",onClick:e[16]||(e[16]=o=>ys(i.value)),loading:Ce[i.value.id],disabled:Ce[i.value.id]||!C[i.value.id]||C[i.value.id].status!=="running"&&C[i.value.id].status!=="starting","data-test-id":"submit-lab"},{default:t(()=>[n(u(l("Submit lab")),1)]),_:1},8,["loading","disabled"]),C[i.value.id]?.id?(d(),f(b,{key:1,onClick:e[17]||(e[17]=o=>gs(i.value)),loading:Le[i.value.id],disabled:Le[i.value.id],"data-test-id":"refresh-lab"},{icon:t(()=>[s(L(Bt))]),default:t(()=>[n(" "+u(l("Update container with saved code")),1)]),_:1},8,["loading","disabled"])):y("",!0),C[i.value.id]?.id?(d(),f(b,{key:2,onClick:e[18]||(e[18]=o=>bs(i.value)),loading:Se[i.value.id],disabled:Se[i.value.id]},{icon:t(()=>[s(L(aa))]),default:t(()=>[n(" "+u(l("Restart lab")),1)]),_:1},8,["loading","disabled"])):y("",!0),s(b,{onClick:e[19]||(e[19]=o=>a.markComplete(i.value,!0)),disabled:D(i.value.id)},{default:t(()=>[n(u(l("Mark complete")),1)]),_:1},8,["disabled"])]),_:1})])):(d(),h("div",Ya,[s(Us,{type:"secondary"},{default:t(()=>[n(u(l("Unsupported lesson type.")),1)]),_:1})]))],64)),s(ue),s(Fe,{layout:"vertical",class:"mt-2",onFinish:e[22]||(e[22]=Gt(()=>{},["prevent"]))},{default:t(()=>[s(J,{label:l("Your notes for this lesson")},{default:t(()=>[s(Oe,{value:_t(i.value.id).text,"onUpdate:value":e[20]||(e[20]=o=>_t(i.value.id).text=o),rows:4,onChange:e[21]||(e[21]=o=>a.persistNotes(i.value.id)),"data-test-id":"lesson-notes"},null,8,["value"])]),_:1},8,["label"])]),_:1}),_("div",Ka,[s(z,{wrap:""},{default:t(()=>[i.value?(d(),f(b,{key:0,type:D(i.value.id)?"default":"primary",onClick:e[23]||(e[23]=o=>a.toggleComplete(i.value)),"data-test-id":"toggle-complete"},{icon:t(()=>[s(L(la))]),default:t(()=>[n(" "+u(D(i.value.id)?l("Mark as incomplete"):l("Mark as complete")),1)]),_:1},8,["type"])):y("",!0),s(b,{onClick:a.prevLesson,disabled:B.value<=0,"data-test-id":"prev-lesson"},{default:t(()=>[n(u(l("Previous")),1)]),_:1},8,["onClick","disabled"]),s(b,{type:"primary",onClick:a.nextLesson,disabled:B.value>=U.value.length-1,"data-test-id":"next-lesson"},{default:t(()=>[n(u(l("Next"))+" ",1),s(L(oa))]),_:1},8,["onClick","disabled"]),s(Ut,{checked:rt.value,"onUpdate:checked":e[24]||(e[24]=o=>rt.value=o),class:"ml-2","data-test-id":"auto-next"},{default:t(()=>[n(u(l("Auto-next on complete")),1)]),_:1},8,["checked"])]),_:1}),s(zs,{value:pt[i.value.id],"onUpdate:value":e[25]||(e[25]=o=>pt[i.value.id]=o),"allow-half":"",onChange:a.persistRatings},null,8,["value","onChange"])])]),_:1},8,["title"])):(d(),f(K,{key:1,description:l("No lessons found")},null,8,["description"]))]),_:1},8,["spinning"])):(d(),h(q,{key:0},[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[49]||(e[49]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[50]||(e[50]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{loading:ut.value,title:l("Course overview"),"data-test-id":"overview-card"},{default:t(()=>[_("p",La,u(l("Browse modules and jump in — everything runs in this page.")),1),!Ue.value&&!ut.value?(d(),f(K,{key:0,description:l("No modules yet")},null,8,["description"])):(d(),f(Nt,{key:1,gutter:16},{default:t(()=>[(d(!0),h(q,null,oe(ne.value,o=>(d(),f(Ze,{key:o.id,xs:24,sm:12,md:8},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[51]||(e[51]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[52]||(e[52]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{hoverable:"",class:"mt-2",onClick:O=>Ke(o.id),"data-test-id":"module-card"},{default:t(()=>[_("b",null,u(o.title),1),_("div",Pa,[n(u(o.lessonCount??0)+" "+u(l("lessons"))+" ",1),o.minutes?(d(),h(q,{key:0},[n(" · ~"+u(o.minutes)+" "+u(l("min")),1)],64)):y("",!0)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),s(ue),ie.value?y("",!0):(d(),h("div",Ia,[s($t,{status:"info",title:l("Enroll to unlock full access"),"sub-title":l("You can still watch previews and read public materials.")},{extra:t(()=>[s(z,null,{default:t(()=>[s(b,{type:"primary",onClick:a.mockEnroll},{default:t(()=>[n(u(l("Enroll now")),1)]),_:1},8,["onClick"]),s(b,{onClick:e[9]||(e[9]=o=>Je.value=!0)},{default:t(()=>[n(u(l("See pricing")),1)]),_:1})]),_:1})]),_:1},8,["title","sub-title"])]))]),_:1},8,["loading","title"])],64))]),_:1},8,["style"]),s(zt,{width:"320",class:"right-sider",collapsible:"",collapsed:nt.value,"onUpdate:collapsed":e[35]||(e[35]=o=>nt.value=o),"collapsed-width":60,"data-test-id":"right-sider"},{default:t(()=>[_("div",Wa,[s(Es,{activeKey:it.value,"onUpdate:activeKey":e[34]||(e[34]=o=>it.value=o),size:"small",animated:!1},{default:t(()=>[s(fe,{key:"progress",tab:l("Progress"),"data-test-id":"tab-progress"},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[55]||(e[55]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[56]||(e[56]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{size:"small",title:l("Progress"),bordered:!1,"body-style":"padding:0;"},{default:t(()=>[s(Ts,{size:"small",direction:"vertical",current:B.value},{default:t(()=>[(d(!0),h(q,null,oe(U.value,(o,O)=>(d(),f(As,{key:o.id,title:o.title||`${l("Lesson")} ${O+1}`,description:o.duration?`${o.duration} ${l("min")}`:"",status:D(o.id)?"finish":O===B.value?"process":"wait"},null,8,["title","description","status"]))),128))]),_:1},8,["current"])]),_:1},8,["title"])]),_:1},8,["tab"]),s(fe,{key:"resources",tab:l("Resources")},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[57]||(e[57]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[58]||(e[58]=[n("Modules",-1)])]),_:1})]),_:1}),i.value?(d(),f(N,{key:0,size:"small",title:l("Resources"),class:"mt-2"},{default:t(()=>[ie.value?(d(),h("div",Xa,[s(b,{size:"small",type:"primary",onClick:e[26]||(e[26]=o=>Ct("resource")),loading:Pe.resource},{default:t(()=>[n(u(l("Add resource")),1)]),_:1},8,["loading"])])):y("",!0),yt.value.length?(d(),f(ae,{key:2,size:"small","data-source":yt.value},{renderItem:t(({item:o})=>[s(se,null,{default:t(()=>[_("a",{href:o.url,target:"_blank"},u(o.title||o.name||l("Resource")),9,Za)]),_:2},1024)]),_:1},8,["data-source"])):(d(),f(K,{key:1,description:l("No resources")},null,8,["description"]))]),_:1},8,["title"])):y("",!0),s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[59]||(e[59]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[60]||(e[60]=[n("Modules",-1)])]),_:1})]),_:1}),i.value?(d(),f(N,{key:1,size:"small",class:"mt-2",title:l("Attachments")},{default:t(()=>[ie.value?(d(),h("div",el,[s(b,{size:"small",type:"primary",onClick:e[27]||(e[27]=o=>Ct("attachment")),loading:Pe.attachment},{default:t(()=>[n(u(l("Add attachment")),1)]),_:1},8,["loading"])])):y("",!0),kt.value.length?(d(),f(ae,{key:2,size:"small","data-source":kt.value},{renderItem:t(({item:o})=>[s(se,null,{default:t(()=>[_("a",{href:o.url,target:"_blank"},u(o.name||l("Attachment")),9,tl)]),_:2},1024)]),_:1},8,["data-source"])):(d(),f(K,{key:1,description:l("No attachments")},null,8,["description"]))]),_:1},8,["title"])):y("",!0)]),_:1},8,["tab"]),s(fe,{key:"notes",tab:l("Notes")},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[61]||(e[61]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[62]||(e[62]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{size:"small",title:l("Your notes"),class:"mt-2"},{default:t(()=>[s(Fe,{layout:"vertical",onFinish:e[31]||(e[31]=Gt(()=>{},["prevent"]))},{default:t(()=>[s(J,{label:l("Lesson notes")},{default:t(()=>[s(Oe,{value:G[i.value?.id||"global"].text,"onUpdate:value":e[28]||(e[28]=o=>G[i.value?.id||"global"].text=o),rows:6,onChange:e[29]||(e[29]=o=>i.value&&a.persistNotes(i.value.id)),"data-test-id":"notes-right"},null,8,["value"])]),_:1},8,["label"]),s(J,{label:l("Highlights")},{default:t(()=>[s(Pt,{value:dt.value,"onUpdate:value":e[30]||(e[30]=o=>dt.value=o),placeholder:l("Type highlight and press +"),"enter-button":"+",onSearch:a.addHighlight},null,8,["value","placeholder","onSearch"]),G[i.value?.id||"global"].highlights.length?(d(),f(ae,{key:1,"data-source":G[i.value?.id||"global"].highlights,size:"small",class:"mt-1"},{renderItem:t(({item:o,index:O})=>[s(se,null,{default:t(()=>[s(z,null,{default:t(()=>[_("span",null,u(o),1),s(b,{size:"small",onClick:H=>a.removeHighlight(O)},{default:t(()=>[n(u(l("Remove")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])):(d(),f(K,{key:0,description:l("No highlights"),class:"mt-1"},null,8,["description"]))]),_:1},8,["label"])]),_:1})]),_:1},8,["title"])]),_:1},8,["tab"]),s(fe,{key:"qa",tab:l("Q&A")},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[63]||(e[63]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[64]||(e[64]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{size:"small",title:l("Questions & Answers"),class:"mt-2"},{default:t(()=>[(d(!0),h(q,null,oe(a.qaForCurrent,o=>(d(),f(Fs,{key:o.id,author:o.author,content:o.text,datetime:o.when},{avatar:t(()=>[s(Os,{src:o.avatar},null,8,["src"])]),_:2},1032,["author","content","datetime"]))),128)),s(ue),s(Rs,{value:ke.value,"onUpdate:value":e[32]||(e[32]=o=>ke.value=o),rows:3,placeholder:l("Ask a question"),"data-test-id":"qa-input"},null,8,["value","placeholder"]),s(z,{class:"mt-1"},{default:t(()=>[s(b,{size:"small",onClick:a.submitQA,disabled:!ke.value.trim()},{default:t(()=>[n(u(l("Post")),1)]),_:1},8,["onClick","disabled"]),s(b,{size:"small",onClick:e[33]||(e[33]=o=>ke.value="")},{default:t(()=>[n(u(l("Clear")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["tab"]),s(fe,{key:"bookmarks",tab:l("Bookmarks")},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[65]||(e[65]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[66]||(e[66]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{size:"small",title:l("Bookmarks"),class:"mt-2"},{default:t(()=>[ct.length?(d(),f(ae,{key:1,"data-source":ct,size:"small"},{renderItem:t(({item:o,index:O})=>[s(se,{actions:[jt("a",{onClick:()=>a.jumpToBookmark(o)},l("Go")),jt("a",{onClick:()=>a.removeBookmark(O)},l("Remove"))]},{default:t(()=>[s(Xe,{title:o.title,description:o.description},null,8,["title","description"])]),_:2},1032,["actions"])]),_:1},8,["data-source"])):(d(),f(K,{key:0,description:l("No bookmarks yet")},null,8,["description"]))]),_:1},8,["title"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])])]),_:1},8,["collapsed"])]),_:1}),s(Rt,{open:Qe.value,"onUpdate:open":e[39]||(e[39]=o=>Qe.value=o),title:l("Submit assignment"),placement:"right",width:"420","data-test-id":"submit-drawer"},{default:t(()=>[s(Fe,{layout:"vertical",onFinish:a.submitAssignment},{default:t(()=>[s(J,{label:l("Notes")},{default:t(()=>[s(Oe,{value:_e.notes,"onUpdate:value":e[36]||(e[36]=o=>_e.notes=o),rows:4},null,8,["value"])]),_:1},8,["label"]),s(J,{label:l("Link to work (URL)")},{default:t(()=>[s(Ot,{value:_e.url,"onUpdate:value":e[37]||(e[37]=o=>_e.url=o),placeholder:"https://…"},null,8,["value"])]),_:1},8,["label"]),s(J,{label:l("Attach files (mock)")},{default:t(()=>[s(Ms,{"before-upload":()=>!1,multiple:""},{default:t(()=>[s(b,null,{default:t(()=>[s(L(ra)),n(" "+u(l("Click to attach")),1)]),_:1})]),_:1})]),_:1},8,["label"]),s(z,null,{default:t(()=>[s(b,{onClick:e[38]||(e[38]=o=>Qe.value=!1)},{default:t(()=>[n(u(l("Cancel")),1)]),_:1}),s(b,{type:"primary","html-type":"submit",loading:ss.value},{default:t(()=>[n(u(l("Submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onFinish"])]),_:1},8,["open","title"]),s(et,{open:Ge.value,"onUpdate:open":e[42]||(e[42]=o=>Ge.value=o),title:l("Import / Export progress"),footer:null,width:"720"},{default:t(()=>[s(Nt,{gutter:16},{default:t(()=>[s(Ze,{span:12},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[67]||(e[67]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[68]||(e[68]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{title:l("Export"),size:"small"},{default:t(()=>[s(le,null,{default:t(()=>[n(u(l("Download your progress as JSON.")),1)]),_:1}),s(b,{type:"primary",onClick:a.exportProgress},{default:t(()=>[n(u(l("Export JSON")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1}),s(Ze,{span:12},{default:t(()=>[s(M,{class:"mb-3"},{default:t(()=>[s(S,{to:"/students"},{default:t(()=>[...e[69]||(e[69]=[n("Students",-1)])]),_:1}),s(S,null,{default:t(()=>[...e[70]||(e[70]=[n("Modules",-1)])]),_:1})]),_:1}),s(N,{title:l("Import"),size:"small"},{default:t(()=>[s(le,null,{default:t(()=>[n(u(l("Paste JSON below and import.")),1)]),_:1}),s(Oe,{value:je.value,"onUpdate:value":e[40]||(e[40]=o=>je.value=o),rows:8},null,8,["value"]),s(z,{class:"mt-1"},{default:t(()=>[s(b,{onClick:e[41]||(e[41]=o=>je.value="")},{default:t(()=>[n(u(l("Clear")),1)]),_:1}),s(b,{type:"primary",onClick:a.importProgress},{default:t(()=>[n(u(l("Import")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1},8,["open","title"]),s(et,{open:Ve.value,"onUpdate:open":e[43]||(e[43]=o=>Ve.value=o),title:l("Keyboard shortcuts"),footer:null,width:"520"},{default:t(()=>[s(Te,{bordered:"",size:"small",column:1},{default:t(()=>[s($,{label:l("Next lesson")},{default:t(()=>[...e[71]||(e[71]=[n("N",-1)])]),_:1},8,["label"]),s($,{label:l("Previous lesson")},{default:t(()=>[...e[72]||(e[72]=[n("P",-1)])]),_:1},8,["label"]),s($,{label:l("Toggle complete")},{default:t(()=>[...e[73]||(e[73]=[n("C",-1)])]),_:1},8,["label"]),s($,{label:l("Resume last")},{default:t(()=>[...e[74]||(e[74]=[n("R",-1)])]),_:1},8,["label"]),s($,{label:l("Search lessons")},{default:t(()=>[...e[75]||(e[75]=[n("/",-1)])]),_:1},8,["label"]),s($,{label:l("Toggle dark")},{default:t(()=>[...e[76]||(e[76]=[n("D",-1)])]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"]),s(et,{open:Je.value,"onUpdate:open":e[45]||(e[45]=o=>Je.value=o),title:l("Pricing"),"ok-text":l("Enroll"),onOk:a.mockEnroll},{default:t(()=>[s(Tt,{value:mt.value,"onUpdate:value":e[44]||(e[44]=o=>mt.value=o)},{default:t(()=>[s(me,{value:"basic"},{default:t(()=>[n(u(l("Basic · Free preview")),1)]),_:1}),s(me,{value:"pro"},{default:t(()=>[n(u(l("Pro · Full course + certificate")),1)]),_:1}),s(me,{value:"team"},{default:t(()=>[n(u(l("Team · Up to 10 seats")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["open","title","ok-text","onOk"]),s(Rt,{open:He.value,"onUpdate:open":e[47]||(e[47]=o=>He.value=o),title:l("Debug & mocks"),placement:"left",width:"420"},{default:t(()=>[s(Fe,{layout:"vertical"},{default:t(()=>[s(J,{label:l("Force mock mode")},{default:t(()=>[s(qs,{checked:De.value,"onUpdate:checked":e[46]||(e[46]=o=>De.value=o)},null,8,["checked"])]),_:1},8,["label"]),s(J,{label:l("Clear local data")},{default:t(()=>[s(b,{danger:"",onClick:a.clearLocal},{default:t(()=>[n(u(l("Clear")),1)]),_:1},8,["onClick"])]),_:1},8,["label"]),s(J,{label:l("Telemetry (session)")},{default:t(()=>[s(ae,{"data-source":ts,size:"small","item-layout":"horizontal"},{renderItem:t(({item:o})=>[s(se,null,{default:t(()=>[s(Xe,{title:o.when,description:o.what},null,8,["title","description"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"])]),_:1},8,["class"])]),_:1},8,["theme"])}}}),rl=da(al,[["__scopeId","data-v-6d06c401"]]);export{rl as default};
