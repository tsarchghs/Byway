import{g as F,U as J,W as K,r as n,k as W,q as B,w as o,p as r,bM as g,o as _,b as t,x as Y,a as u,K as G,d as y,c as C,I as H,J as Q,ag as X,t as w,m as T}from"./DQDUwbr-.js";const Z={class:"mb-4 flex flex-wrap gap-2 items-center"},ee={class:"grid md:grid-cols-2 gap-4"},ae=["onDragstart","onDrop"],te={class:"flex items-center justify-between"},le={class:"flex gap-2 mb-2"},re=F({__name:"admin",setup(ne){const h=J(),p=K().public?.apiBase||"http://localhost:4000",i=n(null),d=n([]),b=n(!1),S=n(null);function R(a){S.value=a}function M(a){const e=S.value;if(e===null||e===a)return;const s=d.value.splice(e,1)[0];d.value.splice(a,0,s),b.value=!0}async function U(){const e=await g(`${p}/api/teach-internal/graphql`,{method:"POST",body:{query:"query($id:String!){ moduleById(id:$id){ id title } }",variables:{id:String(h.params.id)}}});i.value=e.data?.moduleById??null}async function k(){if(!i.value)return;const e=await g(`${p}/api/teach-internal/graphql`,{method:"POST",body:{query:"query($moduleId:String!){ lessonsByModule(moduleId:$moduleId){ id title position } }",variables:{moduleId:i.value.id}}});d.value=e.data?.lessonsByModule??[]}async function D(){const a=d.value.map(s=>s.id);await g(`${p}/api/teach-internal/graphql`,{method:"POST",body:{query:"mutation($moduleId:String!,$ids:[String!]!){ reorderLessons(moduleId:$moduleId, ids:$ids) }",variables:{moduleId:i.value.id,ids:a}}}),b.value=!1,await k()}const x=n([]),c=n(""),m=n("");function N(){c.value&&m.value&&(x.value.unshift({name:c.value,url:m.value}),c.value="",m.value="")}function O({item:a}){return T("a-list-item",{},[T("a",{href:a.url,target:"_blank"},a.name)])}const v=n(""),I=n(null);async function A(){if(!v.value){I.value=null;return}const e=await g(`${p}/api/authentication/graphql`,{method:"POST",body:{query:"query($userId:String!,$institutionId:String!,$role:String!){ hasRole(userId:$userId,institutionId:$institutionId,role:$role) }",variables:{userId:v.value,institutionId:String(h.params.id),role:"Teacher"}}});I.value=!!e?.data?.hasRole}async function L(){await U(),await k()}return W(L),(a,e)=>{const s=r("a-input"),$=r("a-button"),P=r("a-alert"),V=r("a-tag"),q=r("a-card"),z=r("a-list"),j=r("a-layout");return _(),B(j,{class:"p-6"},{default:o(()=>[t(q,{title:`Module Admin · ${i.value?.title||Y(h).params.id}`,bordered:!1},{default:o(()=>[u("div",Z,[t(s,{value:v.value,"onUpdate:value":e[0]||(e[0]=l=>v.value=l),placeholder:"Your userId (for roles)",style:{"max-width":"260px"}},null,8,["value"]),t($,{onClick:A},{default:o(()=>[...e[4]||(e[4]=[y("Check Teacher Access",-1)])]),_:1}),t($,{type:"primary",onClick:D,disabled:!b.value},{default:o(()=>[...e[5]||(e[5]=[y("Save Order",-1)])]),_:1},8,["disabled"])]),I.value===!1?(_(),B(P,{key:0,type:"warning",message:"Access denied: Teacher/Admin role required","show-icon":"",class:"mb-3"})):G("",!0),u("div",ee,[t(q,{title:"Lessons (drag to reorder)",size:"small"},{default:o(()=>[u("ul",null,[(_(!0),C(H,null,Q(d.value,(l,f)=>(_(),C("li",{key:l.id,draggable:"true",onDragstart:E=>R(f),onDragover:e[1]||(e[1]=X(()=>{},["prevent"])),onDrop:E=>M(f),class:"p-2 border rounded mb-2 bg-white"},[u("div",te,[u("span",null,"#"+w(f+1)+" · "+w(l.title),1),t(V,null,{default:o(()=>[y(w(l.position??f),1)]),_:2},1024)])],40,ae))),128))])]),_:1}),t(q,{title:"Resources",size:"small"},{default:o(()=>[u("div",le,[t(s,{value:c.value,"onUpdate:value":e[2]||(e[2]=l=>c.value=l),placeholder:"Name",style:{"max-width":"200px"}},null,8,["value"]),t(s,{value:m.value,"onUpdate:value":e[3]||(e[3]=l=>m.value=l),placeholder:"URL",style:{"min-width":"260px"}},null,8,["value"]),t($,{onClick:N},{default:o(()=>[...e[6]||(e[6]=[y("Add",-1)])]),_:1})]),t(z,{"data-source":x.value,renderItem:O},null,8,["data-source"])]),_:1})])]),_:1},8,["title"])]),_:1})}}});export{re as default};
