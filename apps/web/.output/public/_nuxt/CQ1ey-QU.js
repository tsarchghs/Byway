import{u as ut}from"./CI-SnmTa.js";import{g as rt,r as c,W as dt,ar as ct,k as vt,n as h,l as L,c as T,a as o,b as e,w as n,q as z,I as P,p as u,o as $,d as r,x as I,aA as pt,G as mt,t as d,b2 as ft,J as gt,L as _t,K as yt,af as ht,as as $t,_ as bt}from"./DQDUwbr-.js";const St={class:"inst-shell"},kt={class:"top-bar"},It={class:"top-actions"},wt={class:"stat-value"},Ct={class:"stat-value"},xt={class:"stat-value"},Ut={class:"stat-value"},Ot={class:"section"},At={class:"card-head"},Et={class:"card-title"},Nt={class:"card-sub"},qt={class:"card-body"},Dt={class:"row"},Lt={key:0,class:"row"},Tt={class:"row"},zt={class:"row"},Bt={class:"card-actions"},jt={class:"mt-4 flex justify-center"},Mt={class:"ml-2"},Jt=rt({__name:"index",setup(Pt){const _=c([]),b=c(""),w=c(""),S=c(!1),v=c(null),k=c(1),A=c(12),f=c(!1),E=dt().public?.apiBase||"http://localhost:4000",C=c(!1),R=ct(),{token:V}=ut();function N(){const l=V?.value||(typeof window<"u"?localStorage.getItem("token"):"");return l?{Authorization:`Bearer ${l}`}:{}}const i=c({name:"",type:"University",location:"",email:"",phone:"",active:!0});vt(()=>{x();const l=localStorage.getItem("isDarkMode");l&&(f.value=JSON.parse(l),j())});async function x(){try{C.value=!0;const s=(await(await fetch(`${E}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",...N()},body:JSON.stringify({query:`query {
          institutions {
            id name type location email phone active
            departments { id name }
            classrooms { id }
            members { id role }
          }
        }`})})).json())?.data?.institutions||[];_.value=s}catch(l){console.warn("[institutions] load failed",l),h.error("Unable to load institutions")}finally{C.value=!1}}const q=L(()=>_.value.filter(l=>{const t=!b.value||l.name.toLowerCase().includes(b.value.toLowerCase())||l.location.toLowerCase().includes(b.value.toLowerCase()),s=!w.value||(w.value==="active"?l.active:!l.active);return t&&s})),F=L(()=>{const l=(k.value-1)*A.value,t=l+A.value;return q.value.slice(l,t)}),G=L(()=>_.value.reduce((l,t)=>l+(t.departments?.reduce((s,p)=>s+(p.studentCount||0),0)||0),0));function H(){v.value=null,B(),S.value=!0}function K(l){R.push(l)}function Q(){x()}function W(){k.value=1}function X(){k.value=1}function Y(l){v.value=l,i.value={...l},S.value=!0}function Z(){if(!i.value.name.trim()){h.error("Institution name is required");return}const l=v.value?`mutation($id:String!,$name:String,$slug:String,$type:String,$location:String,$email:String,$phone:String,$active:Boolean){
        updateInstitution(id:$id,name:$name,slug:$slug,type:$type,location:$location,email:$email,phone:$phone,active:$active){ id }
      }`:`mutation($name:String!,$slug:String!,$type:String,$location:String,$email:String,$phone:String,$active:Boolean){
        createInstitution(name:$name,slug:$slug,type:$type,location:$location,email:$email,phone:$phone,active:$active){ id }
      }`,t={...i.value};v.value&&(t.id=v.value.id),t.slug||(t.slug=i.value.name.toLowerCase().replace(/\s+/g,"-")),fetch(`${E}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",...N()},body:JSON.stringify({query:l,variables:t})}).then(s=>s.json()).then(s=>{if(s.errors?.length)throw new Error(s.errors[0].message);h.success(v.value?"Institution updated":"Institution created"),S.value=!1,v.value=null,B(),x()}).catch(s=>{h.error(s?.message||"Unable to save institution")})}function tt(l){fetch(`${E}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",...N()},body:JSON.stringify({query:"mutation($id:String!){ updateInstitution(id:$id, active:false){ id active } }",variables:{id:l}})}).then(s=>s.json()).then(s=>{if(s.errors?.length)throw new Error(s.errors[0].message);h.success("Institution archived"),x()}).catch(s=>h.error(s?.message||"Unable to archive"))}function B(){i.value={name:"",type:"University",location:"",email:"",phone:"",active:!0}}function et(){f.value=!f.value,j(),localStorage.setItem("isDarkMode",JSON.stringify(f.value))}function j(){const l=document.documentElement;f.value?l.classList.add("dark"):l.classList.remove("dark")}return(l,t)=>{const s=u("a-button"),p=u("a-card"),m=u("a-col"),D=u("a-row"),at=u("a-input-search"),g=u("a-select-option"),M=u("a-select"),J=u("a-switch"),nt=u("a-empty"),ot=u("a-tag"),lt=u("a-pagination"),U=u("a-input"),y=u("a-form-item"),st=u("a-form"),it=u("a-modal");return $(),T(P,null,[o("div",St,[o("div",kt,[t[13]||(t[13]=o("div",{class:"top-left"},[o("div",{class:"title"},"Institutions"),o("div",{class:"subtitle"},"Manage institutions, departments, and classrooms")],-1)),o("div",It,[e(s,{onClick:Q,loading:C.value,ghost:""},{icon:n(()=>[e(I(pt))]),default:n(()=>[t[11]||(t[11]=r(" Refresh ",-1))]),_:1},8,["loading"]),e(s,{type:"primary",onClick:H},{icon:n(()=>[e(I(mt))]),default:n(()=>[t[12]||(t[12]=r(" Add Institution ",-1))]),_:1})])]),e(D,{gutter:16,class:"section"},{default:n(()=>[e(m,{xs:12,md:6},{default:n(()=>[e(p,{class:"stat-card",bordered:""},{default:n(()=>[t[14]||(t[14]=o("div",{class:"stat-label"},"Total Institutions",-1)),o("div",wt,d(_.value.length),1)]),_:1})]),_:1}),e(m,{xs:12,md:6},{default:n(()=>[e(p,{class:"stat-card",bordered:""},{default:n(()=>[t[15]||(t[15]=o("div",{class:"stat-label"},"Active",-1)),o("div",Ct,d(_.value.filter(a=>a.active).length),1)]),_:1})]),_:1}),e(m,{xs:12,md:6},{default:n(()=>[e(p,{class:"stat-card",bordered:""},{default:n(()=>[t[16]||(t[16]=o("div",{class:"stat-label"},"Departments",-1)),o("div",xt,d(_.value.reduce((a,O)=>a+(O.departments?.length||0),0)),1)]),_:1})]),_:1}),e(m,{xs:12,md:6},{default:n(()=>[e(p,{class:"stat-card",bordered:""},{default:n(()=>[t[17]||(t[17]=o("div",{class:"stat-label"},"Students (est.)",-1)),o("div",Ut,d(G.value),1)]),_:1})]),_:1})]),_:1}),e(p,{class:"section",bordered:""},{default:n(()=>[e(D,{gutter:12},{default:n(()=>[e(m,{xs:24,md:12},{default:n(()=>[e(at,{value:b.value,"onUpdate:value":t[0]||(t[0]=a=>b.value=a),placeholder:"Search by name or location",onSearch:W},{prefix:n(()=>[e(I(ft))]),_:1},8,["value"])]),_:1}),e(m,{xs:12,md:6},{default:n(()=>[e(M,{value:w.value,"onUpdate:value":t[1]||(t[1]=a=>w.value=a),style:{width:"100%"},onChange:X},{default:n(()=>[e(g,{value:""},{default:n(()=>[...t[18]||(t[18]=[r("All Status",-1)])]),_:1}),e(g,{value:"active"},{default:n(()=>[...t[19]||(t[19]=[r("Active",-1)])]),_:1}),e(g,{value:"inactive"},{default:n(()=>[...t[20]||(t[20]=[r("Inactive",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(m,{xs:12,md:6,class:"flex justify-end"},{default:n(()=>[e(J,{checked:f.value,"onUpdate:checked":t[2]||(t[2]=a=>f.value=a),onChange:et},null,8,["checked"]),t[21]||(t[21]=o("span",{class:"ml-2"},"Dark mode",-1))]),_:1})]),_:1})]),_:1}),o("div",Ot,[!C.value&&q.value.length===0?($(),z(nt,{key:0,description:"No institutions found"})):($(),z(D,{key:1,gutter:[16,16]},{default:n(()=>[($(!0),T(P,null,gt(F.value,a=>($(),z(m,{key:a.id,xs:24,sm:12,lg:8},{default:n(()=>[e(p,{class:_t(["inst-card",{inactive:a.active===!1}]),bordered:"",hoverable:""},{default:n(()=>[o("div",At,[o("div",null,[o("div",Et,d(a.name),1),o("div",Nt,d(a.location||"No location"),1)]),e(ot,{color:a.active?"green":"red"},{default:n(()=>[r(d(a.active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),o("div",qt,[o("div",Dt,[t[22]||(t[22]=o("span",null,"Type",-1)),o("strong",null,d(a.type||"—"),1)]),a.email||a.phone?($(),T("div",Lt,[t[23]||(t[23]=o("span",null,"Contact",-1)),o("strong",null,d(a.email||a.phone||"—"),1)])):yt("",!0),o("div",Tt,[t[24]||(t[24]=o("span",null,"Departments",-1)),o("strong",null,d(a.departments?.length||0),1)]),o("div",zt,[t[25]||(t[25]=o("span",null,"Members",-1)),o("strong",null,d(a.members?.length||0),1)])]),o("div",Bt,[e(s,{type:"text",size:"small",onClick:O=>Y(a)},{default:n(()=>[e(I(ht)),t[26]||(t[26]=r(" Edit ",-1))]),_:1},8,["onClick"]),e(s,{type:"text",size:"small",danger:"",onClick:O=>tt(a.id)},{default:n(()=>[e(I($t)),t[27]||(t[27]=r(" Archive ",-1))]),_:1},8,["onClick"]),e(s,{type:"primary",size:"small",onClick:O=>K(`/institutions/${a.id}`)},{default:n(()=>[...t[28]||(t[28]=[r(" Open ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),o("div",jt,[e(lt,{current:k.value,"onUpdate:current":t[3]||(t[3]=a=>k.value=a),total:q.value.length,"page-size":A.value,"show-size-changer":"","show-total":a=>`Total ${a} institutions`},null,8,["current","total","page-size","show-total"])])])]),e(it,{open:S.value,"onUpdate:open":t[10]||(t[10]=a=>S.value=a),title:v.value?"Edit Institution":"Add Institution","ok-text":"Save","cancel-text":"Cancel",onOk:Z},{default:n(()=>[e(st,{layout:"vertical"},{default:n(()=>[e(y,{label:"Institution Name",required:""},{default:n(()=>[e(U,{value:i.value.name,"onUpdate:value":t[4]||(t[4]=a=>i.value.name=a),placeholder:"Enter institution name"},null,8,["value"])]),_:1}),e(y,{label:"Type",required:""},{default:n(()=>[e(M,{value:i.value.type,"onUpdate:value":t[5]||(t[5]=a=>i.value.type=a)},{default:n(()=>[e(g,{value:"University"},{default:n(()=>[...t[29]||(t[29]=[r("University",-1)])]),_:1}),e(g,{value:"College"},{default:n(()=>[...t[30]||(t[30]=[r("College",-1)])]),_:1}),e(g,{value:"Academy"},{default:n(()=>[...t[31]||(t[31]=[r("Academy",-1)])]),_:1}),e(g,{value:"Institute"},{default:n(()=>[...t[32]||(t[32]=[r("Institute",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(y,{label:"Location"},{default:n(()=>[e(U,{value:i.value.location,"onUpdate:value":t[6]||(t[6]=a=>i.value.location=a),placeholder:"Enter location"},null,8,["value"])]),_:1}),e(y,{label:"Email"},{default:n(()=>[e(U,{value:i.value.email,"onUpdate:value":t[7]||(t[7]=a=>i.value.email=a),type:"email",placeholder:"Enter email"},null,8,["value"])]),_:1}),e(y,{label:"Phone"},{default:n(()=>[e(U,{value:i.value.phone,"onUpdate:value":t[8]||(t[8]=a=>i.value.phone=a),placeholder:"Enter phone number"},null,8,["value"])]),_:1}),e(y,{label:"Status"},{default:n(()=>[e(J,{checked:i.value.active,"onUpdate:checked":t[9]||(t[9]=a=>i.value.active=a)},null,8,["checked"]),o("span",Mt,d(i.value.active?"Active":"Inactive"),1)]),_:1})]),_:1})]),_:1},8,["open","title"])],64)}}}),Ft=bt(Jt,[["__scopeId","data-v-32edecf0"]]);export{Ft as default};
