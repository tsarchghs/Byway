import{g as ut,U as dt,W as ct,l as T,r as d,k as E,ad as H,c as W,b as t,w as e,n as mt,p as s,o as w,q as U,K as $,a as c,d as _,t as y,_ as pt}from"./DQDUwbr-.js";const _t={class:"institution-cockpit"},ft=["href"],vt=["href"],ht=["href"],yt=["href"],gt=["href"],bt=["href"],wt=["href"],It={class:"row-item"},kt={class:"row-title"},Ct={class:"row-meta"},$t=["href"],xt=ut({__name:"index",setup(St){function h(n){const a=`?institutionId=${encodeURIComponent(g.value)}`,o=S.value[0]?.id,f=S.value.find(m=>m.departmentId)?.departmentId;return n==="overview"?`/institution/portal${a}`:n==="departments"?f?`/institution/departments/${encodeURIComponent(f)}${a}`:`/institution/portal${a}`:n==="classrooms"?o?`/institution/classrooms/${encodeURIComponent(o)}${a}`:`/institution/portal${a}`:n==="people"?`/institution/people${a}`:n==="catalog"?`/institution/catalog${a}`:n==="calendar"?`/institution/calendar${a}`:n==="assignments"?`/institution/assignments/teachers${a}`:`/institution/portal${a}`}const F=["student","teacher","admin"],B=dt(),j=ct(),x=j.public?.apiBase||j.public?.appBaseUrl||"",g=T(()=>B.query.institutionId||B.params?.institution_id||"inst_byway"),i=d("student"),l=d("none"),Q=d(null),O=d("overview"),A=d(!0),I=d(null),k=d({departments:0,classrooms:0,members:0}),S=d([]),J=d([]),K=d([]),L=d([]);function M(){if(typeof window>"u")return null;const n=localStorage.getItem("token")||localStorage.getItem("access_token")||"";return n?n.startsWith("Bearer")?n:`Bearer ${n}`:null}const G=T(()=>"Institution Portal"),X=T(()=>i.value.charAt(0).toUpperCase()+i.value.slice(1)),Y=T(()=>i.value==="student"?"Student Dashboard":i.value==="teacher"?"Teacher Dashboard":"Admin Dashboard");async function z(){A.value=!0;try{const n=M();if(!n)throw new Error("Missing auth token");const a=x?x.replace(/\/$/,""):"",o=i.value==="student"?"/api/institution-portal/student-dashboard":i.value==="teacher"?"/api/institution-portal/teacher-dashboard":"/api/institution-portal/admin-dashboard",f=new URLSearchParams;f.set("institutionId",g.value);const m=`${a}${o}?${f.toString()}`,u=await fetch(m,{headers:{Authorization:n}});if(!u.ok)throw new Error(await u.text().catch(()=>`HTTP ${u.status}`));const r=await u.json();I.value=r.institution||null,k.value=r.stats||k.value,S.value=r.classrooms||[],J.value=r.courses||[],K.value=r.assignments||[],L.value=r.overview||[]}catch(n){mt.error(n?.message||"Failed to load portal")}finally{A.value=!1}}E(z),H(i,()=>z()),H(g,()=>z());async function Z(){try{const n=M();if(!n)return;const a=x?x.replace(/\/$/,""):"",m=(await(await fetch(`${a}/api/authentication/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:n},body:JSON.stringify({query:"query Me { me { id } }"})})).json().catch(()=>null))?.data?.me?.id||null;if(Q.value=m,!m){l.value="none";return}const r=await(await fetch(`${a}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:n},body:JSON.stringify({query:"query($institutionId:String!){ members(institutionId:$institutionId){ userId role } }",variables:{institutionId:g.value}})})).json().catch(()=>null),C=(Array.isArray(r?.data?.members)?r.data.members:[]).find(b=>b.userId===m),p=String(C?.role||"").toLowerCase();if(p.includes("admin")?l.value="admin":p.includes("teach")?l.value="teacher":p.includes("student")?l.value="student":l.value="none",(l.value==="admin"||l.value==="teacher"||l.value==="student")&&(i.value=l.value),l.value==="student"){const b=`/institution/student_mode/${encodeURIComponent(g.value)}`;window.location.href=b}}catch{}}E(()=>{Z()});const tt=[{title:"Title",dataIndex:"title",key:"title"},{title:"Code",dataIndex:"code",key:"code"},{title:"Department",dataIndex:"departmentName",key:"departmentName"},{title:"Status",dataIndex:"status",key:"status"}],et=[{title:"Course",dataIndex:"title",key:"title"},{title:"Category",dataIndex:"category",key:"category"},{title:"Difficulty",dataIndex:"difficulty",key:"difficulty"},{title:"Progress",dataIndex:"progressPct",key:"progressPct"}],at=[{title:"Title",dataIndex:"title",key:"title"},{title:"Classroom",dataIndex:"classroomName",key:"classroomName"},{title:"Due",dataIndex:"dueDate",key:"dueDate"}];return(n,a)=>{const o=s("a-menu-item"),f=s("a-menu"),m=s("a-segmented"),u=s("a-button"),r=s("a-space"),V=s("a-page-header"),C=s("a-statistic"),p=s("a-col"),b=s("a-row"),nt=s("a-divider"),st=s("a-list-item"),ot=s("a-list"),D=s("a-tab-pane"),N=s("a-table"),it=s("a-tabs"),P=s("a-card"),R=s("a-descriptions-item"),lt=s("a-descriptions"),rt=s("a-skeleton");return w(),W("div",_t,[t(V,{title:G.value,"sub-title":X.value},{extra:e(()=>[t(r,null,{default:e(()=>[t(f,{mode:"horizontal",selectedKeys:["overview"]},{default:e(()=>[t(o,{key:"overview"},{default:e(()=>[c("a",{href:h("overview")},"Overview",8,ft)]),_:1}),l.value==="admin"?(w(),U(o,{key:"departments"},{default:e(()=>[c("a",{href:h("departments")},"Departments",8,vt)]),_:1})):$("",!0),t(o,{key:"classrooms"},{default:e(()=>[c("a",{href:h("classrooms")},"Classrooms",8,ht)]),_:1}),t(o,{key:"people"},{default:e(()=>[c("a",{href:h("people")},"People Directory",8,yt)]),_:1}),t(o,{key:"catalog"},{default:e(()=>[c("a",{href:h("catalog")},"Catalog",8,gt)]),_:1}),t(o,{key:"calendar"},{default:e(()=>[c("a",{href:h("calendar")},"Calendar",8,bt)]),_:1}),t(o,{key:"assignments"},{default:e(()=>[c("a",{href:h("assignments")},"Assignments",8,wt)]),_:1})]),_:1}),t(m,{value:i.value,"onUpdate:value":a[0]||(a[0]=v=>i.value=v),options:F},null,8,["value"]),t(u,{size:"small",onClick:z},{default:e(()=>[...a[2]||(a[2]=[_("Reload",-1)])]),_:1}),t(u,{size:"small",href:"/institution/join"},{default:e(()=>[...a[3]||(a[3]=[_("Join Institution",-1)])]),_:1})]),_:1})]),_:1},8,["title","sub-title"]),t(rt,{loading:A.value,active:"",paragraph:{rows:8}},{default:e(()=>[t(b,{gutter:16},{default:e(()=>[t(p,{span:16},{default:e(()=>[t(P,{title:Y.value,size:"small"},{default:e(()=>[t(it,{activeKey:O.value,"onUpdate:activeKey":a[1]||(a[1]=v=>O.value=v)},{default:e(()=>[t(D,{key:"overview",tab:"Overview"},{default:e(()=>[t(b,{gutter:16},{default:e(()=>[t(p,{span:8},{default:e(()=>[t(C,{title:"Departments",value:k.value.departments},null,8,["value"])]),_:1}),t(p,{span:8},{default:e(()=>[t(C,{title:"Classrooms",value:k.value.classrooms},null,8,["value"])]),_:1}),t(p,{span:8},{default:e(()=>[t(C,{title:"Members",value:k.value.members},null,8,["value"])]),_:1})]),_:1}),t(nt),t(ot,{size:"small","data-source":L.value},{renderItem:e(({item:v})=>[t(st,null,{default:e(()=>[c("div",It,[c("span",kt,y(v.title),1),c("span",Ct,y(v.meta),1)])]),_:2},1024)]),_:1},8,["data-source"])]),_:1}),t(D,{key:"classrooms",tab:"Classrooms"},{default:e(()=>[t(N,{size:"small",columns:tt,dataSource:S.value,"row-key":"id"},{bodyCell:e(({column:v,record:q})=>[v.dataIndex==="title"?(w(),W("a",{key:0,href:`/institution/classrooms/${q.id}?institutionId=${encodeURIComponent(g.value)}`},y(q.title||q.code),9,$t)):$("",!0)]),_:1},8,["dataSource"])]),_:1}),i.value==="student"?(w(),U(D,{key:"courses",tab:"Courses"},{default:e(()=>[t(N,{size:"small",columns:et,dataSource:J.value,"row-key":"courseId"},null,8,["dataSource"])]),_:1})):$("",!0),i.value==="teacher"?(w(),U(D,{key:"assignments",tab:"Assignments"},{default:e(()=>[t(N,{size:"small",columns:at,dataSource:K.value,"row-key":"id"},null,8,["dataSource"])]),_:1})):$("",!0)]),_:1},8,["activeKey"])]),_:1},8,["title"])]),_:1}),t(p,{span:8},{default:e(()=>[t(P,{size:"small",title:"Quick Links"},{default:e(()=>[t(r,{direction:"vertical",style:{width:"100%"}},{default:e(()=>[t(u,{type:"link",href:"/institution/catalog"},{default:e(()=>[...a[4]||(a[4]=[_("Course Catalog",-1)])]),_:1}),t(u,{type:"link",href:"/institution/people"},{default:e(()=>[...a[5]||(a[5]=[_("People Directory",-1)])]),_:1}),l.value!=="student"?(w(),U(u,{key:0,type:"link",href:"/institution/assignments/teachers"},{default:e(()=>[...a[6]||(a[6]=[_("Teacher Assignments",-1)])]),_:1})):$("",!0)]),_:1})]),_:1}),t(P,{size:"small",title:"Institution",style:{"margin-top":"16px"}},{default:e(()=>[t(lt,{column:1,size:"small"},{default:e(()=>[t(R,{label:"Name"},{default:e(()=>[_(y(I.value?.name),1)]),_:1}),t(R,{label:"Slug"},{default:e(()=>[_(y(I.value?.slug),1)]),_:1}),t(R,{label:"Type"},{default:e(()=>[_(y(I.value?.type||"—"),1)]),_:1}),t(R,{label:"Location"},{default:e(()=>[_(y(I.value?.location||"—"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])}}}),Dt=pt(xt,[["__scopeId","data-v-11a37c14"]]);export{Dt as default};
