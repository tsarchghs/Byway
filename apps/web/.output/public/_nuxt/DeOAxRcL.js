import{g as ct,U as mt,W as pt,l as y,r as S,k as _t,ad as ft,c as _,b as t,w as s,n as ie,p as f,o as d,q as p,K as z,I as x,a,d as r,x as g,T as vt,az as re,D as Ce,A as xe,al as we,E as Se,t as o,aw as yt,aA as gt,aB as ht,J as ue,B as M,C as Te,_ as kt}from"./DQDUwbr-.js";const bt={class:"institution-student-portal"},It=["href"],Ct=["href"],xt=["href"],wt=["href"],St=["href"],Tt=["href"],Dt=["href"],zt={class:"student-header"},At={class:"avatar-circle"},$t={class:"student-meta"},Nt={class:"student-name"},Et={class:"student-email"},Ot={class:"student-role"},Pt={class:"section-header"},Ut={class:"section-title"},Lt={class:"classroom-item"},Rt={class:"classroom-title"},Mt={class:"classroom-meta"},Bt={key:0},jt={class:"classroom-meta"},Ft={key:0},qt={class:"classroom-meta"},Gt={class:"classroom-meta"},Ht={class:"classroom-item"},Vt={class:"classroom-title"},Kt={class:"classroom-meta"},Jt={style:{display:"flex","align-items":"center",gap:"8px"}},Wt={class:"section-header"},Qt={class:"section-title"},Xt={key:1},Yt={class:"section-header"},Zt={class:"section-title"},es={style:{display:"flex",gap:"8px","align-items":"center"}},ts={style:{display:"flex","align-items":"center",gap:"8px","flex-wrap":"wrap"}},ss={class:"institution-description"},as={class:"section-header"},ls={class:"section-title"},os={class:"section-header"},ns={class:"section-title"},is={class:"lab-item"},rs={class:"lab-title"},us={class:"lab-meta"},ds={class:"lab-meta"},cs={class:"note-item"},ms={class:"note-course"},ps={class:"note-body"},_s={class:"note-date"},fs={class:"section-header"},vs={class:"section-title"},ys={class:"dept-meta"},gs={class:"classroom-item"},hs={class:"classroom-title"},ks={class:"classroom-meta"},bs={key:0},Is={class:"classroom-meta"},Cs={key:0},xs={class:"classroom-meta"},ws={class:"classroom-item"},Ss={class:"classroom-title"},Ts={class:"classroom-meta"},Ds={class:"section-header"},zs={class:"section-title"},As={key:0},$s={key:1},Ns={key:0},Es={key:1},Os={class:"lab-item"},Ps={class:"lab-title"},Us={class:"lab-meta"},Ls={class:"lab-meta"},Rs={class:"section-header"},Ms={class:"section-title"},Bs={key:1},js={class:"institution-description"},Fs=ct({__name:"student_mode_institution_dashboard",props:{institutionId:{},institutionSlug:{},mode:{}},setup(De){const ze=De,Ae=mt(),de=pt(),A=de.public?.apiBase||de.public?.appBaseUrl||"",U=y(()=>ze.institutionId||Ae.params.institution_id||"inst_byway"),Q=S(!0),L=S(null),u=S(null),ce=S("overview"),B=S(!0),X=S(!0),j=S(null),$=S(null),F=S([]),Y=S({}),me=S(!1),pe=S([]),Z=S("");function w(l){if(!l)return"—";const e=typeof l=="string"?new Date(l):l;return Number.isNaN(e.getTime())?"—":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"})}function V(){if(typeof window>"u")return null;const l=localStorage.getItem("token")||localStorage.getItem("access_token")||"";return l?l.startsWith("Bearer")?l:`Bearer ${l}`:null}async function K(){Q.value=!0,L.value=null;try{const l=V();if(!l)throw new Error("Missing auth token");const e=new URLSearchParams;U.value&&e.set("institutionId",U.value);const m=`${A?A.replace(/\/$/,""):""}/api/institution-portal/student-dashboard`,k=e.toString()?`${m}?${e.toString()}`:m,b=await fetch(k,{method:"GET",headers:{"content-type":"application/json",Authorization:l}});if(!b.ok){const I=await b.text().catch(()=>"");throw new Error(I||`HTTP ${b.status}`)}const T=await b.json();if(u.value=T,u.value?.member?.role==="student"){const I=u.value.courses?.[0]?.courseId||null;$.value=I,j.value=u.value.classrooms?.find(v=>v.isEnrolled)?.id||null,await Promise.all([Je(),se(),We()])}}catch(l){console.error(l),L.value=l?.message??"Failed to load institution portal view",ie.error(L.value)}finally{Q.value=!1}}_t(K),ft(U,()=>K());const q=y(()=>u.value?.departments.filter(l=>l.active)??[]),$e=y(()=>u.value?.classrooms.filter(l=>l.status==="ACTIVE")??[]),J=y(()=>u.value?.classrooms.filter(l=>l.isEnrolled)??[]),ee=y(()=>(B.value?J.value:u.value?.classrooms??[]).slice().sort((e,i)=>e.title.localeCompare(i.title)));function _e(l){return ee.value.filter(e=>e.departmentId===l)}const fe=y(()=>ee.value.filter(l=>!l.departmentId)),D=y(()=>u.value?.courses??[]),Ne=y(()=>D.value.filter(l=>l.completed).length),ve=y(()=>{if(!D.value.length)return 0;const l=D.value.reduce((e,i)=>e+i.progressPct,0);return Math.round(l/D.value.length)}),Ee=y(()=>{const e=(u.value?.gradebookEntries??[]).filter(m=>typeof m.score=="number"&&typeof m.maxScore=="number"&&m.maxScore>0);if(!e.length)return 0;const i=e.reduce((m,k)=>m+k.score/k.maxScore*100,0);return Math.round(i/e.length)}),Oe=y(()=>{const l=Date.now();return(u.value?.assignments??[]).filter(i=>{const m=new Date(i.dueDate).getTime();return X.value?m>=l&&i.submissionStatus!=="graded":!0}).sort((i,m)=>new Date(i.dueDate).getTime()-new Date(m.dueDate).getTime()).slice(0,5)}),ye=y(()=>(u.value?.labs??[]).slice().sort((e,i)=>{const m=e.lastHeartbeat?new Date(e.lastHeartbeat).getTime():0;return(i.lastHeartbeat?new Date(i.lastHeartbeat).getTime():0)-m}).slice(0,5)),Pe=y(()=>(u.value?.labs??[]).filter(l=>l.status==="running").length),Ue=y(()=>u.value?.orders.length??0),Le=y(()=>(u.value?.orders??[]).reduce((l,e)=>l+e.total,0)),Re=y(()=>u.value?.orders[0]?.currency??"EUR"),ge=y(()=>u.value?u.value.student.displayName||`${u.value.user.firstName??""} ${u.value.user.lastName??""}`.trim()||u.value.user.email:"Student"),Me=y(()=>{const e=ge.value.split(" ").filter(Boolean);return e.length?e.length===1?e[0].slice(0,2).toUpperCase():(e[0][0]+e[1][0]).toUpperCase():"?"}),Be=y(()=>{const l=u.value?.member?.role||"student";return l.charAt(0).toUpperCase()+l.slice(1)}),je=y(()=>{const l=u.value?.gradebookEntries??[];if(!l.length)return"—";const e=l.map(m=>new Date(m.updatedAt||m.createdAt).getTime()),i=Math.max(...e);return Number.isFinite(i)?w(new Date(i)):"—"}),Fe=[{title:"Course",dataIndex:"title",key:"title"},{title:"Category",dataIndex:"category",key:"category"},{title:"Difficulty",dataIndex:"difficulty",key:"difficulty"},{title:"Progress",dataIndex:"progressPct",key:"progress"},{title:"Grade",dataIndex:"gradePct",key:"grade"},{title:"Classrooms",dataIndex:"classroomCount",key:"classrooms"}],qe=[{title:"Title",dataIndex:"title",key:"title"},{title:"Course",dataIndex:"courseTitle",key:"courseTitle"},{title:"Classroom",dataIndex:"classroomName",key:"classroomName"},{title:"Due",dataIndex:"dueDate",key:"dueDate"},{title:"Status",dataIndex:"submissionStatus",key:"submissionStatus"}],Ge=[{title:"Title",dataIndex:"title",key:"title"},{title:"Course",dataIndex:"courseTitle",key:"courseTitle"},{title:"Classroom",dataIndex:"classroomName",key:"classroomName"},{title:"Due",dataIndex:"dueDate",key:"dueDate"},{title:"Status",dataIndex:"submissionStatus",key:"status"},{title:"Grade",dataIndex:"grade",key:"grade"}],He=[{title:"Order ID",dataIndex:"orderId",key:"orderId"},{title:"Date",dataIndex:"createdAt",key:"createdAt"},{title:"Items",dataIndex:"items",key:"items"},{title:"Total",dataIndex:"total",key:"total"},{title:"Status",dataIndex:"status",key:"status"}];function P(l){const e=`?institutionId=${encodeURIComponent(U.value||"")}`,i=q.value[0]?.id,m=ee.value[0]?.id,k=String(u.value?.member?.role||"").toLowerCase();return k!=="admin"&&l==="departments"?`/institution/portal${e}`:k==="student"&&l==="assignments"?`/institution/portal${e}`:l==="overview"?`/institution/portal${e}`:l==="departments"?i?`/institution/departments/${encodeURIComponent(i)}${e}`:`/institution/portal${e}`:l==="classrooms"?m?`/institution/classrooms/${encodeURIComponent(m)}${e}`:`/institution/portal${e}`:l==="people"?`/institution/people${e}`:l==="catalog"?`/institution/catalog${e}`:l==="calendar"?`/institution/calendar${e}`:l==="assignments"?`/institution/assignments/teachers${e}`:`/institution/portal${e}`}async function Ve(){try{const l=V();if(!l)throw new Error("Missing auth token");const e=A?A.replace(/\/$/,""):"",i=U.value||u.value?.institution?.id;if(!i)throw new Error("No institution id");const m=await fetch(`${e}/api/institution-portal/institutions/${encodeURIComponent(i)}/leave`,{method:"POST",headers:{Authorization:l}});if(!m.ok)throw new Error(await m.text().catch(()=>`HTTP ${m.status}`));ie.success("Left institution"),window.location.href="/institution/join"}catch(l){ie.error(l?.message||"Leave failed")}}const te=y(()=>{const l=new Set()(u.value?.classrooms||[]).forEach(e=>{e.teacherId&&l.add(String(e.teacherId))});return Array.from(l)});function he(l){j.value=l.id;const e=D.value.find(i=>l.teacherId&&te.value.includes(l.teacherId));$.value=e?.courseId||D.value[0]?.courseId||null,se()}function Ke(l){$.value=l.courseId,se()}async function Je(){try{const l=V();if(!l||!u.value?.student?.id)return;const e=A?A.replace(/\/$/,""):"",m=await(await fetch(`${e}/api/students-internal/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:l},body:JSON.stringify({query:"query($studentId:String!){ myProgress(studentId:$studentId){ lessonId completed } }",variables:{studentId:u.value.student.id}})})).json().catch(()=>null),k=Array.isArray(m?.data?.myProgress)?m.data.myProgress:[],b={};k.forEach(T=>{T?.lessonId&&(b[T.lessonId]=T.completed?"COMPLETED":"IN_PROGRESS")}),Y.value=b}catch{}}async function se(){try{if(!$.value){F.value=[];return}me.value=!0;const l=A?A.replace(/\/$/,""):"",m=(await(await fetch(`${l}/api/teach-internal/graphql`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({query:"query($id:String!){ course(id:$id){ id title modules{ id title lessons{ id duration } } } }",variables:{id:$.value}})})).json().catch(()=>null))?.data?.course||null;F.value=Array.isArray(m?.modules)?m.modules:[]}catch{F.value=[]}finally{me.value=!1}}async function We(){try{const l=V();if(!l)return;const i=`${A?A.replace(/\/$/,""):""}/api/institution-portal/catalog?institutionId=${encodeURIComponent(U.value||"")}`,k=await(await fetch(i,{headers:{Authorization:l}})).json().catch(()=>null),b=Array.isArray(k?.courses)?k.courses:[];pe.value=b}catch{}}const Qe=y(()=>{const l=D.value.find(i=>i.courseId===$.value);return[(u.value?.classrooms||[]).find(i=>i.id===j.value)?.title,l?.title].filter(Boolean).join(" • ")||"Active Modules & Next Steps"}),Xe=[{title:"Module",dataIndex:"title",key:"title"},{title:"Status",dataIndex:"status",key:"status"},{title:"Next",dataIndex:"next",key:"next"}],Ye=y(()=>(F.value||[]).map(l=>{const e=Array.isArray(l.lessons)?l.lessons:[];let i=0,m=0,k=0,b="—";for(const I of e){const v=Y.value[I.id]||"NOT_STARTED";v==="COMPLETED"?i++:v==="IN_PROGRESS"?m++:k++}const T=e.find(I=>Y.value[I.id]!=="COMPLETED");return T&&(b=`Next: ${T.title}`),{id:l.id,title:l.title,completed:i,inProgress:m,notStarted:k,nextLabel:b}})),ke=y(()=>{if(!$.value)return"";const e=(F.value||[])[0],i=te.value[0]||"teacher";return e?.id?`/teach-internal/${encodeURIComponent(i)}/course/${encodeURIComponent($.value)}/module/${encodeURIComponent(e.id)}/view`:`/teach-internal/${encodeURIComponent(i)}`});function Ze(l){const e=(u.value?.assignments||[]).filter(m=>m.classroomId===l);if(!e.length)return"—";const i=e.slice().sort((m,k)=>new Date(m.dueDate).getTime()-new Date(k.dueDate).getTime())[0];return w(i?.dueDate)}const et=y(()=>{const l=u.value?.assignments||[];return j.value?l.filter(e=>e.classroomId===j.value).slice(0,3):l.slice(0,3)}),tt=y(()=>{const l=Z.value.trim().toLowerCase(),e=new Set((u.value?.courses||[]).map(i=>i.courseId));return(pe.value||[]).filter(i=>!e.has(i.courseId)).filter(i=>l?String(i.title).toLowerCase().includes(l):!0)});function st(l){const e=l.teacherId||l.teacher_id||null;return e?te.value.includes(String(e)):!1}function at(l){const e=l.courseId||l.id,i=l.teacherId||l.teacher_id||"teacher";return`/teach-internal/${encodeURIComponent(i)}/course/${encodeURIComponent(e)}`}return(l,e)=>{const i=f("a-tag"),m=f("a-menu-item"),k=f("a-menu"),b=f("a-button"),T=f("a-space"),I=f("a-statistic"),v=f("a-col"),N=f("a-row"),C=f("a-card"),ae=f("a-divider"),h=f("a-descriptions-item"),R=f("a-descriptions"),lt=f("a-page-header"),le=f("a-switch"),E=f("a-list-item"),O=f("a-list"),W=f("a-collapse-panel"),be=f("a-collapse"),Ie=f("a-progress"),oe=f("a-empty"),G=f("a-table"),ot=f("a-input"),nt=f("a-timeline-item"),it=f("a-timeline"),H=f("a-tab-pane"),rt=f("a-tabs"),ut=f("a-result"),dt=f("a-skeleton");return d(),_("div",bt,[t(dt,{loading:Q.value,active:"",paragraph:{rows:10}},{default:s(()=>[!L.value&&u.value?(d(),_(x,{key:0},[t(lt,{class:"portal-page-header",title:u.value.institution.name,"sub-title":u.value.institution.type||"Institution"},{tags:s(()=>[u.value.institution.active?(d(),p(i,{key:0,color:"green"},{default:s(()=>[t(g(xe),{class:"tag-icon"}),e[5]||(e[5]=a("span",null,"Active",-1))]),_:1})):(d(),p(i,{key:1,color:"red"},{default:s(()=>[t(g(ht),{class:"tag-icon"}),e[6]||(e[6]=a("span",null,"Inactive",-1))]),_:1})),t(i,null,{default:s(()=>[r(o(u.value.institution.slug),1)]),_:1}),u.value.authInstitution?.domain?(d(),p(i,{key:2},{default:s(()=>[r(o(u.value.authInstitution.domain),1)]),_:1})):z("",!0)]),extra:s(()=>[t(T,null,{default:s(()=>[t(k,{mode:"horizontal",selectedKeys:["overview"]},{default:s(()=>[t(m,{key:"overview"},{default:s(()=>[a("a",{href:P("overview")},"Overview",8,It)]),_:1}),u.value.member?.role==="admin"?(d(),p(m,{key:"departments"},{default:s(()=>[a("a",{href:P("departments")},"Departments",8,Ct)]),_:1})):z("",!0),t(m,{key:"classrooms"},{default:s(()=>[a("a",{href:P("classrooms")},"Classrooms",8,xt)]),_:1}),t(m,{key:"people"},{default:s(()=>[a("a",{href:P("people")},"People Directory",8,wt)]),_:1}),t(m,{key:"catalog"},{default:s(()=>[a("a",{href:P("catalog")},"Catalog",8,St)]),_:1}),t(m,{key:"calendar"},{default:s(()=>[a("a",{href:P("calendar")},"Calendar",8,Tt)]),_:1}),u.value.member?.role!=="student"?(d(),p(m,{key:"assignments"},{default:s(()=>[a("a",{href:P("assignments")},"Assignments",8,Dt)]),_:1})):z("",!0)]),_:1}),t(b,{size:"small",onClick:K},{default:s(()=>[t(g(gt)),e[7]||(e[7]=r(" Refresh ",-1))]),_:1}),u.value.member?(d(),p(b,{key:1,size:"small",danger:"",onClick:Ve},{default:s(()=>[...e[9]||(e[9]=[r("Leave",-1)])]),_:1})):(d(),p(b,{key:0,size:"small",type:"primary",href:"/institution/join"},{default:s(()=>[...e[8]||(e[8]=[r("Join Institution",-1)])]),_:1}))]),_:1})]),footer:s(()=>[t(N,{gutter:16,class:"portal-header-row"},{default:s(()=>[t(v,{span:16},{default:s(()=>[t(C,{size:"small",bordered:"",class:"portal-header-card"},{default:s(()=>[t(N,{gutter:16},{default:s(()=>[t(v,{span:8},{default:s(()=>[t(I,{value:J.value.length},{title:s(()=>[a("span",null,[t(g(vt),{class:"stat-icon"}),e[10]||(e[10]=r(" Enrolled classrooms ",-1))])]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:s(()=>[t(I,{value:q.value.length},{title:s(()=>[a("span",null,[t(g(re),{class:"stat-icon"}),e[11]||(e[11]=r(" Active departments ",-1))])]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:s(()=>[t(I,{value:ve.value,suffix:"%"},{title:s(()=>[a("span",null,[t(g(Ce),{class:"stat-icon"}),e[12]||(e[12]=r(" Avg. course progress ",-1))])]),_:1},8,["value"])]),_:1})]),_:1}),t(N,{gutter:16,style:{"margin-top":"12px"}},{default:s(()=>[t(v,{span:8},{default:s(()=>[t(I,{value:Ee.value,suffix:"%"},{title:s(()=>[a("span",null,[t(g(xe),{class:"stat-icon"}),e[13]||(e[13]=r(" Avg. grade ",-1))])]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:s(()=>[t(I,{value:Ue.value},{title:s(()=>[a("span",null,[t(g(we),{class:"stat-icon"}),e[14]||(e[14]=r(" Orders for this institution ",-1))])]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:s(()=>[t(I,{value:Pe.value},{title:s(()=>[a("span",null,[t(g(Se),{class:"stat-icon"}),e[15]||(e[15]=r(" Active lab sessions ",-1))])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(v,{span:8},{default:s(()=>[t(C,{size:"small",class:"student-card"},{default:s(()=>[a("div",zt,[a("div",At,[a("span",null,o(Me.value),1)]),a("div",$t,[a("div",Nt,o(ge.value),1),a("div",Et,o(u.value.user.email),1),a("div",Ot,[t(i,{color:"blue"},{default:s(()=>[t(g(yt),{class:"tag-icon"}),r(" "+o(Be.value),1)]),_:1}),u.value.member?.status==="ACTIVE"?(d(),p(i,{key:0,color:"green"},{default:s(()=>[...e[16]||(e[16]=[r(" Active member ",-1)])]),_:1})):z("",!0)])])]),t(ae),t(R,{column:1,size:"small"},{default:s(()=>[t(h,{label:"Institution ID"},{default:s(()=>[r(o(u.value.institution.id),1)]),_:1}),t(h,{label:"Member since"},{default:s(()=>[r(o(w(u.value.member?.createdAt)),1)]),_:1}),t(h,{label:"Last activity"},{default:s(()=>[r(o(je.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title","sub-title"]),u.value.member?.role==="student"?(d(),p(N,{key:0,gutter:16,class:"portal-layout"},{default:s(()=>[t(v,{xs:24,md:8},{default:s(()=>[t(C,{size:"small",title:"Institution Programs & Classrooms"},{default:s(()=>[a("div",Pt,[a("span",Ut,[t(g(re),{class:"section-icon"}),e[17]||(e[17]=r(" Departments ",-1))]),t(le,{checked:B.value,"onUpdate:checked":e[0]||(e[0]=n=>B.value=n),size:"small",style:{"margin-left":"auto"}},null,8,["checked"]),e[18]||(e[18]=a("span",{class:"filter-label"},"Show only my classrooms",-1))]),t(be,{accordion:""},{default:s(()=>[(d(!0),_(x,null,ue(q.value,n=>(d(),p(W,{key:n.id,header:n.name},{default:s(()=>[t(O,{size:"small","data-source":_e(n.id),locale:{emptyText:"No classrooms"}},{renderItem:s(({item:c})=>[t(E,{onClick:ne=>he(c),style:{cursor:"pointer"}},{default:s(()=>[a("div",Lt,[a("div",Rt,[t(g(M),{class:"section-icon"}),a("span",null,o(c.title),1),c.isEnrolled?(d(),p(i,{key:0,color:"green",style:{"margin-left":"8px"}},{default:s(()=>[...e[19]||(e[19]=[r("Enrolled",-1)])]),_:1})):z("",!0)]),a("div",Mt,[a("span",null,"Code: "+o(c.code),1),c.teacherId?(d(),_("span",Bt,"• Teacher: "+o(c.teacherId),1)):z("",!0)]),a("div",jt,[a("span",null,"Status: "+o(c.status||"—"),1),c.capacity!==null?(d(),_("span",Ft,"• Capacity: "+o(c.capacity),1)):z("",!0)]),a("div",qt,[a("span",null,"Starts: "+o(w(c.startsAt)),1),a("span",null,"• Ends: "+o(w(c.endsAt)),1)]),a("div",Gt,[a("span",null,"Next due: "+o(Ze(c.id)),1)])])]),_:2},1032,["onClick"])]),_:1},8,["data-source"])]),_:2},1032,["header"]))),128)),t(W,{key:"other",header:"Other classrooms"},{default:s(()=>[t(O,{size:"small","data-source":fe.value,locale:{emptyText:"No other classrooms"}},{renderItem:s(({item:n})=>[t(E,{onClick:c=>he(n),style:{cursor:"pointer"}},{default:s(()=>[a("div",Ht,[a("div",Vt,[t(g(M),{class:"section-icon"}),a("span",null,o(n.title),1)]),a("div",Kt,[a("span",null,"Code: "+o(n.code),1),a("span",null,"• Status: "+o(n.status||"—"),1)])])]),_:2},1032,["onClick"])]),_:1},8,["data-source"])]),_:1})]),_:1}),t(ae),t(C,{size:"small",bordered:!1,title:"My Institution Courses"},{default:s(()=>[t(O,{size:"small","data-source":D.value,locale:{emptyText:"No enrolled courses"}},{renderItem:s(({item:n})=>[t(E,{onClick:c=>Ke(n),style:{cursor:"pointer"}},{default:s(()=>[a("div",Jt,[a("span",null,o(n.title),1),t(Ie,{percent:n.progressPct,size:"small",style:{width:"120px"}},null,8,["percent"])])]),_:2},1032,["onClick"])]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1}),t(v,{xs:24,md:8},{default:s(()=>[t(C,{size:"small",title:Qe.value},{default:s(()=>[$.value?(d(),_(x,{key:1},[a("div",Wt,[a("span",Qt,[t(g(Ce),{class:"section-icon"}),e[20]||(e[20]=r(" Active Modules ",-1))]),t(b,{size:"small",type:"primary",href:ke.value,disabled:!ke.value},{default:s(()=>[...e[21]||(e[21]=[r("Continue where you left off",-1)])]),_:1},8,["href","disabled"])]),t(G,{size:"small",dataSource:Ye.value,columns:Xe,pagination:{pageSize:6},"row-key":"id"},{bodyCell:s(({column:n,record:c})=>[n.key==="status"?(d(),p(T,{key:0},{default:s(()=>[t(i,{color:"green"},{default:s(()=>[r(o(c.completed)+" done",1)]),_:2},1024),t(i,{color:"blue"},{default:s(()=>[r(o(c.inProgress)+" in-progress",1)]),_:2},1024),t(i,null,{default:s(()=>[r(o(c.notStarted)+" not-started",1)]),_:2},1024)]),_:2},1024)):n.key==="next"?(d(),_("span",Xt,o(c.nextLabel),1)):z("",!0)]),_:1},8,["dataSource"]),t(ae),a("div",Yt,[a("span",Zt,[t(g(Te),{class:"section-icon"}),e[22]||(e[22]=r(" Next Assignment ",-1))])]),t(O,{size:"small","data-source":et.value,locale:{emptyText:"No upcoming assignments"}},{renderItem:s(({item:n})=>[t(E,null,{default:s(()=>[a("div",es,[a("span",null,o(n.title),1),t(i,null,{default:s(()=>[r(o(w(n.dueDate)),1)]),_:2},1024),n.submissionStatus==="graded"?(d(),p(i,{key:0,color:"green"},{default:s(()=>[...e[23]||(e[23]=[r("Graded",-1)])]),_:1})):n.submissionStatus==="submitted"?(d(),p(i,{key:1,color:"blue"},{default:s(()=>[...e[24]||(e[24]=[r("Submitted",-1)])]),_:1})):(d(),p(i,{key:2},{default:s(()=>[...e[25]||(e[25]=[r("Not submitted",-1)])]),_:1}))])]),_:2},1024)]),_:1},8,["data-source"])],64)):(d(),p(oe,{key:0,description:"Select a classroom or course"}))]),_:1},8,["title"])]),_:1}),t(v,{xs:24,md:8},{default:s(()=>[t(C,{size:"small",title:"Discover & Normal Courses"},{default:s(()=>[t(ot,{value:Z.value,"onUpdate:value":e[1]||(e[1]=n=>Z.value=n),placeholder:"Search courses",style:{"margin-bottom":"8px"}},null,8,["value"]),t(O,{size:"small","data-source":tt.value,locale:{emptyText:"No recommendations"}},{renderItem:s(({item:n})=>[t(E,null,{default:s(()=>[a("div",ts,[a("span",null,o(n.title),1),st(n)?(d(),p(i,{key:0,color:"geekblue"},{default:s(()=>[...e[26]||(e[26]=[r("Institution course",-1)])]),_:1})):(d(),p(i,{key:1,color:"purple"},{default:s(()=>[...e[27]||(e[27]=[r("Global course",-1)])]),_:1})),t(i,null,{default:s(()=>[r(o(n.difficulty||"—"),1)]),_:2},1024),t(b,{size:"small",type:"link",href:at(n)},{default:s(()=>[...e[28]||(e[28]=[r("View details",-1)])]),_:1},8,["href"])])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})):(d(),p(N,{key:1,gutter:16,class:"portal-layout"},{default:s(()=>[t(v,{span:16},{default:s(()=>[t(C,{bordered:!1,class:"portal-main-card"},{default:s(()=>[t(rt,{activeKey:ce.value,"onUpdate:activeKey":e[4]||(e[4]=n=>ce.value=n)},{default:s(()=>[t(H,{key:"overview",tab:"Overview"},{default:s(()=>[t(N,{gutter:16},{default:s(()=>[t(v,{span:16},{default:s(()=>[t(C,{size:"small",title:"About this institution"},{default:s(()=>[a("p",ss,o(u.value.institution.description||"No description provided."),1),t(R,{column:2,size:"small"},{default:s(()=>[t(h,{label:"Location"},{default:s(()=>[r(o(u.value.institution.location||"—"),1)]),_:1}),t(h,{label:"Email"},{default:s(()=>[r(o(u.value.institution.email||"—"),1)]),_:1}),t(h,{label:"Phone"},{default:s(()=>[r(o(u.value.institution.phone||"—"),1)]),_:1}),t(h,{label:"Created"},{default:s(()=>[r(o(w(u.value.institution.createdAt)),1)]),_:1})]),_:1})]),_:1}),t(C,{size:"small",style:{"margin-top":"16px"},title:"Upcoming work (assignments & labs)"},{default:s(()=>[t(N,{gutter:16},{default:s(()=>[t(v,{span:14},{default:s(()=>[a("div",as,[a("span",ls,[t(g(Te),{class:"section-icon"}),e[29]||(e[29]=r(" Assignments ",-1))]),t(le,{checked:X.value,"onUpdate:checked":e[2]||(e[2]=n=>X.value=n),size:"small",style:{"margin-left":"auto"}},null,8,["checked"]),e[30]||(e[30]=a("span",{class:"filter-label"},"Show only open",-1))]),t(G,{size:"small",dataSource:Oe.value,columns:qe,pagination:!1,"row-key":"id"},{bodyCell:s(({column:n,record:c})=>[n.key==="dueDate"?(d(),_(x,{key:0},[r(o(w(c.dueDate)),1)],64)):n.key==="submissionStatus"?(d(),_(x,{key:1},[c.submissionStatus==="graded"?(d(),p(i,{key:0,color:"green"},{default:s(()=>[...e[31]||(e[31]=[r(" Graded ",-1)])]),_:1})):c.submissionStatus==="submitted"?(d(),p(i,{key:1,color:"blue"},{default:s(()=>[...e[32]||(e[32]=[r(" Submitted ",-1)])]),_:1})):(d(),p(i,{key:2},{default:s(()=>[...e[33]||(e[33]=[r(" Not submitted ",-1)])]),_:1}))],64)):(d(),_(x,{key:2},[r(o(c[n.dataIndex]),1)],64))]),_:1},8,["dataSource"])]),_:1}),t(v,{span:10},{default:s(()=>[a("div",os,[a("span",ns,[t(g(Se),{class:"section-icon"}),e[34]||(e[34]=r(" Lab sessions ",-1))])]),ye.value.length?(d(),p(it,{key:0},{default:s(()=>[(d(!0),_(x,null,ue(ye.value,n=>(d(),p(nt,{key:n.sessionId,color:n.status==="running"?"green":"blue"},{default:s(()=>[a("div",is,[a("div",rs,o(n.challengeTitle),1),a("div",us,[a("span",null,o(n.courseTitle||"No course"),1),e[35]||(e[35]=a("span",null,"•",-1)),a("span",null,"Status: "+o(n.status),1)]),a("div",ds,[a("span",null,"Runtime: "+o(n.runtime||"—"),1),e[36]||(e[36]=a("span",null,"•",-1)),a("span",null,"Last heartbeat: "+o(w(n.lastHeartbeat)),1)])])]),_:2},1032,["color"]))),128))]),_:1})):(d(),p(oe,{key:1,description:"No lab activity yet"}))]),_:1})]),_:1})]),_:1})]),_:1}),t(v,{span:8},{default:s(()=>[t(C,{size:"small",title:"My course snapshot"},{default:s(()=>[t(I,{title:"Enrolled courses",value:D.value.length},null,8,["value"]),t(I,{title:"Completed courses",value:Ne.value,style:{"margin-top":"8px"}},null,8,["value"]),t(I,{title:"Average progress",value:ve.value,suffix:"%",style:{"margin-top":"8px"}},null,8,["value"])]),_:1}),t(C,{size:"small",style:{"margin-top":"16px"},title:"Recent notes"},{default:s(()=>[u.value.notes.length?(d(),p(O,{key:1,size:"small","data-source":u.value.notes.slice(0,3)},{renderItem:s(({item:n})=>[t(E,null,{default:s(()=>[a("div",cs,[a("div",ms,[t(g(M),{class:"section-icon"}),a("span",null,o(n.courseTitle||"Course"),1)]),a("div",ps,o(n.body),1),a("div",_s,o(w(n.createdAt)),1)])]),_:2},1024)]),_:1},8,["data-source"])):(d(),p(oe,{key:0,description:"No notes yet for this institution"}))]),_:1})]),_:1})]),_:1})]),_:1}),t(H,{key:"departments",tab:"Departments & Classrooms"},{default:s(()=>[a("div",fs,[a("span",vs,[t(g(re),{class:"section-icon"}),e[37]||(e[37]=r(" Departments ",-1))]),t(le,{checked:B.value,"onUpdate:checked":e[3]||(e[3]=n=>B.value=n),size:"small",style:{"margin-left":"auto"}},null,8,["checked"]),e[38]||(e[38]=a("span",{class:"filter-label"},"Show only my classrooms",-1))]),t(N,{gutter:16,style:{"margin-top":"8px"}},{default:s(()=>[t(v,{span:16},{default:s(()=>[t(be,{accordion:""},{default:s(()=>[(d(!0),_(x,null,ue(q.value,n=>(d(),p(W,{key:n.id,header:n.name},{default:s(()=>[a("p",ys,o(n.contact||"No contact details"),1),t(O,{size:"small","data-source":_e(n.id),locale:{emptyText:"No classrooms in this department"}},{renderItem:s(({item:c})=>[t(E,null,{default:s(()=>[a("div",gs,[a("div",hs,[t(g(M),{class:"section-icon"}),a("span",null,o(c.title),1),c.isEnrolled?(d(),p(i,{key:0,color:"green",style:{"margin-left":"8px"}},{default:s(()=>[...e[39]||(e[39]=[r(" Enrolled ",-1)])]),_:1})):(d(),p(i,{key:1,style:{"margin-left":"8px"}},{default:s(()=>[...e[40]||(e[40]=[r(" Not enrolled ",-1)])]),_:1}))]),a("div",ks,[a("span",null,"Code: "+o(c.code),1),c.courseTitle?(d(),_("span",bs,"• Course: "+o(c.courseTitle),1)):z("",!0)]),a("div",Is,[a("span",null,"Status: "+o(c.status||"—"),1),c.capacity!==null?(d(),_("span",Cs," • Capacity: "+o(c.capacity),1)):z("",!0)]),a("div",xs,[a("span",null,"Starts: "+o(w(c.startsAt)),1),a("span",null,"• Ends: "+o(w(c.endsAt)),1)])])]),_:2},1024)]),_:1},8,["data-source"])]),_:2},1032,["header"]))),128)),t(W,{key:"other",header:"Other classrooms"},{default:s(()=>[t(O,{size:"small","data-source":fe.value,locale:{emptyText:"No other classrooms"}},{renderItem:s(({item:n})=>[t(E,null,{default:s(()=>[a("div",ws,[a("div",Ss,[t(g(M),{class:"section-icon"}),a("span",null,o(n.title),1)]),a("div",Ts,[a("span",null,"Code: "+o(n.code),1),a("span",null,"• Status: "+o(n.status||"—"),1)])])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1}),t(v,{span:8},{default:s(()=>[t(C,{size:"small",title:"Classroom summary"},{default:s(()=>[t(R,{column:1,size:"small"},{default:s(()=>[t(h,{label:"Total classrooms"},{default:s(()=>[r(o(u.value.classrooms.length),1)]),_:1}),t(h,{label:"Active classrooms"},{default:s(()=>[r(o($e.value.length),1)]),_:1}),t(h,{label:"My classrooms"},{default:s(()=>[r(o(J.value.length),1)]),_:1}),t(h,{label:"Enrollment records"},{default:s(()=>[r(o(u.value.classroomEnrollments.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(H,{key:"courses",tab:"Courses & Progress"},{default:s(()=>[a("div",Ds,[a("span",zs,[t(g(M),{class:"section-icon"}),e[41]||(e[41]=r(" Courses at this institution ",-1))])]),t(G,{size:"small",columns:Fe,dataSource:D.value,"row-key":"courseId",pagination:{pageSize:5},style:{"margin-top":"8px"}},{bodyCell:s(({column:n,record:c})=>[n.key==="progress"?(d(),p(Ie,{key:0,percent:c.progressPct,size:"small"},null,8,["percent"])):n.key==="grade"?(d(),_(x,{key:1},[c.gradePct!==null&&c.gradePct!==void 0?(d(),_("span",As,o(c.gradePct.toFixed(0))+"% ",1)):(d(),_("span",$s,"—"))],64)):(d(),_(x,{key:2},[r(o(c[n.dataIndex]||"—"),1)],64))]),_:1},8,["dataSource"])]),_:1}),t(H,{key:"labs",tab:"Labs & Assignments"},{default:s(()=>[t(N,{gutter:16},{default:s(()=>[t(v,{span:14},{default:s(()=>[t(C,{size:"small",title:"Assignments"},{default:s(()=>[t(G,{size:"small",columns:Ge,dataSource:u.value.assignments,"row-key":"id",pagination:{pageSize:8}},{bodyCell:s(({column:n,record:c})=>[n.key==="dueDate"?(d(),_(x,{key:0},[r(o(w(c.dueDate)),1)],64)):n.key==="status"?(d(),_(x,{key:1},[c.submissionStatus==="graded"?(d(),p(i,{key:0,color:"green"},{default:s(()=>[...e[42]||(e[42]=[r(" Graded ",-1)])]),_:1})):c.submissionStatus==="submitted"?(d(),p(i,{key:1,color:"blue"},{default:s(()=>[...e[43]||(e[43]=[r(" Submitted ",-1)])]),_:1})):(d(),p(i,{key:2},{default:s(()=>[...e[44]||(e[44]=[r(" Not submitted ",-1)])]),_:1}))],64)):n.key==="grade"?(d(),_(x,{key:2},[c.grade!==null&&c.grade!==void 0?(d(),_("span",Ns,o(c.grade.toFixed(1)),1)):(d(),_("span",Es,"—"))],64)):(d(),_(x,{key:3},[r(o(c[n.dataIndex]||"—"),1)],64))]),_:1},8,["dataSource"])]),_:1})]),_:1}),t(v,{span:10},{default:s(()=>[t(C,{size:"small",title:"Lab sessions"},{default:s(()=>[t(O,{size:"small","data-source":u.value.labs},{renderItem:s(({item:n})=>[t(E,null,{default:s(()=>[a("div",Os,[a("div",Ps,o(n.challengeTitle),1),a("div",Us,[a("span",null,o(n.courseTitle||"No course"),1),e[45]||(e[45]=a("span",null,"•",-1)),a("span",null,"Status: "+o(n.status),1)]),a("div",Ls,[a("span",null,"Runtime: "+o(n.runtime||"—"),1),e[46]||(e[46]=a("span",null,"•",-1)),a("span",null,"Code server: "+o(n.codeServerUrl||"—"),1)])])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})]),_:1}),t(H,{key:"orders",tab:"Orders & Billing"},{default:s(()=>[a("div",Rs,[a("span",Ms,[t(g(we),{class:"section-icon"}),e[47]||(e[47]=r(" Orders related to this institution ",-1))])]),t(G,{size:"small",columns:He,dataSource:u.value.orders,"row-key":"orderId",pagination:{pageSize:5},style:{"margin-top":"8px"}},{bodyCell:s(({column:n,record:c})=>[n.key==="createdAt"?(d(),_(x,{key:0},[r(o(w(c.createdAt)),1)],64)):n.key==="items"?(d(),_("span",Bs,o(c.items.map(ne=>ne.courseTitle||ne.titleSnapshot).join(", ")),1)):n.key==="total"?(d(),_(x,{key:2},[r(o(c.total.toFixed(2))+" "+o(c.currency),1)],64)):(d(),_(x,{key:3},[r(o(c[n.dataIndex]),1)],64))]),_:1},8,["dataSource"])]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1}),t(v,{span:8},{default:s(()=>[t(T,{direction:"vertical",size:16,class:"portal-sidebar",style:{width:"100%"}},{default:s(()=>[t(C,{size:"small",title:"Quick stats"},{default:s(()=>[t(R,{column:1,size:"small"},{default:s(()=>[t(h,{label:"Departments"},{default:s(()=>[r(o(q.value.length)+" active ",1)]),_:1}),t(h,{label:"Classrooms"},{default:s(()=>[r(o(u.value.classrooms.length)+" total, "+o(J.value.length)+" mine ",1)]),_:1}),t(h,{label:"Courses"},{default:s(()=>[r(o(D.value.length)+" at this institution ",1)]),_:1}),t(h,{label:"Orders total"},{default:s(()=>[r(o(Le.value.toFixed(2))+" "+o(Re.value),1)]),_:1})]),_:1})]),_:1}),t(C,{size:"small",title:"Institution contact"},{default:s(()=>[a("p",js,o(u.value.institution.description||"No description provided."),1),t(R,{column:1,size:"small"},{default:s(()=>[t(h,{label:"Email"},{default:s(()=>[r(o(u.value.institution.email||"—"),1)]),_:1}),t(h,{label:"Phone"},{default:s(()=>[r(o(u.value.institution.phone||"—"),1)]),_:1}),t(h,{label:"Location"},{default:s(()=>[r(o(u.value.institution.location||"—"),1)]),_:1})]),_:1})]),_:1}),t(C,{size:"small",title:"System & metadata"},{default:s(()=>[t(R,{column:1,size:"small"},{default:s(()=>[t(h,{label:"Auth institution ID"},{default:s(()=>[r(o(u.value.authInstitution?.id||"—"),1)]),_:1}),t(h,{label:"Student ID"},{default:s(()=>[r(o(u.value.student.id),1)]),_:1}),t(h,{label:"User ID"},{default:s(()=>[r(o(u.value.user.id),1)]),_:1}),t(h,{label:"Student mirror ID"},{default:s(()=>[r(o(u.value.studentMirror?.id||"—"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))],64)):L.value?(d(),p(ut,{key:1,status:"error",title:"Failed to load institution view"},{subTitle:s(()=>[r(o(L.value),1)]),extra:s(()=>[t(b,{type:"primary",onClick:K},{default:s(()=>[...e[48]||(e[48]=[r("Retry",-1)])]),_:1})]),_:1})):z("",!0)]),_:1},8,["loading"])])}}}),Gs=kt(Fs,[["__scopeId","data-v-789f08b6"]]);export{Gs as default};
