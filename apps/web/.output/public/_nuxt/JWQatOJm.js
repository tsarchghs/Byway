import{g as Z,r as p,l as P,q as b,w as a,x as f,p as l,ak as ee,aj as te,o as C,b as e,L as ae,b5 as oe,d as _,bw as le,a as c,b3 as ne,t as g,K as T,n as D,_ as re}from"./DQDUwbr-.js";import{t as q}from"./DFP984fK.js";const ie={class:"preview"},se={class:"meta"},ue={class:"title"},ce={class:"tags"},de={class:"price"},pe="http://localhost:4000/api/teach-internal/graphql",me="http://localhost:4000",ve=Z({__name:"create",setup(fe){const m=p(!1);function E(){m.value=!m.value}const w=ee();function U(){w.back()}function V(){const r=te();return P(()=>{if(r.params.teacherId)return r.params.teacherId;if(typeof window<"u"){const o=window.location.pathname.split("/"),i=o.indexOf("teach-internal");return i!==-1?o[i+1]:null}return null})}const $=V(),k=r=>r.toLocaleString(void 0,{style:"currency",currency:"EUR"}),t=p({title:"",category:"",difficulty:"Beginner",description:"",price:0,discount:0,coverUrl:""}),I=P(()=>Number(t.value.price||0)*(1-Number(t.value.discount||0)/100)),j=[{label:"Beginner",value:"Beginner"},{label:"Intermediate",value:"Intermediate"},{label:"Advanced",value:"Advanced"}],S=p(),z={title:[{required:!0,message:"Title is required"}],price:[{type:"number",min:0,message:"Price must be ≥ 0"}],discount:[{type:"number",min:0,max:100,message:"0–100"}]};function x(){return{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}async function B(r,o){const s=await(await fetch(pe,{method:"POST",credentials:"include",headers:x(),body:JSON.stringify({query:r,variables:o})})).json();if(s.errors?.length)throw new Error(s.errors[0]?.message||"GraphQL error");return s.data}const A={createCourse:`
    mutation CreateCourse(
      $title:String!,
      $category:String,
      $difficulty:String,
      $description:String,
      $price:Float,
      $discount:Float,
      $teacherId:String!
    ){
      createCourse(
        title:$title,
        category:$category,
        difficulty:$difficulty,
        description:$description,
        price:$price,
        discount:$discount,
        teacherId:$teacherId
      ){ id }
    }
  `,updateCourseCover:`
    mutation UpdateCourse($id:String!, $coverUrl:String){
      updateCourse(id:$id, coverUrl:$coverUrl){ id }
    }
  `},G=p(!1),y=p(!1);async function Q(){try{await S.value?.validate()}catch{return}y.value=!0;try{const r={title:t.value.title.trim(),category:t.value.category.trim()||null,difficulty:t.value.difficulty||null,description:t.value.description||"",price:Number(t.value.price||0),discount:Number(t.value.discount||0),teacherId:$.value},i=(await B(A.createCourse,r)).createCourse.id,s=(t.value.coverUrl||"").trim();s&&await B(A.updateCourseCover,{id:i,coverUrl:s});const d=route.query?.classroomId||null;if(d)try{await fetch(`${me}/api/institutions/classrooms/${encodeURIComponent(d)}/bind-course`,{method:"POST",headers:x(),body:JSON.stringify({courseId:i})})}catch{}D.success("Course created"),w.push(`/teach-internal/${$.value}/course/${i}/module/new/view`)}catch(r){D.error(r?.message||"Create course failed")}finally{y.value=!1}}return(r,o)=>{const i=l("a-button"),s=l("a-tooltip"),d=l("a-space"),F=l("a-page-header"),h=l("a-input"),u=l("a-form-item"),J=l("a-select"),W=l("a-textarea"),N=l("a-input-number"),v=l("a-col"),O=l("a-row"),H=l("a-alert"),K=l("a-form"),R=l("a-card"),L=l("a-tag"),M=l("a-layout-content"),X=l("a-layout"),Y=l("a-config-provider");return C(),b(Y,{theme:{algorithm:m.value?f(q).darkAlgorithm:f(q).defaultAlgorithm}},{default:a(()=>[e(X,{class:ae(["admin-wrap",m.value?"is-dark":""])},{default:a(()=>[e(F,{class:"admin-header",title:"Create Course","sub-title":"Step 1 • Basic details",onBack:U},{extra:a(()=>[e(d,null,{default:a(()=>[e(s,{title:"Toggle dark"},{default:a(()=>[e(i,{shape:"circle",onClick:E},{default:a(()=>[e(f(oe))]),_:1})]),_:1})]),_:1})]),_:1}),e(M,{class:"content"},{default:a(()=>[e(O,{gutter:16},{default:a(()=>[e(v,{md:16,xs:24},{default:a(()=>[e(R,{title:"Course details",loading:G.value},{default:a(()=>[e(K,{ref_key:"formRef",ref:S,layout:"vertical",model:t.value,rules:z},{default:a(()=>[e(u,{label:"Title",name:"title"},{default:a(()=>[e(h,{value:t.value.title,"onUpdate:value":o[0]||(o[0]=n=>t.value.title=n),placeholder:"e.g. Advanced Vue 3 Workshop"},null,8,["value"])]),_:1}),e(u,{label:"Category",name:"category"},{default:a(()=>[e(h,{value:t.value.category,"onUpdate:value":o[1]||(o[1]=n=>t.value.category=n),placeholder:"e.g. Programming"},null,8,["value"])]),_:1}),e(u,{label:"Difficulty",name:"difficulty"},{default:a(()=>[e(J,{value:t.value.difficulty,"onUpdate:value":o[2]||(o[2]=n=>t.value.difficulty=n),options:j},null,8,["value"])]),_:1}),e(u,{label:"Description",name:"description"},{default:a(()=>[e(W,{value:t.value.description,"onUpdate:value":o[3]||(o[3]=n=>t.value.description=n),rows:5,placeholder:"What will students learn?"},null,8,["value"])]),_:1}),e(O,{gutter:16},{default:a(()=>[e(v,{span:12},{default:a(()=>[e(u,{label:"Price (EUR)",name:"price"},{default:a(()=>[e(N,{value:t.value.price,"onUpdate:value":o[4]||(o[4]=n=>t.value.price=n),min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(v,{span:12},{default:a(()=>[e(u,{label:"Discount (%)",name:"discount"},{default:a(()=>[e(N,{value:t.value.discount,"onUpdate:value":o[5]||(o[5]=n=>t.value.discount=n),min:0,max:100,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(u,{label:"Cover URL (optional)",name:"coverUrl"},{default:a(()=>[e(h,{value:t.value.coverUrl,"onUpdate:value":o[6]||(o[6]=n=>t.value.coverUrl=n),placeholder:"https://…"},null,8,["value"])]),_:1}),e(H,{type:"info","show-icon":"",message:`Preview price: ${k(I.value)}`,class:"mb-2"},null,8,["message"]),e(d,null,{default:a(()=>[e(i,{onClick:U},{default:a(()=>[...o[7]||(o[7]=[_("Cancel",-1)])]),_:1}),e(i,{type:"primary",loading:y.value,onClick:Q},{default:a(()=>[e(f(le)),o[8]||(o[8]=_(" Create & Open Editor ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["loading"])]),_:1}),e(v,{md:8,xs:24},{default:a(()=>[e(R,{title:"Live preview"},{default:a(()=>[c("div",ie,[c("div",{class:"cover",style:ne({backgroundImage:t.value.coverUrl?`url('${t.value.coverUrl}')`:"linear-gradient(135deg,#111,#334155)"})},null,4),c("div",se,[c("div",ue,g(t.value.title||"Untitled course"),1),c("div",ce,[t.value.category?(C(),b(L,{key:0,color:"blue"},{default:a(()=>[_(g(t.value.category),1)]),_:1})):T("",!0),t.value.difficulty?(C(),b(L,{key:1,color:"gold"},{default:a(()=>[_(g(t.value.difficulty),1)]),_:1})):T("",!0)]),c("div",de,g(k(I.value)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["theme"])}}}),ye=re(ve,[["__scopeId","data-v-811cf927"]]);export{ye as default};
