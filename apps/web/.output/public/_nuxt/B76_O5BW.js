import{_ as v}from"./CJHmwYx0.js";import{u as k}from"./DL41CzME.js";import{u as C}from"./CI-SnmTa.js";import{g as $,U as q,ar as U,r as m,k as x,q as R,w as p,p as l,o as _,b as i,x as n,c as S,K as w,m as B,_ as b}from"./DQDUwbr-.js";const M={key:0,class:"muted mt-2"},N=$({__name:"enrollments",setup(P){const{gql:a}=k();q();const r=U(),{user:s,isLoggedIn:f}=C(),u=m(!0),d=m([]),y=[{title:"Course",dataIndex:"courseTitle",key:"courseTitle"},{title:"Progress",key:"progress",customRender:({record:e})=>(e.progressPct||0)+"%"},{title:"Updated",dataIndex:"updatedAt"},{title:"Actions",key:"actions",customRender:({record:e})=>B("a",{onClick:()=>I(e)},"Open")}];x(async()=>{try{if(!f.value||!s.value?.id){message.warning("Please sign in to see enrollments"),r.push("/login");return}await g();const c=await a("query { myEnrollments { id courseId progressPct updatedAt course { id title modules { id } } } }");d.value=(c.myEnrollments||[]).map(t=>({...t,courseTitle:t.course?.title||t.courseId,firstModuleId:t.course?.modules?.[0]?.id||null}))}finally{u.value=!1}});function I(e){e.firstModuleId?r.push(`/student/_/course/${encodeURIComponent(e.courseId)}/module/${encodeURIComponent(e.firstModuleId)}`):r.push(`/course/${encodeURIComponent(e.courseId)}`)}async function g(){const e=s.value?.userId||s.value.id;try{const o=await a("query($uid:String!){ studentByUserId(userId:$uid){ id } }",{uid:e});if(o?.studentByUserId?.id)return o.studentByUserId.id}catch{}return(await a("mutation($uid:String!,$name:String){ createStudent(userId:$uid, displayName:$name){ id } }",{uid:e,name:s.value.email||s.value.displayName||"Student"}))?.createStudent?.id}return(e,c)=>{const t=l("a-table"),o=l("a-card"),h=l("a-layout");return _(),R(h,{class:"p-6"},{default:p(()=>[i(v,{subtitle:"My Enrollments"}),i(o,{loading:n(u),bordered:!1},{default:p(()=>[i(t,{"data-source":n(d),columns:y,"row-key":"id"},null,8,["data-source"]),!n(u)&&!n(d).length?(_(),S("div",M,"No enrollments yet.")):w("",!0)]),_:1},8,["loading"])]),_:1})}}}),G=b(N,[["__scopeId","data-v-1e74c2a4"]]);export{G as default};
