import{g as H,U as M,W as F,l as S,r as d,k as z,c as A,b as t,w as n,n as K,p as s,o as $,q as W,K as N,a as l,d as G,t as Q,_ as X}from"./DQDUwbr-.js";const Y={class:"institution-calendar"},Z=["href"],ee=["href"],te=["href"],ae=["href"],ne=["href"],oe=["href"],se=["href"],ie=["href"],re=H({__name:"index",setup(le){const C=M(),x=F(),p=x.public?.apiBase||x.public?.appBaseUrl||"",w=S(()=>C.query.institutionId||C.params?.institution_id||"inst_byway"),b=d(!0),_=d([]),f=d(void 0),h=d(void 0),u=d("none"),j=d(null);function q(){if(typeof window>"u")return null;const e=localStorage.getItem("token")||localStorage.getItem("access_token")||"";return e?e.startsWith("Bearer")?e:`Bearer ${e}`:null}async function B(){b.value=!0;try{const e=q();if(!e)throw new Error("Missing auth token");const a=p?p.replace(/\/$/,""):"",o=new URLSearchParams;o.set("institutionId",w.value),f.value&&o.set("from",String(f.value)),h.value&&o.set("to",String(h.value));const v=`${a}/api/institution-portal/calendar?${o.toString()}`,i=await fetch(v,{headers:{Authorization:e}});if(!i.ok)throw new Error(await i.text().catch(()=>`HTTP ${i.status}`));const g=await i.json();_.value=g.events||[]}catch(e){K.error(e?.message||"Failed to load calendar")}finally{b.value=!1}}z(B);const E=S(()=>_.value.filter(e=>e.kind==="assignment").length),O=S(()=>_.value.filter(e=>e.kind==="lab").length),P=[{title:"Type",dataIndex:"kind",key:"kind"},{title:"Title",dataIndex:"title",key:"title"},{title:"Classroom",dataIndex:"classroomName",key:"classroomName"},{title:"Date",dataIndex:"date",key:"date"}];function D(e){return e.kind==="assignment"&&e.assignmentId&&e.institutionSlug?`/institutions/${e.institutionSlug}/assignments/${e.assignmentId}/grading`:e.kind==="lab"?"/teach/labs":"#"}function r(e){const a=`?institutionId=${encodeURIComponent(w.value)}`;return e==="overview"?`/institution/portal${a}`:e==="departments"?`/institution/departments/${a}`:e==="classrooms"?`/institution/classrooms/${a}`:e==="people"?`/institution/people${a}`:e==="catalog"?`/institution/catalog${a}`:e==="calendar"?`/institution/calendar${a}`:e==="assignments"?`/institution/assignments/teachers${a}`:`/institution/portal${a}`}async function J(){try{const e=q();if(!e)return;const a=p?p.replace(/\/$/,""):"",i=(await(await fetch(`${a}/api/authentication/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:e},body:JSON.stringify({query:"query Me { me { id } }"})})).json().catch(()=>null))?.data?.me?.id||null;if(j.value=i,!i){u.value="none";return}const y=await(await fetch(`${a}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:e},body:JSON.stringify({query:"query($institutionId:String!){ members(institutionId:$institutionId){ userId role } }",variables:{institutionId:w.value}})})).json().catch(()=>null),I=(Array.isArray(y?.data?.members)?y.data.members:[]).find(k=>k.userId===i),c=String(I?.role||"").toLowerCase();c.includes("admin")?u.value="admin":c.includes("teach")?u.value="teacher":c.includes("student")?u.value="student":u.value="none"}catch{}}return z(J),(e,a)=>{const o=s("a-menu-item"),v=s("a-menu"),i=s("a-date-picker"),g=s("a-button"),y=s("a-space"),R=s("a-page-header"),I=s("a-table"),c=s("a-card"),k=s("a-col"),T=s("a-statistic"),L=s("a-row"),V=s("a-skeleton");return $(),A("div",Y,[t(R,{title:"Institution Schedule"},{extra:n(()=>[t(y,null,{default:n(()=>[t(v,{mode:"horizontal",selectedKeys:["calendar"]},{default:n(()=>[t(o,{key:"overview"},{default:n(()=>[l("a",{href:r("overview")},"Overview",8,Z)]),_:1}),u.value==="admin"?($(),W(o,{key:"departments"},{default:n(()=>[l("a",{href:r("departments")},"Departments",8,ee)]),_:1})):N("",!0),t(o,{key:"classrooms"},{default:n(()=>[l("a",{href:r("classrooms")},"Classrooms",8,te)]),_:1}),t(o,{key:"people"},{default:n(()=>[l("a",{href:r("people")},"People Directory",8,ae)]),_:1}),t(o,{key:"catalog"},{default:n(()=>[l("a",{href:r("catalog")},"Catalog",8,ne)]),_:1}),t(o,{key:"calendar"},{default:n(()=>[l("a",{href:r("calendar")},"Calendar",8,oe)]),_:1}),t(o,{key:"assignments"},{default:n(()=>[l("a",{href:r("assignments")},"Assignments",8,se)]),_:1})]),_:1}),t(i,{value:f.value,"onUpdate:value":a[0]||(a[0]=m=>f.value=m),placeholder:"From"},null,8,["value"]),t(i,{value:h.value,"onUpdate:value":a[1]||(a[1]=m=>h.value=m),placeholder:"To"},null,8,["value"]),t(g,{size:"small",onClick:B},{default:n(()=>[...a[2]||(a[2]=[G("Reload",-1)])]),_:1})]),_:1})]),_:1}),t(V,{loading:b.value,active:"",paragraph:{rows:8}},{default:n(()=>[t(L,{gutter:16},{default:n(()=>[t(k,{span:14},{default:n(()=>[t(c,{size:"small",title:"Upcoming Events"},{default:n(()=>[t(I,{size:"small",columns:P,dataSource:_.value,"row-key":"id"},{bodyCell:n(({column:m,record:U})=>[m.dataIndex==="title"?($(),A("a",{key:0,href:D(U)},Q(U.title),9,ie)):N("",!0)]),_:1},8,["dataSource"])]),_:1})]),_:1}),t(k,{span:10},{default:n(()=>[t(c,{size:"small",title:"Summary"},{default:n(()=>[t(T,{title:"Assignments",value:E.value},null,8,["value"]),t(T,{title:"Lab Sessions",value:O.value,style:{"margin-top":"8px"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])}}}),ce=X(re,[["__scopeId","data-v-cbe53188"]]);export{ce as default};
