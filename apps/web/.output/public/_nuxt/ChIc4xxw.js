import{g as D,r as m,l as x,k as P,c as d,b as g,w as _,n as w,p as c,o as i,a as l,K as p,d as v,t as r,I as E,J as R,q as V}from"./DQDUwbr-.js";const j={class:"p-4"},U={key:0},$={class:"mb-3 text-sm text-gray-700"},G={key:0},M={key:1},O={key:2},q={key:0},z={class:"text-xs text-gray-600"},J={key:0},K={key:0,class:"mt-1 text-sm"},H={key:0,class:"text-sm text-gray-500"},Q={key:1,class:"text-sm text-gray-500"},Y=D({__name:"submissions",setup(W){const h=m(!1),y=m([]);m({});const k=m(!1),I=m(!1),b=m(null),s=m(null);async function S(){h.value=!0;try{const n=await fetch("http://localhost:4000/api/teacher-course-lab/teacher/submissions"),e=await n.json();if(!n.ok)throw new Error(e?.error||"Failed to load submissions");y.value=(e.items||[]).map(o=>({...o,bindings:[o.courseId,o.moduleId,o.lessonId].filter(Boolean).join(" / "),createdAtFormatted:o.createdAt?new Date(o.createdAt).toLocaleString():""}))}catch(n){console.error(n),w.error(n?.message||"Failed to load submissions")}finally{h.value=!1}}const F=x(()=>{const n=new Set,e=new Set;y.value.forEach(t=>{t.challengeTitle&&n.add(t.challengeTitle),t.status&&e.add(t.status)});const o=Array.from(n).map(t=>({text:t,value:t})),u=Array.from(e).map(t=>({text:t,value:t}));return[{title:"Challenge",dataIndex:"challengeTitle",key:"challengeTitle",filters:o,onFilter:(t,f)=>f.challengeTitle===t},{title:"Student",dataIndex:"sessionUserId",key:"student"},{title:"Status",dataIndex:"status",key:"status",filters:u,onFilter:(t,f)=>f.status===t},{title:"Grade %",dataIndex:"gradePct",key:"gradePct"},{title:"Difficulty",dataIndex:"difficulty",key:"difficulty"},{title:"Bindings",dataIndex:"bindings",key:"bindings"},{title:"Submitted",dataIndex:"createdAtFormatted",key:"createdAt"}]});async function A(n){if(n?.sessionId){b.value=n.sessionId,k.value=!0,I.value=!0,s.value=null;try{const e=await fetch(`/api/teacher-course-lab/teacher/submissions/session/${n.sessionId}`),o=await e.json();if(!e.ok)throw new Error(o?.error||"Failed to load session history");const u=o.session;u&&(u.submissions=(u.submissions||[]).map(t=>({...t,createdAtFormatted:t.createdAt?new Date(t.createdAt).toLocaleString():"",updatedAtFormatted:t.updatedAt?new Date(t.updatedAt).toLocaleString():""}))),s.value=u}catch(e){console.error(e),w.error(e?.message||"Failed to load session history")}finally{I.value=!1}}}const C=x(()=>s.value?`Submission history · ${s.value.challenge?.title||"Challenge"} · Student ${s.value.userId}`:"Submission history");return P(S),(n,e)=>{const o=c("a-page-header"),u=c("a-alert"),t=c("a-table"),f=c("a-card"),T=c("a-timeline-item"),B=c("a-timeline"),L=c("a-spin"),N=c("a-drawer");return i(),d("div",j,[g(o,{title:"Teacher • Lab Submissions","sub-title":"Review student attempts, grades, and course bindings for your challenges"}),g(f,null,{default:_(()=>[g(u,{type:"info","show-icon":"",class:"mb-3",message:"Tip",description:"Click any row to see the full submission history for that lab session, including all attempts and feedback."}),g(t,{columns:F.value,"data-source":y.value,loading:h.value,"row-key":"id",size:"small",customRow:a=>({onClick:()=>A(a)})},null,8,["columns","data-source","loading","customRow"])]),_:1}),g(N,{open:k.value,"onUpdate:open":e[0]||(e[0]=a=>k.value=a),width:480,title:C.value,destroyOnClose:!0},{default:_(()=>[g(L,{spinning:I.value},{default:_(()=>[s.value?(i(),d("div",U,[l("div",$,[l("div",null,[e[1]||(e[1]=l("strong",null,"Challenge:",-1)),v(" "+r(s.value.challenge?.title),1)]),l("div",null,[e[2]||(e[2]=l("strong",null,"Student:",-1)),v(" "+r(s.value.userId),1)]),l("div",null,[e[3]||(e[3]=l("strong",null,"Bindings:",-1)),s.value.challenge?.courseId?(i(),d("span",G,"Course "+r(s.value.challenge.courseId),1)):p("",!0),s.value.challenge?.moduleId?(i(),d("span",M," · Module "+r(s.value.challenge.moduleId),1)):p("",!0),s.value.challenge?.lessonId?(i(),d("span",O," · Lesson "+r(s.value.challenge.lessonId),1)):p("",!0)])]),g(B,null,{default:_(()=>[(i(!0),d(E,null,R(s.value.submissions,a=>(i(),V(T,{key:a.id},{default:_(()=>[l("div",null,[e[6]||(e[6]=l("strong",null,"Status:",-1)),v(" "+r(a.status)+" ",1),a.gradePct!==null&&a.gradePct!==void 0?(i(),d("span",q,[e[4]||(e[4]=v(" · ",-1)),e[5]||(e[5]=l("strong",null,"Grade:",-1)),v(" "+r(a.gradePct)+"% ",1)])):p("",!0)]),l("div",z,[l("span",null,"Created: "+r(a.createdAtFormatted),1),a.updatedAtFormatted?(i(),d("span",J," · Updated: "+r(a.updatedAtFormatted),1)):p("",!0)]),a.feedback?(i(),d("div",K,[e[7]||(e[7]=l("strong",null,"Feedback:",-1)),v(" "+r(a.feedback),1)])):p("",!0)]),_:2},1024))),128))]),_:1}),!s.value.submissions||!s.value.submissions.length?(i(),d("div",H," No submissions for this session yet. ")):p("",!0)])):(i(),d("div",Q," No session selected. "))]),_:1},8,["spinning"])]),_:1},8,["open","title"])])}}});export{Y as default};
