import{g as W,U as F,W as L,l as j,r as c,k as N,c as T,b as e,w as t,n as Y,p as o,o as S,q as G,K as D,a as u,d as h,t as v,_ as Q}from"./DQDUwbr-.js";const X={class:"department-overview"},Z=["href"],ee=["href"],te=["href"],ae=["href"],ne=["href"],oe=["href"],se=["href"],ie=["href"],le=W({__name:"[departmentId]",setup(re){const y=F(),R=L(),g=R.public?.apiBase||R.public?.appBaseUrl||"",C=j(()=>String(y.params.departmentId||y.params.id||"")),I=j(()=>y.query.institutionId||y.params?.institution_id||"inst_byway"),b=c(!0),d=c("none"),O=c(null),z=c(null),m=c(null),$=c([]),U=c([]);function q(){if(typeof window>"u")return null;const a=localStorage.getItem("token")||localStorage.getItem("access_token")||"";return a?a.startsWith("Bearer")?a:`Bearer ${a}`:null}async function B(){b.value=!0;try{const a=q();if(!a)throw new Error("Missing auth token");const s=`${g?g.replace(/\/$/,""):""}/api/institution-portal/departments/${encodeURIComponent(C.value)}/overview?institutionId=${encodeURIComponent(I.value)}`,r=await fetch(s,{headers:{Authorization:a}});if(!r.ok)throw new Error(await r.text().catch(()=>`HTTP ${r.status}`));const i=await r.json();z.value=i.institution||null,m.value=i.department||null,$.value=i.classrooms||[],U.value=i.courses||[]}catch(a){Y.error(a?.message||"Failed to load department")}finally{b.value=!1}}N(B),N(P);const H=[{title:"Title",dataIndex:"title",key:"title"},{title:"Code",dataIndex:"code",key:"code"},{title:"Capacity",dataIndex:"capacity",key:"capacity"},{title:"Status",dataIndex:"status",key:"status"}],J=[{title:"Course",dataIndex:"title",key:"title"},{title:"Category",dataIndex:"category",key:"category"},{title:"Difficulty",dataIndex:"difficulty",key:"difficulty"}];function l(a){const n=`?institutionId=${encodeURIComponent(I.value)}`;return a==="overview"?`/institution/portal${n}`:a==="departments"?`/institution/departments/${encodeURIComponent(C.value)}${n}`:a==="classrooms"?`/institution/classrooms/${encodeURIComponent($.value[0]?.id||"")}${n}`:a==="people"?`/institution/people${n}`:a==="catalog"?`/institution/catalog${n}`:a==="calendar"?`/institution/calendar${n}`:a==="assignments"?`/institution/assignments/teachers${n}`:`/institution/portal${n}`}async function P(){try{const a=q();if(!a)return;const n=g?g.replace(/\/$/,""):"",i=(await(await fetch(`${n}/api/authentication/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:a},body:JSON.stringify({query:"query Me { me { id } }"})})).json().catch(()=>null))?.data?.me?.id||null;if(O.value=i,!i){d.value="none";return}const w=await(await fetch(`${n}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:a},body:JSON.stringify({query:"query($institutionId:String!){ members(institutionId:$institutionId){ userId role } }",variables:{institutionId:I.value}})})).json().catch(()=>null),f=(Array.isArray(w?.data?.members)?w.data.members:[]).find(_=>_.userId===i),p=String(f?.role||"").toLowerCase();p.includes("admin")?d.value="admin":p.includes("teach")?d.value="teacher":p.includes("student")?d.value="student":d.value="none"}catch{}}return(a,n)=>{const s=o("a-menu-item"),r=o("a-menu"),i=o("a-button"),A=o("a-space"),w=o("a-page-header"),k=o("a-table"),f=o("a-card"),p=o("a-col"),_=o("a-descriptions-item"),V=o("a-descriptions"),E=o("a-row"),M=o("a-skeleton");return S(),T("div",X,[e(w,{title:m.value?.name||"Department","sub-title":m.value?.slug||C.value},{extra:t(()=>[e(A,null,{default:t(()=>[e(r,{mode:"horizontal",selectedKeys:["departments"]},{default:t(()=>[e(s,{key:"overview"},{default:t(()=>[u("a",{href:l("overview")},"Overview",8,Z)]),_:1}),d.value==="admin"?(S(),G(s,{key:"departments"},{default:t(()=>[u("a",{href:l("departments")},"Departments",8,ee)]),_:1})):D("",!0),e(s,{key:"classrooms"},{default:t(()=>[u("a",{href:l("classrooms")},"Classrooms",8,te)]),_:1}),e(s,{key:"people"},{default:t(()=>[u("a",{href:l("people")},"People Directory",8,ae)]),_:1}),e(s,{key:"catalog"},{default:t(()=>[u("a",{href:l("catalog")},"Catalog",8,ne)]),_:1}),e(s,{key:"calendar"},{default:t(()=>[u("a",{href:l("calendar")},"Calendar",8,oe)]),_:1}),e(s,{key:"assignments"},{default:t(()=>[u("a",{href:l("assignments")},"Assignments",8,se)]),_:1})]),_:1}),e(i,{size:"small",onClick:B},{default:t(()=>[...n[0]||(n[0]=[h("Reload",-1)])]),_:1})]),_:1})]),_:1},8,["title","sub-title"]),e(M,{loading:b.value,active:"",paragraph:{rows:8}},{default:t(()=>[e(E,{gutter:16},{default:t(()=>[e(p,{span:16},{default:t(()=>[e(f,{size:"small",title:"Classrooms"},{default:t(()=>[e(k,{size:"small",columns:H,dataSource:$.value,"row-key":"id"},{bodyCell:t(({column:K,record:x})=>[K.dataIndex==="title"?(S(),T("a",{key:0,href:`/institution/classrooms/${x.id}?institutionId=${encodeURIComponent(I.value)}`},v(x.title||x.code),9,ie)):D("",!0)]),_:1},8,["dataSource"])]),_:1}),e(f,{size:"small",title:"Courses",style:{"margin-top":"16px"}},{default:t(()=>[e(k,{size:"small",columns:J,dataSource:U.value,"row-key":"courseId"},null,8,["dataSource"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(f,{size:"small",title:"Department"},{default:t(()=>[e(V,{column:1,size:"small"},{default:t(()=>[e(_,{label:"Institution"},{default:t(()=>[h(v(z.value?.name),1)]),_:1}),e(_,{label:"Contact"},{default:t(()=>[h(v(m.value?.contact||"—"),1)]),_:1}),e(_,{label:"Head"},{default:t(()=>[h(v(m.value?.head||"—"),1)]),_:1}),e(_,{label:"Active"},{default:t(()=>[h(v(m.value?.active?"Yes":"No"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])}}}),ue=Q(le,[["__scopeId","data-v-4fb3c716"]]);export{ue as default};
