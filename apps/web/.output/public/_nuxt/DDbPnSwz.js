import{useKV as z}from"./CozDb8FN.js";import{g as Q,U as W,ar as X,l as Y,r as m,k as Z,q as h,w as a,p as n,o as ee,b as t,d as u,x as N,bt as te,aD as ae,m as y,a as ne,af as oe,_ as se}from"./DQDUwbr-.js";function ue(C="http://localhost:4000/api/students-internal/graphql"){async function f(r,p={}){const l=await(await fetch(C,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({query:r,variables:p}),credentials:"include"})).json();if(l.errors)throw new Error(l.errors.map(i=>i.message).join("; "));return l.data}return{async list(r){return(await f("query($courseId:ID!){ courseGradebook(courseId:$courseId){ id assignmentId studentId courseId grade feedback updatedAt } }",{courseId:r}))?.courseGradebook||[]},async upsert(r){return(await f("mutation($input:GradebookInput!){ upsertGrade(input:$input){ id assignmentId studentId courseId grade feedback updatedAt } }",{input:r}))?.upsertGrade}}}const re={class:"mt-2"},de=Q({__name:"gradebook",setup(C){const f=W();X();const r=Y(()=>String(f.query.courseId||f.params.courseId||"course-1")),p=ue(),b=z(),l=m(!1),i=m([]),S=m("grades"),v=m(!1),c=m({id:"",assignmentId:"",studentId:"",courseId:"",grade:0,feedback:""}),_=m(""),O=[{title:"Student",dataIndex:"studentId",key:"student"},{title:"Assignment",dataIndex:"assignmentId",key:"assignment"},{title:"Grade",dataIndex:"grade",key:"grade",customRender:({text:o,record:e})=>y("div",{},o??"—")},{title:"Feedback",dataIndex:"feedback",key:"feedback",ellipsis:!0},{title:"Actions",key:"actions",customRender:({record:o})=>y("div",{},[y("a-button",{type:"link",onClick:()=>q(o)},{default:()=>[y(oe)," Edit"]})])}];function q(o){c.value={...o},v.value=!0}async function $(){l.value=!0;try{i.value=await p.list(r.value)}finally{l.value=!1}}async function U(){const o=await p.upsert({...c.value,courseId:r.value}),e=i.value.findIndex(k=>k.id===o.id);e>=0?i.value[e]=o:i.value.unshift(o),v.value=!1}async function A(){await b.set(`rubric:${r.value}`,_.value)}async function E(){_.value=await b.get(`rubric:${r.value}`)||""}return Z($),(o,e)=>{const k=n("StudentsNav"),G=n("a-tag"),d=n("a-button"),K=n("a-divider"),g=n("a-space"),V=n("a-page-header"),I=n("a-breadcrumb-item"),j=n("a-breadcrumb"),B=n("a-table"),w=n("a-tab-pane"),D=n("a-empty"),F=n("a-alert"),x=n("a-textarea"),J=n("a-tabs"),M=n("a-card"),P=n("a-input-number"),R=n("a-form-item"),T=n("a-form"),H=n("a-drawer"),L=n("a-layout");return ee(),h(L,{class:"p-6"},{default:a(()=>[t(k),t(V,{title:"Gradebook","sub-title":r.value?`Course · ${r.value}`:"Select course",onBack:e[2]||(e[2]=s=>o.$router.push("/")),class:"mb-4"},{tags:a(()=>[t(G,{color:"blue"},{default:a(()=>[...e[10]||(e[10]=[u("Students",-1)])]),_:1}),t(G,{color:"purple"},{default:a(()=>[...e[11]||(e[11]=[u("Assessments",-1)])]),_:1})]),extra:a(()=>[t(g,{wrap:""},{default:a(()=>[t(d,{onClick:$},{default:a(()=>[t(N(te)),e[12]||(e[12]=u(" Refresh",-1))]),_:1}),t(d,{type:"primary",onClick:o.openRubric},{default:a(()=>[t(N(ae)),e[13]||(e[13]=u(" Rubric",-1))]),_:1},8,["onClick"]),t(K,{type:"vertical"}),t(d,{onClick:e[0]||(e[0]=s=>o.$router.push("/students/dashboard"))},{default:a(()=>[...e[14]||(e[14]=[u("Dashboard",-1)])]),_:1}),t(d,{onClick:e[1]||(e[1]=s=>o.$router.push("/courses"))},{default:a(()=>[...e[15]||(e[15]=[u("My Courses",-1)])]),_:1})]),_:1})]),_:1},8,["sub-title"]),t(j,{class:"mb-4"},{default:a(()=>[t(I,{onClick:e[3]||(e[3]=s=>o.$router.push("/")),class:"cursor-pointer"},{default:a(()=>[...e[16]||(e[16]=[u("Home",-1)])]),_:1}),t(I,null,{default:a(()=>[...e[17]||(e[17]=[u("Students",-1)])]),_:1}),t(I,null,{default:a(()=>[...e[18]||(e[18]=[u("Gradebook",-1)])]),_:1})]),_:1}),t(M,{bordered:!1},{default:a(()=>[t(J,{activeKey:S.value,"onUpdate:activeKey":e[5]||(e[5]=s=>S.value=s)},{default:a(()=>[t(w,{key:"grades",tab:"Grades"},{default:a(()=>[t(B,{"data-source":i.value,columns:O,"row-key":"id",loading:l.value},null,8,["data-source","loading"])]),_:1}),t(w,{key:"comments",tab:"Comments"},{default:a(()=>[t(D,{description:"Select a row and add feedback in Grades tab."})]),_:1}),t(w,{key:"rubric",tab:"Rubric"},{default:a(()=>[t(F,{type:"info",message:"Store rubric JSON via server KV (no localStorage)","show-icon":"",class:"mb-2"}),t(x,{value:_.value,"onUpdate:value":e[4]||(e[4]=s=>_.value=s),rows:10},null,8,["value"]),ne("div",re,[t(g,null,{default:a(()=>[t(d,{type:"primary",onClick:A},{default:a(()=>[...e[19]||(e[19]=[u("Save rubric",-1)])]),_:1}),t(d,{onClick:E},{default:a(()=>[...e[20]||(e[20]=[u("Load rubric",-1)])]),_:1})]),_:1})])]),_:1})]),_:1},8,["activeKey"])]),_:1}),t(H,{open:v.value,"onUpdate:open":e[9]||(e[9]=s=>v.value=s),title:"Edit grade",placement:"right",width:"420"},{default:a(()=>[t(T,{layout:"vertical",onFinish:U},{default:a(()=>[t(R,{label:"Grade"},{default:a(()=>[t(P,{value:c.value.grade,"onUpdate:value":e[6]||(e[6]=s=>c.value.grade=s),min:0,max:100,style:{width:"100%"}},null,8,["value"])]),_:1}),t(R,{label:"Feedback"},{default:a(()=>[t(x,{value:c.value.feedback,"onUpdate:value":e[7]||(e[7]=s=>c.value.feedback=s),rows:5},null,8,["value"])]),_:1}),t(g,null,{default:a(()=>[t(d,{onClick:e[8]||(e[8]=s=>v.value=!1)},{default:a(()=>[...e[21]||(e[21]=[u("Cancel",-1)])]),_:1}),t(d,{type:"primary","html-type":"submit"},{default:a(()=>[...e[22]||(e[22]=[u("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}}),pe=se(de,[["__scopeId","data-v-2e6fd3c8"]]);export{pe as default};
