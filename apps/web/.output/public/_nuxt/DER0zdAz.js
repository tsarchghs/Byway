import{g as te,U as ae,W as ne,l as q,r as l,k as V,c as D,b as t,w as e,n as se,p as s,o as m,q as k,K as f,a as g,d as i,t as u,_ as oe}from"./DQDUwbr-.js";const le={class:"classroom-overview"},ie=["href"],ue=["href"],re=["href"],de=["href"],ce=["href"],me=["href"],pe=["href"],_e=["href"],fe=["href"],ve=te({__name:"[classroomId]",setup(he){const x=ae(),j=ne(),z=j.public?.apiBase||j.public?.appBaseUrl||"",I=q(()=>String(x.params.classroomId||x.params.id||"")),b=q(()=>x.query.institutionId||x.params?.institution_id||"inst_byway"),U=l(!0),M=l("overview"),R=l(null),N=l(null),p=l(null),O=l([]),J=l([]),K=l([]),r=l("none"),H=l(null),_=l(null);function L(){if(typeof window>"u")return null;const a=localStorage.getItem("token")||localStorage.getItem("access_token")||"";return a?a.startsWith("Bearer")?a:`Bearer ${a}`:null}async function W(){U.value=!0;try{const a=L();if(!a)throw new Error("Missing auth token");const n=z?z.replace(/\/$/,""):"",d=`${n}/api/institution-portal/classrooms/${encodeURIComponent(I.value)}/overview?institutionId=${encodeURIComponent(b.value)}`,h=await fetch(d,{headers:{Authorization:a}});if(!h.ok)throw new Error(await h.text().catch(()=>`HTTP ${h.status}`));const o=await h.json();R.value=o.institution||null,N.value=o.department||null,p.value=o.classroom||null,O.value=o.assignments||[],J.value=o.lessons||[],K.value=o.students||[];const w=await(await fetch(`${n}/api/institution-portal/classrooms/${encodeURIComponent(I.value)}/classroom-course`,{headers:{Authorization:a}})).json().catch(()=>null);_.value=w||null}catch(a){se.error(a?.message||"Failed to load classroom")}finally{U.value=!1}}V(W),V(X);const F=q(()=>p.value?.teacherDisplayName||p.value?.teacherId||"—"),Y=[{title:"Title",dataIndex:"title",key:"title"},{title:"Due",dataIndex:"dueDate",key:"dueDate"}],G=[{title:"Module",dataIndex:"moduleTitle",key:"moduleTitle"},{title:"Lesson",dataIndex:"title",key:"title"},{title:"Type",dataIndex:"type",key:"type"}],Q=[{title:"Student",dataIndex:"displayName",key:"displayName"},{title:"Student ID",dataIndex:"studentId",key:"studentId"},{title:"Status",dataIndex:"status",key:"status"}];function v(a){const n=`?institutionId=${encodeURIComponent(b.value)}`;return r.value!=="admin"&&a==="departments"?`/institution/portal${n}`:r.value==="student"&&a==="assignments"?`/institution/portal${n}`:a==="overview"?`/institution/portal${n}`:a==="departments"?`/institution/departments/${encodeURIComponent(N.value?.id||"")}${n}`:a==="classrooms"?`/institution/classrooms/${encodeURIComponent(I.value)}${n}`:a==="people"?`/institution/people${n}`:a==="catalog"?`/institution/catalog${n}`:a==="calendar"?`/institution/calendar${n}`:a==="assignments"?`/institution/assignments/teachers${n}`:`/institution/portal${n}`}async function X(){try{const a=L();if(!a)return;const n=z?z.replace(/\/$/,""):"",o=(await(await fetch(`${n}/api/authentication/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:a},body:JSON.stringify({query:"query Me { me { id } }"})})).json().catch(()=>null))?.data?.me?.id||null;if(H.value=o,!o){r.value="none";return}const w=await(await fetch(`${n}/api/institutions/graphql`,{method:"POST",headers:{"content-type":"application/json",Authorization:a},body:JSON.stringify({query:"query($institutionId:String!){ members(institutionId:$institutionId){ userId role } }",variables:{institutionId:b.value}})})).json().catch(()=>null),y=(Array.isArray(w?.data?.members)?w.data.members:[]).find(B=>B.userId===o),$=String(y?.role||"").toLowerCase();$.includes("admin")?r.value="admin":$.includes("teach")?r.value="teacher":$.includes("student")?r.value="student":r.value="none"}catch{}}return(a,n)=>{const d=s("a-menu-item"),h=s("a-menu"),o=s("a-button"),A=s("a-space"),w=s("a-page-header"),T=s("a-table"),y=s("a-card"),$=s("a-tab-pane"),B=s("a-tabs"),P=s("a-col"),c=s("a-descriptions-item"),E=s("a-descriptions"),Z=s("a-row"),ee=s("a-skeleton");return m(),D("div",le,[t(w,{title:p.value?.title||p.value?.code||"Classroom","sub-title":p.value?.id||I.value},{extra:e(()=>[t(A,null,{default:e(()=>[t(h,{mode:"horizontal",selectedKeys:["classrooms"]},{default:e(()=>[t(d,{key:"overview"},{default:e(()=>[g("a",{href:v("overview")},"Overview",8,ie)]),_:1}),r.value==="admin"?(m(),k(d,{key:"departments"},{default:e(()=>[g("a",{href:v("departments")},"Departments",8,ue)]),_:1})):f("",!0),t(d,{key:"classrooms"},{default:e(()=>[g("a",{href:v("classrooms")},"Classrooms",8,re)]),_:1}),t(d,{key:"people"},{default:e(()=>[g("a",{href:v("people")},"People Directory",8,de)]),_:1}),t(d,{key:"catalog"},{default:e(()=>[g("a",{href:v("catalog")},"Catalog",8,ce)]),_:1}),t(d,{key:"calendar"},{default:e(()=>[g("a",{href:v("calendar")},"Calendar",8,me)]),_:1}),t(d,{key:"assignments"},{default:e(()=>[g("a",{href:v("assignments")},"Assignments",8,pe)]),_:1})]),_:1}),t(o,{size:"small",type:"link",href:`/institution/classrooms/${I.value}?institutionId=${encodeURIComponent(b.value)}`},{default:e(()=>[...n[1]||(n[1]=[i("Refresh",-1)])]),_:1},8,["href"]),r.value!=="student"?(m(),k(o,{key:0,size:"small",type:"primary",href:`/institution/classrooms/${I.value}/attendance?institutionId=${encodeURIComponent(b.value)}`},{default:e(()=>[...n[2]||(n[2]=[i("Attendance",-1)])]),_:1},8,["href"])):f("",!0)]),_:1})]),_:1},8,["title","sub-title"]),t(ee,{loading:U.value,active:"",paragraph:{rows:8}},{default:e(()=>[t(Z,{gutter:16},{default:e(()=>[t(P,{span:16},{default:e(()=>[t(B,{activeKey:M.value,"onUpdate:activeKey":n[0]||(n[0]=S=>M.value=S)},{default:e(()=>[t($,{key:"overview",tab:"Overview"},{default:e(()=>[t(y,{size:"small",title:"Assignments"},{default:e(()=>[t(T,{size:"small",columns:Y,dataSource:O.value,"row-key":"id"},{bodyCell:e(({column:S,record:C})=>[S.dataIndex==="title"?(m(),D("a",{key:0,href:R.value?.slug?`/institutions/${R.value.slug}/assignments/${C.id}/grading`:"#"},u(C.title),9,_e)):f("",!0)]),_:1},8,["dataSource"])]),_:1}),t(y,{size:"small",title:"Modules & Lessons",style:{"margin-top":"16px"}},{default:e(()=>[t(T,{size:"small",columns:G,dataSource:J.value,"row-key":"id"},null,8,["dataSource"])]),_:1})]),_:1}),r.value!=="student"?(m(),k($,{key:"people",tab:"People"},{default:e(()=>[t(y,{size:"small",title:"Enrolled Students"},{default:e(()=>[t(T,{size:"small",columns:Q,dataSource:K.value,"row-key":"studentId"},{bodyCell:e(({column:S,record:C})=>[S.dataIndex==="displayName"?(m(),D("a",{key:0,href:`/institution/students/${C.studentId}?institutionId=${encodeURIComponent(b.value)}`},u(C.displayName||C.studentId),9,fe)):f("",!0)]),_:1},8,["dataSource"])]),_:1})]),_:1})):f("",!0)]),_:1},8,["activeKey"])]),_:1}),t(P,{span:8},{default:e(()=>[t(y,{size:"small",title:"Classroom"},{default:e(()=>[t(E,{column:1,size:"small"},{default:e(()=>[t(c,{label:"Institution"},{default:e(()=>[i(u(R.value?.name),1)]),_:1}),t(c,{label:"Department"},{default:e(()=>[i(u(N.value?.name||"—"),1)]),_:1}),t(c,{label:"Teacher"},{default:e(()=>[i(u(F.value),1)]),_:1}),t(c,{label:"Capacity"},{default:e(()=>[i(u(p.value?.capacity??"—"),1)]),_:1}),t(c,{label:"Status"},{default:e(()=>[i(u(p.value?.status||"—"),1)]),_:1})]),_:1})]),_:1}),t(y,{size:"small",title:"Teach Course",style:{"margin-top":"16px"}},{default:e(()=>[t(E,{column:1,size:"small"},{default:e(()=>[t(c,{label:"Bound"},{default:e(()=>[i(u(_.value?.bound?"Yes":"No"),1)]),_:1}),_.value?.bound?(m(),k(c,{key:0,label:"Title"},{default:e(()=>[i(u(_.value?.course?.title),1)]),_:1})):f("",!0),_.value?.bound?(m(),k(c,{key:1,label:"Modules"},{default:e(()=>[i(u(_.value?.moduleCount),1)]),_:1})):f("",!0),_.value?.bound?(m(),k(c,{key:2,label:"Lessons"},{default:e(()=>[i(u(_.value?.lessonCount),1)]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])}}}),ge=oe(ve,[["__scopeId","data-v-6ea6fde8"]]);export{ge as default};
