import{_ as A}from"./CJHmwYx0.js";import{u as J}from"./CI-SnmTa.js";import{g as T,ar as z,W as D,r as g,k as L,n as C,q as _,w as n,p as u,o as d,b as i,c as U,I as M,J as F,a as l,b3 as K,K as W,t as $,d as w,_ as G}from"./DQDUwbr-.js";const H={class:"flex-between"},Q={key:0,class:"badge"},X={class:"meta"},Y={class:"title"},Z={class:"muted"},ee=T({__name:"my-courses",setup(te){const p=z(),{user:c,token:b,isLoggedIn:B}=J(),k=D().public?.apiBase||"http://localhost:4000",f=g(!1),v=g([]),y=g(null),I=g(null);async function N(t){try{return(await(await fetch(`${k}/api/teach-internal/graphql`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({query:`
          query ($id:String!) {
            course(id:$id) {
              id title category difficulty coverUrl
              modules { id title lessons { id duration } }
            }
          }
        `,variables:{id:t}})})).json())?.data?.course||null}catch{return null}}function R(t){const e=t.course?.coverUrl;return e?{backgroundImage:`url('${e}')`}:{backgroundImage:"linear-gradient(135deg,#1e3a8a,#2563eb)"}}async function h(t,e){const r=await(await fetch(`${k}/api/students-internal/graphql`,{method:"POST",headers:{"content-type":"application/json",...b.value?{Authorization:`Bearer ${b.value}`}:{}},body:JSON.stringify({query:t,variables:e})})).json();if(r.errors?.length)throw new Error(r.errors[0].message);return r.data}async function S(){if(y.value)return y.value;if(!c.value?.id)throw new Error("Not authenticated");let t;const e=c.value.userId||c.value.id;try{t=(await h("query($uid:String!){ studentByUserId(userId:$uid){ id } }",{uid:e}))?.studentByUserId?.id}catch{}if(t||(t=(await h("mutation($uid:String!,$name:String){ createStudent(userId:$uid, displayName:$name){ id } }",{uid:e,name:c.value.email||c.value.displayName||"Student"}))?.createStudent?.id),!t)throw new Error("Student profile not found");return y.value=t,t}async function q(){f.value=!0;try{const t=await S(),o=(await h(`
      query($sid:String!){
        myCourses(studentId:$sid){
          courseId
          enrolledAt
          course { id title category difficulty coverUrl modules { id title lessons { id duration } } }
        }
      }
    `,{sid:t}))?.myCourses||[],r=await Promise.all(o.map(async a=>{if(!a.course||a.course.title==="Course"||!a.course.category||!a.course.modules){const m=await N(a.courseId);m&&(a.course={...m})}return a}));v.value=r}catch(t){C.error(t?.message||"Unable to load courses")}finally{f.value=!1}}function j(t){const e=y.value||"student",o=t.courseId;p.push(`/student/${encodeURIComponent(e)}/course/${encodeURIComponent(o)}/module/${encodeURIComponent("mod-1")}`)}async function x(t){I.value=t.courseId;try{const e=await S(),o=t.course?.modules?.[0]?.id;o?p.push(`/student/${encodeURIComponent(e)}/course/${encodeURIComponent(t.courseId)}/module/${encodeURIComponent(o)}`):p.push(`/course/${encodeURIComponent(t.courseId)}`)}catch(e){C.error(e?.message||"Unable to open modules")}finally{I.value=null}}return L(()=>{if(!B.value){C.warning("Please sign in to see your courses"),p.push("/login");return}q()}),(t,e)=>{const o=u("a-button"),r=u("a-empty"),a=u("a-space"),m=u("a-card"),E=u("a-col"),V=u("a-row"),O=u("a-layout");return d(),_(O,{class:"p-6"},{default:n(()=>[i(A,{subtitle:"My Courses"}),i(m,{loading:f.value,bordered:!1},{title:n(()=>[l("div",H,[e[2]||(e[2]=l("span",null,"Enrolled courses",-1)),i(o,{type:"primary",onClick:e[0]||(e[0]=s=>t.$router.push("/categories"))},{default:n(()=>[...e[1]||(e[1]=[w("Browse more",-1)])]),_:1})])]),default:n(()=>[!f.value&&v.value.length===0?(d(),_(r,{key:0,description:"No enrollments yet."})):(d(),_(V,{key:1,gutter:[16,16]},{default:n(()=>[(d(!0),U(M,null,F(v.value,s=>(d(),_(E,{key:s.courseId,xs:24,sm:12,md:8,lg:6},{default:n(()=>[i(m,{hoverable:!0,class:"course-card"},{default:n(()=>[l("div",{class:"cover",style:K(R(s))},[s.course?.category?(d(),U("div",Q,$(s.course.category),1)):W("",!0)],4),l("div",X,[l("div",Y,$(s.course?.title||s.courseId),1),l("div",Z,$(s.course?.difficulty||"â€”"),1)]),i(a,{style:{"margin-top":"8px"}},{default:n(()=>[i(o,{block:"",onClick:P=>j(s)},{default:n(()=>[...e[3]||(e[3]=[w("View",-1)])]),_:1},8,["onClick"]),i(o,{type:"primary",block:"",onClick:P=>x(s),loading:I.value===s.courseId},{default:n(()=>[...e[4]||(e[4]=[w(" Continue ",-1)])]),_:1},8,["onClick","loading"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["loading"])]),_:1})}}}),re=G(ee,[["__scopeId","data-v-16cff019"]]);export{re as default};
