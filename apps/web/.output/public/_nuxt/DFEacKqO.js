import{g as K,U as M,W as Q,r as o,ad as B,q as O,w as l,p as s,o as k,b as a,x as n,a as y,bu as r,d as g,c as X,I as Y,J as Z,t as ee,m as te,bL as w}from"./DQDUwbr-.js";const ae={class:"mb-4 flex gap-2"},le={class:"mb-4"},ne={class:"mt-2 flex items-center gap-2"},re=K({__name:"admin",setup(se){const h=M(),b=Q().public?.apiBase||"http://localhost:4000",d=o(""),_=o(""),$=o(null),I=o(null),x=o([]),E=[{title:"Name",dataIndex:"name",key:"name"},{title:"Start",dataIndex:"startDate",key:"startDate"},{title:"End",dataIndex:"endDate",key:"endDate"}];async function U(){if(!d.value){x.value=[];return}const e=await $fetch(`${b}/api/teach-internal/graphql`,{method:"POST",body:{query:"query($courseId:String!){ classroomsByCourse(courseId:$courseId){ id name startDate endDate } }",variables:{courseId:d.value}}});x.value=e.data?.classroomsByCourse??[]}async function P(){if(!d.value||!_.value||!$.value||!I.value)return;await $fetch(`${b}/api/teach-internal/graphql`,{method:"POST",body:{query:"mutation($courseId:String!,$name:String!,$startDate:String!,$endDate:String!){ createClassroom(courseId:$courseId,name:$name,startDate:$startDate,endDate:$endDate){ id } }",variables:{courseId:d.value,name:_.value,startDate:w($.value).toISOString(),endDate:w(I.value).toISOString()}}}),await U()}B(d,U);const i=o(""),D=o([]),m=o(""),p=o(""),v=o(null),R=[{title:"Actions",key:"a",customRender:({record:u})=>te("a",{href:`/institutions/${h.params.slug}/assignments/${u.id}/grading`},"Grade")},{title:"Title",dataIndex:"title",key:"title"},{title:"Due",dataIndex:"dueDate",key:"dueDate"}];async function A(){if(!i.value){D.value=[];return}const e=await $fetch(`${b}/api/teach-internal/graphql`,{method:"POST",body:{query:"query($classroomId:String!){ assignmentsByClassroom(classroomId:$classroomId){ id title description dueDate } }",variables:{classroomId:i.value}}});D.value=e.data?.assignmentsByClassroom??[]}async function V(){if(!i.value||!m.value||!p.value||!v.value)return;await $fetch(`${b}/api/teach-internal/graphql`,{method:"POST",body:{query:"mutation($classroomId:String!,$title:String!,$description:String!,$dueDate:String!){ createAssignment(classroomId:$classroomId,title:$title,description:$description,dueDate:$dueDate){ id } }",variables:{classroomId:i.value,title:m.value,description:p.value,dueDate:w(v.value).toISOString()}}}),m.value="",p.value="",v.value=null,await A()}B(i,A);function N(u){const e=new FileReader;return e.onload=f=>{c.value=String(f.target?.result||"")},e.readAsText(u),!1}const c=o("");async function F(){if(!c.value)return;await $fetch(`${b}/api/students-internal/graphql`,{method:"POST",body:{query:"mutation($csv:String!){ bulkEnrollCsv(csv:$csv) }",variables:{csv:c.value}}}),c.value=""}return(u,e)=>{const f=s("a-input"),q=s("a-date-picker"),S=s("a-button"),T=s("a-table"),C=s("a-tab-pane"),L=s("a-select-option"),j=s("a-select"),G=s("a-textarea"),J=s("a-upload"),W=s("a-tabs"),z=s("a-card"),H=s("a-layout");return k(),O(H,{class:"p-6"},{default:l(()=>[a(z,{title:`Admin Â· ${n(h).params.slug}`,bordered:!1},{default:l(()=>[a(W,null,{default:l(()=>[a(C,{key:"classrooms",tab:"Classrooms"},{default:l(()=>[e[10]||(e[10]=y("p",{class:"mb-4"},"Create course classrooms bound to this institution.",-1)),y("div",ae,[a(f,{value:n(d),"onUpdate:value":e[0]||(e[0]=t=>r(d)?d.value=t:null),placeholder:"Course ID",style:{"max-width":"260px"}},null,8,["value"]),a(f,{value:n(_),"onUpdate:value":e[1]||(e[1]=t=>r(_)?_.value=t:null),placeholder:"Classroom name",style:{"max-width":"220px"}},null,8,["value"]),a(q,{value:n($),"onUpdate:value":e[2]||(e[2]=t=>r($)?$.value=t:null),placeholder:"Start date"},null,8,["value"]),a(q,{value:n(I),"onUpdate:value":e[3]||(e[3]=t=>r(I)?I.value=t:null),placeholder:"End date"},null,8,["value"]),a(S,{type:"primary",onClick:P},{default:l(()=>[...e[9]||(e[9]=[g("Create classroom",-1)])]),_:1})]),a(T,{"data-source":n(x),columns:E,"row-key":"id"},null,8,["data-source"])]),_:1}),a(C,{key:"assignments",tab:"Assignments"},{default:l(()=>[y("div",le,[a(j,{value:n(i),"onUpdate:value":e[4]||(e[4]=t=>r(i)?i.value=t:null),style:{"min-width":"260px"},placeholder:"Select classroom"},{default:l(()=>[(k(!0),X(Y,null,Z(n(x),t=>(k(),O(L,{key:t.id,value:t.id},{default:l(()=>[g(ee(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a(f,{value:n(m),"onUpdate:value":e[5]||(e[5]=t=>r(m)?m.value=t:null),placeholder:"Assignment title",style:{"max-width":"220px","margin-left":"8px"}},null,8,["value"]),a(f,{value:n(p),"onUpdate:value":e[6]||(e[6]=t=>r(p)?p.value=t:null),placeholder:"Description",style:{"max-width":"260px","margin-left":"8px"}},null,8,["value"]),a(q,{value:n(v),"onUpdate:value":e[7]||(e[7]=t=>r(v)?v.value=t:null),placeholder:"Due date",style:{"margin-left":"8px"}},null,8,["value"]),a(S,{type:"primary",onClick:V,style:{"margin-left":"8px"}},{default:l(()=>[...e[11]||(e[11]=[g("Create",-1)])]),_:1})]),a(T,{"data-source":n(D),columns:R,"row-key":"id"},null,8,["data-source"])]),_:1}),a(C,{key:"enrollments",tab:"Enrollments (CSV)"},{default:l(()=>[e[14]||(e[14]=y("p",{class:"mb-2"},[g("Paste rows: "),y("code",null,"studentId,courseId[,classroomId]")],-1)),a(G,{value:n(c),"onUpdate:value":e[8]||(e[8]=t=>r(c)?c.value=t:null),rows:6,placeholder:"s123,c101,clA\\ns124,c101,clA"},null,8,["value"]),y("div",ne,[a(J,{"before-upload":N,"show-upload-list":!1},{default:l(()=>[a(S,null,{default:l(()=>[...e[12]||(e[12]=[g("Upload CSV",-1)])]),_:1})]),_:1}),a(S,{type:"primary",onClick:F},{default:l(()=>[...e[13]||(e[13]=[g("Import",-1)])]),_:1})])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});export{re as default};
