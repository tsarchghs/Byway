import{g as ma,aG as Yl,k as Ce,bG as en,m as nt,c as b,bH as tn,bI as an,bg as ln,l as A,ad as ve,r as m,j as zt,aj as nn,aJ as on,q as U,w as l,ai as sn,n as T,p as y,o as p,b as t,L as da,K as I,x,b5 as un,d as r,H as rn,bw as ca,bJ as va,t as C,aF as pa,a as f,b3 as dn,G as F,I as E,J as K,af as cn,as as Dt,ag as ze,bn as vn,bK as pn,a0 as fn,_ as mn}from"./DQDUwbr-.js";import{g as yn}from"./Cq7Gmhky.js";const gn=Symbol.for("nuxt:client-only"),bn=ma({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(_e,{slots:we,attrs:De}){const Ee=Yl(!1);Ce(()=>{Ee.value=!0});const Ue=tn();return Ue&&(Ue._nuxtClientOnly=!0),an(gn,!0),()=>{if(Ee.value){const W=we.default?.();return W&&W.length===1?[en(W[0],De)]:W}const $e=we.fallback||we.placeholder;if($e)return nt($e);const Me=_e.fallback||_e.placeholder||"",ot=_e.fallbackTag||_e.placeholderTag||"span";return b(ot,De,Me)}}}),fa=globalThis.setInterval,kn={key:0,class:"mt-2",style:{padding:"0 24px"}},hn=["href"],Cn={key:1},_n={key:2},wn={key:3},Un={class:"sider-pad"},$n={key:0,class:"cover-meta"},In={class:"cover-title"},xn={class:"cover-tags"},Sn={class:"mod-actions"},Tn={class:"mt-1"},Nn=["href"],An={class:"kv-stack"},Ln={class:"kv-stack"},zn={class:"kv-stack"},Dn={class:"arg-stack"},En={key:0},Mn={class:"mt-1"},On={class:"preview-head"},Pn={class:"muted"},Rn={key:0},qn={key:0,class:"video-wrap"},jn=["src"],Fn={key:1,class:"video-fallback"},Gn=["href"],Jn={key:1},Bn={key:2},Kn={key:3},Qn={key:0},Hn={class:"mt-1"},Vn={key:0,class:"muted"},Wn={key:1,class:"muted"},Zn={key:2,class:"muted"},Xn={class:"flex items-center gap-2"},Yn={class:"mb-3 flex gap-2 items-center flex-wrap"},eo={class:"dim"},to={class:"flex gap-2"},ao={class:"mb-3 flex gap-2 items-center flex-wrap"},lo={class:"mb-3 flex gap-2 items-center flex-wrap"},no={class:"mb-3 flex gap-2 items-center flex-wrap"},oo={key:0,class:"dim"},so={class:"grid-analytics"},uo={class:"kpi"},ro={class:"kpi"},io={class:"kpi"},co={class:"flex items-center gap-2",style:{"margin-top":"8px"}},vo={class:"flex items-center gap-2",style:{"margin-bottom":"8px"}},po={class:"flex items-center gap-3",style:{"margin-top":"8px"}},fo={class:"flex items-center gap-3"},mo={class:"flex items-center gap-2",style:{"margin-bottom":"8px"}},yo=["onClick"],go="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh3Ymtzc2gwMDAwdWNrajNkcWI5ZzMxIiwiaWF0IjoxNzYzMjEzNjE2LCJleHAiOjE3NjM4MTg0MTZ9.HejankLa76UputaoFzUH6dEInCVZeGQtPAbmPkNpreo",bo="http://localhost:4000/api/teach-internal/graphql",ko="/api/teach-internal/files/upload",ho="http://localhost:4000/api/teach-internal",ae="http://localhost:4000/api/teacher-course-lab",Co=ma({__name:"view",setup(_e){const we=ln("teach-internal",Ot());fn(we);function De(a,e=null,o=null){const{result:c,error:s,loading:h}=sn(a,e,{errorPolicy:"all",fetchPolicy:"cache-and-network"});return{data:A(()=>s.value?(console.warn("[useSafeQuery] GraphQL error → using fallback",s.value),o):c.value||o),loading:h,error:s}}const Ee=yn`
  query Me {
    me {
      id
      email
      token
    }
  }
`,{result:Ue,error:$e}=De(Ee),Me={id:"cmhwbkssh0000uckj3dqb9g31",email:"student@example.com",token:go},ot=A(()=>$e.value?(console.warn("[ME] API failed → using mock token"),Me):Ue.value?.me?Ue.value.me:Me);ve($e,a=>{a&&console.error("[GraphQL Error]",a,a.networkError,a.message)});function W(){u.value&&(u.value.lab=ue(u.value.lab,u.value.lab?.kind||"BACKEND_NODE",!0)||Ta())}const ya=a=>a.toLocaleString(void 0,{style:"currency",currency:"EUR"}),Ie=()=>Math.random().toString(36).slice(2,9),ga=a=>a.split(",").map(e=>e.trim()).filter(Boolean),Et=a=>{if(!a)return"";if(/youtube\.com|youtu\.be/.test(a)){const e=a.match(/(?:v=|be\/)([A-Za-z0-9_-]{6,})/)?.[1];return e?`https://www.youtube.com/embed/${e}?rel=0`:""}return""},Oe=a=>{if(!a)return{};if(typeof a=="string")try{return JSON.parse(a)}catch{return{}}return typeof a=="object"?a:{}},G=nn();function J(a={}){const e=Ot(),o={};return a.json!==!1&&(o["Content-Type"]="application/json"),e&&(o.Authorization=`Bearer ${e}`),o}const ba=[{label:"JSON subset",value:"json-subset"},{label:"Contains text",value:"contains-text"},{label:"Exact JSON",value:"exact-json"}];function ka(a="*/*"){return typeof window>"u"?Promise.resolve(null):new Promise(e=>{const o=document.createElement("input");o.type="file",o.accept=a,o.onchange=()=>e(o.files?.[0]||null),o.click()})}function ha(a){return new Promise((e,o)=>{const c=new FileReader;c.onload=()=>e(String(c.result||"")),c.onerror=()=>o(c.error||new Error("File read failed")),c.readAsDataURL(a)})}async function Pe(a="course"){try{const e=await ka();if(!e)return null;if(e.size>25*1024*1024)return T.error("File too large (max 25MB)"),null;const o={fileName:e.name,data:await ha(e),kind:a},c=await fetch(ko,{method:"POST",headers:J(),credentials:"include",body:JSON.stringify(o)});if(!c.ok){const h=await c.text();throw new Error(h||`HTTP ${c.status}`)}const s=await c.json();if(!s?.ok||!s?.file?.url)throw new Error(s?.error||"Upload failed");return{url:s.file.url,name:s.file.name||e.name}}catch(e){return console.warn("[asset:upload]",e),T.error(e?.message||"Upload failed"),null}}m(!1);const Ca=m(""),_a=A(()=>{const a=u.value?.lab;return a?a.traefikHost&&a.traefikHost.trim()?`https://${a.traefikHost.trim()}`:a.devPort?`http://localhost:${a.devPort}`:"":""});function wa(a){a.pathParams||=[],a.query||=[],a.headers||=[],a.args||=[],a.auth||={type:"none"},a.expectMode||="json-subset"}function st(a){a.push({key:"",value:""}),v(!1)}function ut(a,e){a.splice(e,1),v()}function Ua(a){a.args.push({name:"",type:"string",required:!1,example:""}),v(!1)}function $a(a,e){a.args.splice(e,1),v()}A(()=>Ca.value||_a.value||"");const Ia=[{label:"Backend (Node)",value:"BACKEND_NODE"},{label:"Frontend (Nuxt)",value:"FRONTEND_NUXT"}],xa=[{label:"Node 18 (alpine)",value:"node:18-alpine"},{label:"Node 20 (alpine)",value:"node:20-alpine"},{label:"Node 22 (alpine)",value:"node:22-alpine"}],Sa=["GET","POST","PUT","DELETE","PATCH"].map(a=>({label:a,value:a})),u=A(()=>Re.value?.lessons?.[Q.value]);function ue(a,e="BACKEND_NODE",o=!1){if(!a&&!o)return;const c=a?.kind||e||"BACKEND_NODE",s=w=>(w||[]).map(j=>({key:j?.key||"",value:j?.value||""})),h=(a?.apiTests||[]).map((w,j)=>({id:w.id||Ie(),name:w.name||`Test ${j+1}`,method:w.method||"GET",path:w.path||"/api/health",expectedStatus:Number(w.expectedStatus||0)||200,points:Number(w.points||0)||0,bodyJson:w.bodyJson??"",expectJsonStr:w.expectJsonStr??"",expectTextLine:w.expectTextLine??"",pathParams:s(w.pathParams),query:s(w.query),headers:s(w.headers),args:w.args||[],auth:w.auth||{type:"none"},expectMode:w.expectMode||"json-subset"})),M=(a?.uiTests||[]).map((w,j)=>({id:w.id||Ie(),name:w.name||`UI ${j+1}`,path:w.path||"/",points:Number(w.points||0)||0,expectTextLine:w.expectTextLine??"",expectText:w.expectText||[]}));return{kind:c,dockerImage:a?.dockerImage||"node:22-alpine",buildCmd:a?.buildCmd||"npm install",startCmd:a?.startCmd||(c==="FRONTEND_NUXT"?"npm run dev":"npm start"),devPort:Number(a?.devPort||0)||3e3,traefikHost:a?.traefikHost||"",codeServer:a?.codeServer?{...a.codeServer}:{},apiTests:h,uiTests:M,lastRun:a?.lastRun}}function Ta(){return ue({kind:"BACKEND_NODE",dockerImage:"node:22-alpine",buildCmd:"npm install",startCmd:"npm start",devPort:3e3,traefikHost:"",codeServer:{},apiTests:[],uiTests:[]},"BACKEND_NODE",!0)||{kind:"BACKEND_NODE",dockerImage:"node:22-alpine"}}const q=m(0),Q=m(0),Re=A(()=>i.modules[q.value]);function Mt(a,e){q.value=a,Q.value=e,ct.value="lesson"}const i=zt({title:"",category:"",difficulty:"Beginner",description:"",price:0,discount:0,modules:[],files:[]});ve(()=>u.value?.type,a=>{a==="lab"&&W()},{immediate:!0});const rt=m(!1),it=m(!1);function Na(a){const e=a.match(/teach[-/]internal\/([^/]+)/i);return e?e[1]:null}async function Aa(){if(u.value?.lab?.codeServer?.containerId){rt.value=!0;try{const a=await wl();if(a)try{const o=await fetch(`${ae}/sessions/me`,{method:"GET",headers:J(),credentials:"include"});if(o.ok){const s=(await o.json()).sessions?.find(h=>h.challengeId===a.id&&h.status==="running");s&&await fetch(`${ae}/session/stop`,{method:"POST",headers:{"Content-Type":"application/json",...J()},credentials:"include",body:JSON.stringify({id:s.id})}).catch(()=>{})}}catch(o){console.warn("[LabSession] Failed to stop via API:",o)}const e=u.value.lab.codeServer.containerId;await fetch(`${ho}/code-server/stop`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({containerId:e})}).catch(()=>{})}finally{u.value.lab.codeServer={},rt.value=!1,v(!1)}}}function La(){const a=u.value?.lab?.codeServer?.url;a&&window.open(a,"_blank")}async function za(){if(!u.value?.id)return T.warning("Please save the lesson first");if(await Zt(),!(G.params.teacherId||G.query.teacherId||Na(G.path)||ot.value?.id))return T.warning("Missing teacherId");it.value=!0;try{const e=await Wt();if(!e)return T.error("Failed to create lab challenge");const o=await fetch(`${ae}/session/start`,{method:"POST",headers:{"Content-Type":"application/json",...J()},credentials:"include",body:JSON.stringify({challengeId:e.id})});if(!o.ok){const h=await o.json().catch(()=>({error:"Failed to start session"}));throw new Error(h.error||`HTTP ${o.status}`)}const s=(await o.json()).session;s?.codeServerUrl?(u.value.lab||W(),u.value.lab.codeServer={url:s.codeServerUrl,containerId:s.containerId||void 0},v(!1),window.open(s.codeServerUrl,"_blank"),T.success("Lab session started")):T.error("Session started but no code server URL")}catch(e){console.error("[LabSession] Failed:",e),T.error(e?.message||"Could not start lab session")}finally{it.value=!1}}function Da(){W(),u.value.lab.apiTests.push({id:Ie(),name:"Health",method:"GET",path:"/api/health",expectedStatus:200,points:1,bodyJson:"",expectJsonStr:"",expectTextLine:"",pathParams:[],query:[],headers:[],args:[],auth:{type:"none"},expectMode:"json-subset"}),v()}function Ea(a){u.value?.lab?.apiTests?.splice(a,1),v()}function Ma(){W(),u.value.lab.uiTests.push({id:Ie(),name:"Home",path:"/",points:1,expectTextLine:""}),v()}function Oa(a){u.value?.lab?.uiTests?.splice(a,1),v()}function Pa(a){return wa(a),!0}async function H(a,e,o="/authentication/graphql"){const c=`${bo}${o.startsWith("/")?o:`/${o}`}`;try{const s=await fetch(c,{method:"POST",credentials:"include",headers:J(),body:JSON.stringify({query:a,variables:e})});if(!s.ok){const M=await s.text();throw console.error(`[GraphQL ${s.status}] ${c}
→ Response body:`,M.slice(0,500)),new Error(`HTTP ${s.status}: ${M}`)}const h=await s.json().catch(()=>{throw new Error("Invalid JSON response from server")});if(h.errors?.length)throw console.error("[GraphQL errors]",h.errors),new Error(h.errors[0]?.message||"GraphQL error");return h.data}catch(s){throw console.error("[fetchGraphQL failed]",{query:a,variables:e,endpoint:o,err:s}),s}}function Ot(){return"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh3Ymtzc2gwMDAwdWNrajNkcWI5ZzMxIiwiaWF0IjoxNzYzMjEzNjE2LCJleHAiOjE3NjM4MTg0MTZ9.HejankLa76UputaoFzUH6dEInCVZeGQtPAbmPkNpreo"}const dt=m(!1);function Ra(){dt.value=!dt.value}const ct=m("course"),vt=m(!1),xe=m([]),pt=m([]),ft=m(""),Pt=A(()=>i.modules.flatMap(a=>a.lessons||[]).reduce((a,e)=>a+(e.duration||0),0)),mt=A(()=>i.files?.[0]?.url||i.coverUrl||""),qa=A(()=>({backgroundImage:mt.value?`url('${mt.value}')`:"linear-gradient(135deg,#111,#334155)"})),yt=A(()=>{const a=[];return i.modules.forEach((e,o)=>(e.lessons||[]).forEach((c,s)=>a.push({id:c.id,label:`${e.title||`Module ${o+1}`}: ${c.title||"Untitled"}`}))),a}),ja=A(()=>`l-${q.value}-${Q.value}`),Fa=A(()=>Number(i.price||0)*(1-Number(i.discount||0)/100)),Ga=[{label:"Video",value:"video"},{label:"Reading",value:"reading"},{label:"Quiz",value:"quiz"},{label:"Assignment",value:"assignment"},{label:"Lab",value:"lab"}],Ja=[{label:"Multiple Choice",value:"mcq"},{label:"True / False",value:"tf"},{label:"Short Answer",value:"short"}],Ba=[{label:"Beginner",value:"Beginner"},{label:"Intermediate",value:"Intermediate"},{label:"Advanced",value:"Advanced"}];function Ka(a){const e=ft.value.trim().toLowerCase();return e?(a.title||"").toLowerCase().includes(e)||(a.type||"").toLowerCase().includes(e):!0}const le={courseTree:`
    query CourseTree($id: String!) {
      course(id: $id) {
        id title category difficulty description price discount coverUrl
        modules { id title courseId
          lessons { id moduleId title type duration content videoUrl rubric metadata }
        }
      }
    }
  `,updateCourse:`
    mutation UpdateCourse(
      $id:String!,
      $title:String, $category:String, $difficulty:String, $description:String,
      $price:Float, $discount:Float, $coverUrl:String, $files: JSON
    ){
      updateCourse(
        id:$id, title:$title, category:$category, difficulty:$difficulty, description:$description,
        price:$price, discount:$discount, coverUrl:$coverUrl, files:$files
      ){ id }
    }
  `,createModule:`
    mutation CreateModule($courseId:String!, $title:String!){
      createModule(courseId:$courseId, title:$title){ id courseId title }
    }
  `,updateModule:`
    mutation UpdateModule($id:String!, $title:String){
      updateModule(id:$id, title:$title){ id }
    }
  `,deleteModule:`
    mutation DeleteModule($id:String!){
      deleteModule(id:$id){ id }
    }
  `,createLesson:`
    mutation CreateLesson(
      $moduleId:String!, $title:String!, $type:String!,
      $duration:Int, $content:String, $videoUrl:String, $rubric:String, $metadata: JSON
    ){
      createLesson(
        moduleId:$moduleId, title:$title, type:$type,
        duration:$duration, content:$content, videoUrl:$videoUrl, rubric:$rubric, metadata:$metadata
      ){ id moduleId title type duration content videoUrl rubric metadata }
    }
  `,updateLesson:`
    mutation UpdateLesson(
      $id:String!,
      $title:String, $type:String, $duration:Int, $content:String, $videoUrl:String, $rubric:String,
      $metadata: JSON
    ){
      updateLesson(
        id:$id, title:$title, type:$type, duration:$duration, content:$content, videoUrl:$videoUrl, rubric:$rubric,
        metadata:$metadata
      ){ id }
    }
  `,deleteLesson:`
    mutation DeleteLesson($id:String!){
      deleteLesson(id:$id){ id }
    }
  `};function Qa(a){return{id:a.id,title:a.title||"",category:a.category||"",difficulty:a.difficulty||"Beginner",description:a.description||"",price:Number(a.price??0),discount:Number(a.discount??0),coverUrl:a.coverUrl||"",modules:(a.modules||[]).map(e=>({id:e.id,courseId:e.courseId,title:e.title||"",lessons:(e.lessons||[]).map(o=>{const c=Oe(o.metadata);return{lab:o.type==="lab"?ue(c.lab,"BACKEND_NODE",!0):c.lab?ue(c.lab):void 0,id:o.id,moduleId:o.moduleId,title:o.title||"",type:o.type||"reading",duration:o.duration??void 0,content:o.content||"",videoUrl:o.videoUrl||"",rubric:o.rubric||"",tags:c.tags||[],prerequisites:c.prerequisites||[],unlockAt:c.unlockAt||void 0,preview:!!c.preview,resources:c.resources||[],attachments:c.attachments||[],quiz:c.quiz||{questions:[]}}})})),files:(()=>{const e=Array.isArray(a.files)?a.files:Array.isArray(Oe(a.metadata)?.files)?Oe(a.metadata).files:[];return e.length?e:a.coverUrl?[{name:"cover",url:a.coverUrl}]:[]})()}}function Ha(a){a.modules||=[],a.files||=[],Object.keys(i).forEach(e=>delete i[e]),Object.assign(i,a),q.value=Math.min(q.value,Math.max(i.modules.length-1,0)),Q.value=Math.min(Q.value,Math.max(i.modules[q.value]?.lessons.length-1||0,0)),ht()}const Rt=m(!1);async function gt(a){Rt.value=!0;try{const e=await H(le.courseTree,{id:a});if(!e?.course)throw new Error("Course not found");Ha(Qa(e.course))}catch(e){console.warn("[CourseEditor] Failed to fetch API:",e.message),T.error(e.message||"Failed to fetch course from API.")}finally{Rt.value=!1}}const bt=m(!0);let pe;function Va(a){const e=a.type==="lab"?ue(a.lab,a.lab?.kind||"BACKEND_NODE",!0):void 0;return{tags:a.tags||[],prerequisites:a.prerequisites||[],unlockAt:a.unlockAt||void 0,preview:!!a.preview,resources:a.resources||[],attachments:a.attachments||[],quiz:a.quiz||{questions:[]},lab:e}}async function kt(){if(i.id)try{await H(le.updateCourse,{id:i.id,title:i.title,category:i.category,difficulty:i.difficulty,description:i.description,price:Number(i.price??0),discount:Number(i.discount??0),coverUrl:mt.value||"",files:i.files||[]})}catch(a){T.error("Update course failed: "+a.message)}}async function Wa(a){if(a?.id)try{await H(le.updateLesson,{id:a.id,title:a.title,type:a.type,duration:a.duration??null,content:a.content??"",videoUrl:a.videoUrl??"",rubric:a.rubric??"",metadata:Va(a)})}catch(e){const o=String(e?.message||"");o.includes("No record was found for an update")?(T.warning("Lesson not found on server. Reloading…"),i.id&&await gt(i.id)):T.error("Update lesson failed: "+o)}}async function qt(){try{i.id&&await kt(),u.value?.id&&(await Wa(u.value),u.value.type==="lab"&&await Zt())}catch{}}function v(a=!0){ht(),a&&bt.value&&(pe&&window.clearTimeout(pe),pe=window.setTimeout(qt,500))}async function jt(){pe&&(window.clearTimeout(pe),pe=void 0),await qt()}async function Ft(){i.id&&await gt(i.id)}async function Za(a){if(!i.id){T.warning("Open a valid course route with an ID.");return}try{const o=(await H(le.createModule,{courseId:i.id,title:a})).createModule;i.modules.push({id:o.id,courseId:o.courseId,title:o.title,lessons:[]}),xe.value=[`m-${i.modules.length-1}`],T.success("Module created")}catch(e){T.error("Create module failed: "+e.message)}}async function Xa(a,e){const o=i.modules[a];if(o?.id)try{await H(le.updateModule,{id:o.id,title:e}),T.success("Module updated")}catch(c){T.error("Update module failed: "+c.message)}}async function Ya(a){const e=i.modules[a];if(!e?.id){i.modules.splice(a,1);return}try{await H(le.deleteModule,{id:e.id}),i.modules.splice(a,1),q.value=Math.max(0,Math.min(q.value,i.modules.length-1)),Q.value=0,T.success("Module deleted")}catch(o){T.error("Delete module failed: "+o.message)}}async function el(a){const e=i.modules[a];if(!e?.id){T.warning("Create/save module first.");return}try{const o={moduleId:e.id,title:"New lesson",type:"reading",duration:5,content:"",metadata:{tags:[],prerequisites:[],unlockAt:null,preview:!1,resources:[],attachments:[],quiz:{questions:[]}}},s=(await H(le.createLesson,o)).createLesson,h=Oe(s.metadata),M=s.type==="lab"?ue(h.lab,"BACKEND_NODE",!0):h.lab?ue(h.lab):void 0;e.lessons.push({id:s.id,moduleId:s.moduleId,title:s.title,type:s.type,duration:s.duration,content:s.content,videoUrl:s.videoUrl||"",rubric:s.rubric||"",lab:M,tags:h.tags||[],prerequisites:h.prerequisites||[],unlockAt:h.unlockAt||void 0,preview:!!h.preview,resources:h.resources||[],attachments:h.attachments||[],quiz:h.quiz||{questions:[]}}),Mt(a,e.lessons.length-1),T.success("Lesson created")}catch(o){T.error("Create lesson failed: "+o.message)}}async function tl(a,e){const o=i.modules[a]?.lessons?.[e];if(o){if(!o.id){i.modules[a].lessons.splice(e,1);return}try{await H(le.deleteLesson,{id:o.id}),i.modules[a].lessons.splice(e,1),Q.value=Math.max(0,Math.min(Q.value,i.modules[a].lessons.length-1)),T.success("Lesson deleted")}catch(c){T.error("Delete lesson failed: "+c.message)}}}function al(){Za(`New module ${i.modules.length+1}`)}function ll(a){const e=prompt("Module title",i.modules[a].title||"");if(e!==null){const o=e.trim();i.modules[a].title=o,Xa(a,o),v(!1)}}function nl(a){const e=new Set((i.modules[a].lessons||[]).map(o=>o.id));for(const o of i.modules)for(const c of o.lessons||[])c.prerequisites&&(c.prerequisites=c.prerequisites.filter(s=>!e.has(s)));Ya(a)}function Gt(a,e){const o=a+e;if(o<0||o>=i.modules.length)return;const c=i.modules[a];i.modules.splice(a,1),i.modules.splice(o,0,c),q.value===a&&(q.value=o),v()}function Jt(a){el(a)}function ol(){Re.value&&Jt(q.value)}function sl(a,e){const o=i.modules[a].lessons[e];for(const c of i.modules)for(const s of c.lessons||[])s.prerequisites&&(s.prerequisites=s.prerequisites.filter(h=>h!==o.id));tl(a,e)}function Bt(a,e,o){const c=e+o,s=i.modules[a].lessons;if(c<0||c>=s.length)return;const h=s[e];s.splice(e,1),s.splice(c,0,h),q.value===a&&Q.value===e&&(Q.value=c),v()}function ul(){xe.value=i.modules.map((a,e)=>`m-${e}`)}function rl(){xe.value=[]}const qe=m(""),je=m("");function ht(){u.value&&(qe.value=(u.value.tags||[]).join(", "),je.value=u.value.unlockAt?String(u.value.unlockAt):"")}function il(){u.value&&(u.value.tags=ga(qe.value),v())}function dl(){if(!u.value)return;const a=je.value.trim();u.value.unlockAt=a||void 0,v()}const Fe=m(""),Ge=m("");async function Kt(){if(!u.value)return;let a=Ge.value.trim(),e=Fe.value||"";if(!a){const o=await Pe("lesson");if(!o)return;a=o.url,e||(e=o.name||"")}u.value.resources=u.value.resources||[],u.value.resources.push({title:e||void 0,url:a}),Fe.value="",Ge.value="",v()}function Qt(a){u.value?.resources?.splice(a,1),v()}const Je=m(""),Be=m("");async function cl(){if(!u.value)return;let a=Be.value.trim(),e=Je.value||"";if(!a){const o=await Pe("lesson");if(!o)return;a=o.url,e||(e=o.name||"")}u.value.attachments=u.value.attachments||[],u.value.attachments.push({name:e||void 0,url:a}),Je.value="",Be.value="",v()}function vl(a){u.value?.attachments?.splice(a,1),v()}const Ke=m(""),fe=m(""),Qe=m("");async function Ht(){let a=Ke.value.trim();if(!a){const e=await Pe("course");if(!e)return;a=e.url,Ke.value=a,fe.value||(fe.value=e.name||"")}i.files.length?i.files[0]={...i.files[0]||{},name:i.files[0]?.name||"cover",url:a}:i.files.push({name:"cover",url:a}),i.id&&kt()}function pl(){i.files.length&&i.files.splice(0,1),i.id&&kt()}async function fl(){let a=Qe.value.trim(),e=fe.value.trim();if(!a){const o=await Pe("course");if(!o)return;a=o.url,e||(e=o.name||"")}i.files.push({name:e||"Asset",url:a}),fe.value="",Qe.value="",v()}function ml(a){i.files.splice(a,1),v()}function yl(){u.value&&(u.value.quiz=u.value.quiz||{questions:[]})}function Ct(a){yl(),u.value.quiz.questions.push({id:Ie(),text:"",type:a,options:a==="mcq"?[{text:"Option 1",correct:!1}]:void 0}),pt.value=[u.value.quiz.questions.at(-1).id],v()}function gl(a){u.value?.quiz?.questions.splice(a,1),v()}function Vt(a,e){const o=u.value?.quiz?.questions;if(!o)return;const c=a+e;if(c<0||c>=o.length)return;const s=o[a];o.splice(a,1),o.splice(c,0,s),v()}function bl(a){a.options=a.options||[],a.options.push({text:"",correct:!1}),v()}function kl(a,e){a.options?.splice(e,1),v()}function hl(a){a.type==="mcq"&&!a.options&&(a.options=[{text:"Option 1",correct:!1}]),a.type!=="mcq"&&delete a.options,v()}Ce(async()=>{const a=G.path;function e(c){const s=c.match(/course\/([^/]+)/),h=c.match(/module\/([^/]+)/);return s?.[1]||h?.[1]||null}const o=(G.params.id||G.params.courseId||G.query.courseId||e(a)||"").toString();o&&(await gt(o),await Cl(),await xt()),ht()});async function Cl(){if(!(!i.id||!i.modules.length))try{const a=await fetch(`${ae}/challenges`,{method:"GET",headers:J(),credentials:"include"});if(a.ok){const o=(await a.json()).items||[];for(const c of o)if(c.lessonId&&c.courseId===i.id){const s=`${i.id}:${c.lessonId}`;V.value[s]=c}}}catch(a){console.warn("[LabChallenge] Failed to load challenges:",a)}}const _l=A(()=>yt.value.filter(a=>u.value?a.id!==u.value.id:!0).map(a=>({label:a.label,value:a.id}))),V=m({});async function Wt(){if(!u.value?.id||!i.id)return null;const a=u.value.id,e=`${i.id}:${a}`;if(V.value[e])return V.value[e];try{const o=await fetch(`${ae}/challenges/by-lesson/${a}`,{method:"GET",headers:J(),credentials:"include"}).catch(()=>null);if(o?.ok){const w=await o.json();if(w.challenge)return V.value[e]=w.challenge,w.challenge}const c=await fetch(`${ae}/challenges`,{method:"GET",headers:J(),credentials:"include"});if(c.ok){const j=(await c.json()).items?.find(D=>D.lessonId===a&&D.courseId===i.id);if(j)return V.value[e]=j,j}const s=await fetch(`${ae}/challenges`,{method:"POST",headers:{"Content-Type":"application/json",...J()},credentials:"include",body:JSON.stringify({title:u.value.title||"Lab Challenge",slug:`lab-${a}-${Date.now()}`,description:u.value.content||"",difficulty:i.difficulty||"Beginner",courseId:i.id,moduleId:Re.value?.id||null,lessonId:a,visibility:"private"})});if(!s.ok){const w=await s.json().catch(()=>({error:"Failed to create challenge"}));throw new Error(w.error||`HTTP ${s.status}`)}const M=(await s.json()).item;return V.value[e]=M,M}catch(o){return console.error("[LabChallenge] Failed to get/create:",o),null}}async function wl(){if(!u.value?.id||!i.id)return null;const a=u.value.id,e=`${i.id}:${a}`;if(V.value[e])return V.value[e];try{const o=await fetch(`${ae}/challenges/by-lesson/${a}`,{method:"GET",headers:J(),credentials:"include"}).catch(()=>null);if(o?.ok){const s=await o.json();if(s.challenge)return V.value[e]=s.challenge,s.challenge}const c=await fetch(`${ae}/challenges`,{method:"GET",headers:J(),credentials:"include"});if(c.ok){const h=(await c.json()).items?.find(M=>M.lessonId===a&&M.courseId===i.id);if(h)return V.value[e]=h,h}}catch(o){console.warn("[LabChallenge] Failed to fetch:",o)}return null}async function Zt(){if(!u.value?.id||u.value.type!=="lab")return;await Wt()||console.warn("[LabChallenge] Failed to ensure challenge")}const Xt=A(()=>G.params.moduleId||G.params.id||"unknown"),O=zt({notes:"",tasks:[],resources:[]});A(()=>`byway:module:${Xt.value}:study`);async function Ul(){try{const a=await H("query GetStudy($moduleId: String!){ myUiPrefs }",{moduleId:Xt.value});if(a?.myUiPrefs){const e=JSON.parse(a.myUiPrefs);Object.assign(O,e)}}catch(a){console.warn("Load study failed:",a)}}async function _t(){try{await H("mutation SaveStudy($json: String!){ setMyUiPrefs(json:$json){ ok } }",{json:JSON.stringify(O)})}catch(a){console.warn("Save study failed:",a)}}Ce(Ul),ve(O,_t,{deep:!0});let wt=null;Ce(()=>{wt=fa(_t,1e4)}),on(()=>wt&&clearInterval(wt));const He=m("");function Yt(){const a=(He.value||"").trim();a&&(O.tasks.push({id:String(Date.now()),text:a,done:!1}),He.value="")}function $l(a){const e=O.tasks.find(o=>o.id===a);e&&(e.done=!e.done)}function Il(){O.tasks=O.tasks.filter(a=>!a.done)}const xl=A(()=>{const a=O.tasks.length||1,e=O.tasks.filter(o=>o.done).length;return Math.round(e/a*100)});function Sl({item:a}){return nt("div",{class:"flex items-center gap-3"},[nt("a-checkbox",{checked:a.done,onChange:()=>$l(a.id)}),nt("span",{style:a.done?"text-decoration:line-through;opacity:.7":""},a.text)])}const Tl=["25","50","90","Custom"],Z=m("25"),Se=m(30),me=m(!1),X=m(0);ve(Z,a=>{a!=="Custom"&&(X.value=Number(a)*60)}),Ce(()=>X.value=Number(Z.value)*60);let Ut=null;function Nl(){Z.value==="Custom"&&(X.value=Number(Se.value||30)*60),me.value=!0,Ut&&clearInterval(Ut),Ut=fa(()=>{me.value&&X.value>0&&X.value--},1e3)}function Al(){me.value=!me.value}function Ll(){me.value=!1,X.value=Number(Z.value==="Custom"?Se.value:Z.value)*60}const zl=A(()=>String(Math.floor(X.value/60)).padStart(2,"0")),Dl=A(()=>String(X.value%60).padStart(2,"0")),El=A(()=>{const a=(Z.value==="Custom"?Number(Se.value||30):Number(Z.value))*60;return a?Math.round(100-X.value/a*100):0}),ea=m(""),$t=m(""),re=m("cohorts"),It=m(!1),Te=A(()=>G?.params?.courseId||G?.query?.courseId||typeof currentCourse<"u"&&currentCourse?.id||typeof props<"u"&&props?.courseId||null),ta=m(null),R=m({}),Ml=A(()=>{const a=R.value?.classroomId,e=R.value?.institution?.id;if(!a)return"#";const o=e?`?institutionId=${encodeURIComponent(e)}`:"";return`/institution/classrooms/${encodeURIComponent(a)}${o}`});function aa(a){if(!a)return"—";const e=typeof a=="string"?new Date(a):a;return!e||Number.isNaN(e.getTime())?"—":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"})}async function xt(){try{const a=i?.id||Te.value;if(!a)return;const e=await $fetch(`/api/teach-internal/course/${encodeURIComponent(String(a))}/institution-context`);R.value=e||{}}catch{}}ve(()=>i?.id,()=>xt()),ve(Te,()=>xt());const ie=m([]),Ve=m(""),L=m(null),We=m(!1),Ze=A(()=>ie.value.map(a=>({label:a.name,value:a.id}))),Ol=A(()=>Ve.value?ie.value.filter(a=>(a.name||"").toLowerCase().includes(Ve.value.toLowerCase())):ie.value);async function St(a,e){try{const o=await $fetch("/api/teach-internal/graphql",{method:"POST",body:{query:a,variables:e}});if(o?.errors?.length)throw new Error(o.errors[0]?.message||"GraphQL error");return o?.data||{}}catch(o){return console.warn("[uni:gqlFetch]",o),{}}}async function la(){if(!Te.value)return;We.value=!0;const a=await St(`query($courseId: ID!){
       classroomsByCourse(courseId: $courseId){ id name startDate endDate size studentsCount }
     }`,{courseId:String(Te.value)});ie.value=a?.classroomsByCourse||[],!L.value&&ie.value.length&&(L.value=ie.value[0].id),We.value=!1}function Pl(){re.value==="assignments"&&et(),re.value==="enrollments"&&at()}const ye=m([]),Xe=m(!1),Ye=m(null),Rl=[{title:"Title",dataIndex:"title",key:"title"},{title:"Due",dataIndex:"dueDate",key:"dueDate",customRender:({text:a})=>a?new Date(a).toLocaleString():"—"},{title:"Submissions",dataIndex:"submissionsCount",key:"submissionsCount"},{title:"Avg Grade",dataIndex:"averageGrade",key:"averageGrade",customRender:({text:a})=>a==null?"—":Number(a).toFixed(1)}];async function et(){if(!L.value)return;Xe.value=!0;const a={classroomId:String(L.value)};let o=(await St(`query($classroomId: ID!){
       assignmentsByClassroom(classroomId: $classroomId){ id title dueDate submissionsCount averageGrade }
     }`,a))?.assignmentsByClassroom||[];if(Ye.value){const c=new Date(Ye.value).getTime();o=o.filter(s=>s?.dueDate?new Date(s.dueDate).getTime()>=c:!0)}ye.value=o,Xe.value=!1}const ge=m([]),tt=m(!1),ql=[{title:"Student",dataIndex:"studentName",key:"studentName"},{title:"Email",dataIndex:"studentEmail",key:"studentEmail"},{title:"Status",dataIndex:"status",key:"status"}];async function at(){if(L.value){tt.value=!0;try{const a=await $fetch("/plugins/students-internal/api/students/enrollments",{method:"GET",query:{courseId:String(Te.value),classroomId:String(L.value)}});ge.value=Array.isArray(a)?a:a?.items||[]}catch(a){console.warn("[uni:enrollments]",a),ge.value=[]}finally{tt.value=!1}}}const Tt=m(""),Nt=m(!1);async function jl(){if(L.value){Nt.value=!0;try{const e=(await St(`query($classroomId: ID!){
         gradebookCsv(classroomId: $classroomId)
       }`,{classroomId:String(L.value)}))?.gradebookCsv;if(e){const o=new Blob([e],{type:"text/csv;charset=utf-8"}),c=URL.createObjectURL(o),s=document.createElement("a");s.href=c,s.download=`gradebook_${L.value}.csv`,s.click(),URL.revokeObjectURL(c),Tt.value=new Date().toLocaleString()}}catch(a){console.warn("[uni:gradebook]",a)}finally{Nt.value=!1}}}const de=zt({completionRate:0,avgGrade:0,activeThisWeek:0});return ve([ye,ge],()=>{const a=ye.value.map(c=>c?.submissionsCount||0).reduce((c,s)=>c+s,0),e=ge.value.length||1;de.completionRate=Math.min(100,Math.round(a/e*100));const o=ye.value.map(c=>c?.averageGrade).filter(c=>c!=null);de.avgGrade=o.length?o.reduce((c,s)=>c+s,0)/o.length:0},{immediate:!0}),Ce(async()=>{It.value=!0,await la(),L.value&&await Promise.all([et(),at()]),It.value=!1}),(a,e)=>{const o=y("a-tag"),c=y("a-switch"),s=y("a-button"),h=y("a-tooltip"),M=y("a-menu-item"),w=y("a-menu"),j=y("a-dropdown"),D=y("a-space"),Fl=y("a-page-header"),z=y("a-card"),na=y("a-input-search"),At=y("a-popconfirm"),lt=y("a-list-item-meta"),be=y("a-list-item"),ce=y("a-list"),ne=y("a-collapse-panel"),Ne=y("a-collapse"),Gl=y("a-layout-sider"),_=y("a-input"),g=y("a-form-item"),P=y("a-select"),oe=y("a-textarea"),Y=y("a-form"),ee=y("a-divider"),N=y("a-col"),se=y("a-input-number"),ke=y("a-alert"),B=y("a-row"),te=y("a-tab-pane"),Ae=y("a-descriptions-item"),oa=y("a-descriptions"),Lt=y("a-checkbox"),he=y("a-empty"),Le=y("a-typography-paragraph"),Jl=y("a-popover"),Bl=y("a-date-picker"),sa=y("a-table"),ua=y("a-tabs"),Kl=y("a-layout-content"),ra=y("a-layout"),Ql=y("a-config-provider"),Hl=y("a-typography-text"),ia=y("a-progress"),Vl=y("a-segmented"),Wl=y("a-typography-title"),Zl=y("a-link"),Xl=bn;return p(),U(Xl,null,{default:l(()=>[t(Ql,null,{default:l(()=>[t(ra,{class:da(["admin-wrap",dt.value?"is-dark":""])},{default:l(()=>[t(Fl,{class:"admin-header",title:"Course Admin","sub-title":`Edit · ${yt.value.length} lesson${yt.value.length!==1?"s":""}`},{tags:l(()=>[t(o,{color:"blue"},{default:l(()=>[r(C(i.category||"—"),1)]),_:1}),t(o,{color:"gold"},{default:l(()=>[r(C(i.difficulty||"—"),1)]),_:1}),Pt.value?(p(),U(o,{key:0,color:"blue"},{default:l(()=>[t(x(pa)),r(" "+C(Pt.value)+" min",1)]),_:1})):I("",!0)]),extra:l(()=>[t(D,null,{default:l(()=>[t(c,{checked:bt.value,"onUpdate:checked":e[0]||(e[0]=n=>bt.value=n),"checked-children":"Auto-save","un-checked-children":"Manual save"},null,8,["checked"]),t(h,{title:"Toggle dark"},{default:l(()=>[t(s,{shape:"circle",onClick:Ra},{default:l(()=>[t(x(un))]),_:1})]),_:1}),t(j,null,{overlay:l(()=>[t(w,null,{default:l(()=>[t(M,{onClick:jt},{default:l(()=>[t(x(ca)),e[61]||(e[61]=r(" Sync now",-1))]),_:1}),t(M,{onClick:Ft},{default:l(()=>[t(x(va)),e[62]||(e[62]=r(" Reload",-1))]),_:1})]),_:1})]),default:l(()=>[t(s,null,{default:l(()=>[e[60]||(e[60]=r(" File ",-1)),t(x(rn))]),_:1})]),_:1})]),_:1})]),_:1},8,["sub-title"]),R.value.classroomId?(p(),b("div",kn,[t(z,{size:"small",bordered:!1},{default:l(()=>[t(D,{wrap:""},{default:l(()=>[t(o,{color:"purple"},{default:l(()=>[...e[63]||(e[63]=[r("Institution Classroom",-1)])]),_:1}),R.value.classroomId?(p(),b("a",{key:0,href:Ml.value,style:{"font-weight":"600"}},C(R.value.institution?.name||"Institution")+" · "+C(R.value.classroomId),9,hn)):I("",!0),R.value.teacherIds?.length?(p(),b("span",Cn,"• Teachers: "+C(R.value.teacherIds.join(", ")),1)):I("",!0),R.value.schedule?.startsAt?(p(),b("span",_n,"• Starts: "+C(aa(R.value.schedule.startsAt)),1)):I("",!0),R.value.schedule?.endsAt?(p(),b("span",wn,"• Ends: "+C(aa(R.value.schedule.endsAt)),1)):I("",!0)]),_:1})]),_:1})])):I("",!0),t(ra,null,{default:l(()=>[t(Gl,{width:"310",class:"admin-sider",collapsible:"",collapsed:vt.value,"onUpdate:collapsed":e[3]||(e[3]=n=>vt.value=n)},{default:l(()=>[f("div",Un,[f("div",{class:"cover",style:dn(qa.value)},[e[64]||(e[64]=f("div",{class:"cover-gradient"},null,-1)),vt.value?I("",!0):(p(),b("div",$n,[f("div",In,C(i.title||"Untitled course"),1),f("div",xn,[i.category?(p(),U(o,{key:0,color:"blue"},{default:l(()=>[r(C(i.category),1)]),_:1})):I("",!0),i.difficulty?(p(),U(o,{key:1,color:"gold"},{default:l(()=>[r(C(i.difficulty),1)]),_:1})):I("",!0)])]))],4),t(na,{value:ft.value,"onUpdate:value":e[1]||(e[1]=n=>ft.value=n),placeholder:"Filter lessons","allow-clear":"",class:"mt-2"},null,8,["value"]),t(D,{class:"mt-2",wrap:""},{default:l(()=>[t(s,{size:"small",type:"primary",onClick:al},{default:l(()=>[t(x(F)),e[65]||(e[65]=r(" Module",-1))]),_:1}),t(s,{size:"small",onClick:ol,disabled:!Re.value},{default:l(()=>[t(x(F)),e[66]||(e[66]=r(" Lesson",-1))]),_:1},8,["disabled"]),t(s,{size:"small",onClick:ul},{default:l(()=>[...e[67]||(e[67]=[r("Expand",-1)])]),_:1}),t(s,{size:"small",onClick:rl},{default:l(()=>[...e[68]||(e[68]=[r("Collapse",-1)])]),_:1})]),_:1}),t(Ne,{activeKey:xe.value,"onUpdate:activeKey":e[2]||(e[2]=n=>xe.value=n),class:"mt-2",accordion:""},{default:l(()=>[(p(!0),b(E,null,K(i.modules,(n,k)=>(p(),U(ne,{key:`m-${k}`,header:n.title||`Module ${k+1}`},{default:l(()=>[f("div",Sn,[t(D,null,{default:l(()=>[t(s,{size:"small",onClick:d=>Gt(k,-1),disabled:k===0},{default:l(()=>[...e[69]||(e[69]=[r("↑",-1)])]),_:1},8,["onClick","disabled"]),t(s,{size:"small",onClick:d=>Gt(k,1),disabled:k===i.modules.length-1},{default:l(()=>[...e[70]||(e[70]=[r("↓",-1)])]),_:1},8,["onClick","disabled"]),t(s,{size:"small",onClick:d=>ll(k)},{default:l(()=>[t(x(cn))]),_:1},8,["onClick"]),t(At,{title:"Delete module?","ok-text":"Delete",onConfirm:d=>nl(k)},{default:l(()=>[t(s,{size:"small",danger:""},{default:l(()=>[t(x(Dt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),t(ce,{size:"small","data-source":n.lessons},{renderItem:l(({item:d,index:S})=>[Ka(d)?(p(),U(be,{key:0,class:da(["tree-lesson",ja.value===`l-${k}-${S}`&&"active"]),onClick:$=>Mt(k,S)},{actions:l(()=>[t(D,null,{default:l(()=>[t(s,{size:"small",onClick:ze($=>Bt(k,S,-1),["stop"]),disabled:S===0},{default:l(()=>[...e[71]||(e[71]=[r("↑",-1)])]),_:1},8,["onClick","disabled"]),t(s,{size:"small",onClick:ze($=>Bt(k,S,1),["stop"]),disabled:S===n.lessons.length-1},{default:l(()=>[...e[72]||(e[72]=[r("↓",-1)])]),_:1},8,["onClick","disabled"]),t(At,{title:"Delete lesson?","ok-text":"Delete",onConfirm:$=>sl(k,S)},{default:l(()=>[t(s,{size:"small",danger:""},{default:l(()=>[t(x(Dt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),default:l(()=>[t(lt,{title:d.title||"Untitled",description:(d.type||"—")+(d.duration?` · ${d.duration} min`:"")+(d.preview?" · preview":"")},null,8,["title","description"])]),_:2},1032,["class","onClick"])):I("",!0)]),_:2},1032,["data-source"]),t(s,{size:"small",class:"mt-1",block:"",onClick:d=>Jt(k)},{default:l(()=>[t(x(F)),e[73]||(e[73]=r(" Add lesson",-1))]),_:1},8,["onClick"])]),_:2},1032,["header"]))),128))]),_:1},8,["activeKey"])])]),_:1},8,["collapsed"]),t(Kl,{class:"admin-content"},{default:l(()=>[t(ua,{activeKey:ct.value,"onUpdate:activeKey":e[53]||(e[53]=n=>ct.value=n)},{default:l(()=>[t(te,{key:"course",tab:"Course"},{default:l(()=>[t(B,{gutter:16},{default:l(()=>[t(N,{md:14,xs:24},{default:l(()=>[t(z,{title:"Course details"},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(g,{label:"Title"},{default:l(()=>[t(_,{value:i.title,"onUpdate:value":e[4]||(e[4]=n=>i.title=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Category"},{default:l(()=>[t(_,{value:i.category,"onUpdate:value":e[5]||(e[5]=n=>i.category=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Difficulty"},{default:l(()=>[t(P,{value:i.difficulty,"onUpdate:value":e[6]||(e[6]=n=>i.difficulty=n),onChange:v,options:Ba},null,8,["value"])]),_:1}),t(g,{label:"Description"},{default:l(()=>[t(oe,{rows:5,value:i.description,"onUpdate:value":e[7]||(e[7]=n=>i.description=n),onChange:v},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{class:"mt-2",title:"Assets (cover & files)"},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(g,{label:"Cover URL"},{default:l(()=>[t(_,{value:Ke.value,"onUpdate:value":e[8]||(e[8]=n=>Ke.value=n),placeholder:"https://…",onPressEnter:Ht},null,8,["value"]),f("div",Tn,[t(s,{onClick:Ht},{default:l(()=>[...e[74]||(e[74]=[r("Set cover",-1)])]),_:1}),t(s,{onClick:pl,type:"link"},{default:l(()=>[...e[75]||(e[75]=[r("Clear",-1)])]),_:1})])]),_:1}),t(ee),t(g,{label:"Course files"},{default:l(()=>[t(D,{class:"mb-1",wrap:""},{default:l(()=>[t(_,{value:fe.value,"onUpdate:value":e[9]||(e[9]=n=>fe.value=n),placeholder:"Name"},null,8,["value"]),t(_,{value:Qe.value,"onUpdate:value":e[10]||(e[10]=n=>Qe.value=n),placeholder:"URL"},null,8,["value"]),t(s,{onClick:fl},{default:l(()=>[t(x(F)),e[76]||(e[76]=r(" Add",-1))]),_:1})]),_:1}),t(ce,{bordered:"","data-source":i.files},{renderItem:l(({item:n,index:k})=>[t(be,null,{actions:l(()=>[t(s,{size:"small",onClick:d=>ml(k),danger:""},{default:l(()=>[...e[77]||(e[77]=[r("Remove",-1)])]),_:1},8,["onClick"])]),default:l(()=>[t(lt,{title:n.name||"Asset",description:n.url||n.thumbUrl},null,8,["title","description"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{md:10,xs:24},{default:l(()=>[t(z,{title:"Pricing & discount"},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(g,{label:"Price (EUR)"},{default:l(()=>[t(se,{value:i.price,"onUpdate:value":e[11]||(e[11]=n=>i.price=n),min:0,style:{width:"100%"},onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Course discount (%)"},{default:l(()=>[t(se,{value:i.discount,"onUpdate:value":e[12]||(e[12]=n=>i.discount=n),min:0,max:100,style:{width:"100%"},onChange:v},null,8,["value"])]),_:1}),t(ke,{type:"info","show-icon":"",message:`Payable: ${ya(Fa.value)}`},null,8,["message"])]),_:1})]),_:1}),t(z,{title:"API",class:"mt-2"},{default:l(()=>[t(D,{direction:"vertical",style:{width:"100%"}},{default:l(()=>[t(s,{block:"",onClick:jt},{default:l(()=>[t(x(ca)),e[78]||(e[78]=r(" Sync now",-1))]),_:1}),t(s,{block:"",onClick:Ft},{default:l(()=>[t(x(va)),e[79]||(e[79]=r(" Reload from API",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(te,{key:"lesson",tab:"Lesson editor","force-render":""},{default:l(()=>[u.value?(p(),U(z,{key:1,title:u.value.title||"Lesson"},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(B,{gutter:16},{default:l(()=>[t(N,{md:16,xs:24},{default:l(()=>[t(g,{label:"Title"},{default:l(()=>[t(_,{value:u.value.title,"onUpdate:value":e[13]||(e[13]=n=>u.value.title=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Type"},{default:l(()=>[t(P,{value:u.value.type,"onUpdate:value":e[14]||(e[14]=n=>u.value.type=n),options:Ga,onChange:v},null,8,["value"])]),_:1}),u.value.type==="video"?(p(),b(E,{key:0},[t(g,{label:"Video URL (YouTube accepted)"},{default:l(()=>[t(_,{value:u.value.videoUrl,"onUpdate:value":e[15]||(e[15]=n=>u.value.videoUrl=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Notes / summary (optional)"},{default:l(()=>[t(oe,{rows:4,value:u.value.content,"onUpdate:value":e[16]||(e[16]=n=>u.value.content=n),onChange:v},null,8,["value"])]),_:1})],64)):u.value.type==="reading"?(p(),U(g,{key:1,label:"Reading content (HTML or text)"},{default:l(()=>[t(oe,{rows:8,value:u.value.content,"onUpdate:value":e[17]||(e[17]=n=>u.value.content=n),onChange:v},null,8,["value"])]),_:1})):u.value.type==="assignment"?(p(),b(E,{key:2},[t(g,{label:"Brief"},{default:l(()=>[t(oe,{rows:6,value:u.value.content,"onUpdate:value":e[18]||(e[18]=n=>u.value.content=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Rubric"},{default:l(()=>[t(oe,{rows:4,value:u.value.rubric,"onUpdate:value":e[19]||(e[19]=n=>u.value.rubric=n),onChange:v},null,8,["value"])]),_:1})],64)):u.value.type==="lab"?(p(),b(E,{key:3},[t(ke,{type:"info","show-icon":"",class:"mb-2",message:"Lab lesson",description:"Configure a Docker-based lab and open a web VS Code (code-server). This is a mock UI that saves to lesson.metadata.lab."}),t(Y,{layout:"vertical"},{default:l(()=>[t(B,{gutter:16},{default:l(()=>[t(N,{md:14,xs:24},{default:l(()=>[t(z,{title:"Runtime & environment"},{default:l(()=>[t(B,{gutter:8},{default:l(()=>[t(N,{span:12},{default:l(()=>[t(g,{label:"Lab kind"},{default:l(()=>[t(P,{options:Ia,value:u.value.lab.kind,"onUpdate:value":e[20]||(e[20]=n=>u.value.lab.kind=n),onChange:e[21]||(e[21]=n=>v())},null,8,["value"])]),_:1})]),_:1}),t(N,{span:12},{default:l(()=>[t(g,{label:"Node environment"},{default:l(()=>[t(P,{options:xa,value:u.value.lab.dockerImage,"onUpdate:value":e[22]||(e[22]=n=>u.value.lab.dockerImage=n),onChange:e[23]||(e[23]=n=>v())},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(B,{gutter:8},{default:l(()=>[t(N,{span:12},{default:l(()=>[t(g,{label:"Dev port (inside container)"},{default:l(()=>[t(se,{value:u.value.lab.devPort,"onUpdate:value":e[24]||(e[24]=n=>u.value.lab.devPort=n),min:1,style:{width:"100%"},onChange:e[25]||(e[25]=n=>v())},null,8,["value"])]),_:1})]),_:1}),t(N,{span:12},{default:l(()=>[t(g,{label:"Traefik host (optional)"},{default:l(()=>[t(_,{value:u.value.lab.traefikHost,"onUpdate:value":e[26]||(e[26]=n=>u.value.lab.traefikHost=n),placeholder:"lab-{{id}}.localhost",onChange:e[27]||(e[27]=n=>v())},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(g,{label:"Build command"},{default:l(()=>[t(_,{value:u.value.lab.buildCmd,"onUpdate:value":e[28]||(e[28]=n=>u.value.lab.buildCmd=n),placeholder:"pnpm i && pnpm build",onChange:e[29]||(e[29]=n=>v())},null,8,["value"])]),_:1}),t(g,{label:"Start command"},{default:l(()=>[t(_,{value:u.value.lab.startCmd,"onUpdate:value":e[30]||(e[30]=n=>u.value.lab.startCmd=n),placeholder:"pnpm dev",onChange:e[31]||(e[31]=n=>v())},null,8,["value"])]),_:1}),t(D,null,{default:l(()=>[t(s,{type:"primary",onClick:za,loading:it.value},{icon:l(()=>[t(x(vn))]),default:l(()=>[e[80]||(e[80]=r(" Open VS Code ",-1))]),_:1},8,["loading"]),t(s,{danger:"",onClick:Aa,disabled:!u.value.lab?.codeServer?.containerId,loading:rt.value},{default:l(()=>[...e[81]||(e[81]=[r(" Stop ",-1)])]),_:1},8,["disabled","loading"]),u.value.lab?.codeServer?.url?(p(),U(s,{key:0,onClick:La},{default:l(()=>[...e[82]||(e[82]=[r(" Open instance ",-1)])]),_:1})):I("",!0)]),_:1}),t(ee),t(oa,{bordered:"",size:"small",column:"1"},{default:l(()=>[t(Ae,{label:"Docker image"},{default:l(()=>[r(C(u.value.lab?.dockerImage||"—"),1)]),_:1}),t(Ae,{label:"VS Code URL"},{default:l(()=>[u.value.lab?.codeServer?.url?(p(),b("a",{key:0,href:u.value.lab.codeServer.url,target:"_blank"},C(u.value.lab.codeServer.url),9,Nn)):(p(),b(E,{key:1},[r("—")],64))]),_:1}),t(Ae,{label:"Container ID"},{default:l(()=>[r(C(u.value.lab?.codeServer?.containerId||"—"),1)]),_:1})]),_:1})]),_:1}),u.value.lab?.kind==="BACKEND_NODE"?(p(),U(z,{key:0,class:"mt-2",title:"API tests"},{default:l(()=>[t(D,{class:"mb-1",wrap:""},{default:l(()=>[t(s,{size:"small",type:"primary",onClick:Da},{default:l(()=>[t(x(F)),e[83]||(e[83]=r(" Add API test",-1))]),_:1})]),_:1}),u.value.lab?.apiTests?.length?(p(),U(Ne,{key:0,accordion:""},{default:l(()=>[(p(!0),b(E,null,K(u.value.lab.apiTests||[],(n,k)=>(p(),U(ne,{key:n.id,header:n.name||`API Test ${k+1}`},{extra:l(()=>[t(s,{size:"small",danger:"",onClick:ze(d=>Ea(k),["stop"])},{default:l(()=>[...e[84]||(e[84]=[r("Remove",-1)])]),_:1},8,["onClick"])]),default:l(()=>[Pa(n)?(p(),U(Y,{key:0,layout:"vertical"},{default:l(()=>[t(B,{gutter:12},{default:l(()=>[t(N,{md:12,xs:24},{default:l(()=>[t(g,{label:"Name"},{default:l(()=>[t(_,{value:n.name,"onUpdate:value":d=>n.name=d,placeholder:"Health check",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:6,xs:12},{default:l(()=>[t(g,{label:"Points"},{default:l(()=>[t(se,{value:n.points,"onUpdate:value":d=>n.points=d,style:{width:"100%"},min:0,onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:6,xs:12},{default:l(()=>[t(g,{label:"Expected status"},{default:l(()=>[t(se,{value:n.expectedStatus,"onUpdate:value":d=>n.expectedStatus=d,style:{width:"100%"},min:100,max:599,onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(B,{gutter:12},{default:l(()=>[t(N,{md:6,xs:12},{default:l(()=>[t(g,{label:"Method"},{default:l(()=>[t(P,{options:x(Sa),value:n.method,"onUpdate:value":d=>n.method=d,onChange:v},null,8,["options","value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:18,xs:24},{default:l(()=>[t(g,{label:"Path"},{default:l(()=>[t(_,{value:n.path,"onUpdate:value":d=>n.path=d,placeholder:"/api/health",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(g,{label:"Request body (JSON)"},{default:l(()=>[t(oe,{value:n.bodyJson,"onUpdate:value":d=>n.bodyJson=d,rows:4,placeholder:'{"message":"hello"}',onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024),t(ee,{orientation:"left"},{default:l(()=>[...e[85]||(e[85]=[r(" Path params ",-1)])]),_:1}),f("div",An,[(p(!0),b(E,null,K(n.pathParams,(d,S)=>(p(),b("div",{class:"kv-row",key:`pp-${n.id}-${S}`},[t(_,{value:d.key,"onUpdate:value":$=>d.key=$,placeholder:"id",onChange:v},null,8,["value","onUpdate:value"]),t(_,{value:d.value,"onUpdate:value":$=>d.value=$,placeholder:"123",onChange:v},null,8,["value","onUpdate:value"]),t(s,{size:"small",type:"text",danger:"",onClick:$=>ut(n.pathParams,S)},{default:l(()=>[...e[86]||(e[86]=[r("Remove",-1)])]),_:1},8,["onClick"])]))),128)),t(s,{type:"dashed",size:"small",onClick:d=>st(n.pathParams)},{default:l(()=>[...e[87]||(e[87]=[r(" Add param ",-1)])]),_:1},8,["onClick"])]),t(ee,{orientation:"left"},{default:l(()=>[...e[88]||(e[88]=[r(" Query params ",-1)])]),_:1}),f("div",Ln,[(p(!0),b(E,null,K(n.query,(d,S)=>(p(),b("div",{class:"kv-row",key:`qp-${n.id}-${S}`},[t(_,{value:d.key,"onUpdate:value":$=>d.key=$,placeholder:"q",onChange:v},null,8,["value","onUpdate:value"]),t(_,{value:d.value,"onUpdate:value":$=>d.value=$,placeholder:"vue",onChange:v},null,8,["value","onUpdate:value"]),t(s,{size:"small",type:"text",danger:"",onClick:$=>ut(n.query,S)},{default:l(()=>[...e[89]||(e[89]=[r("Remove",-1)])]),_:1},8,["onClick"])]))),128)),t(s,{type:"dashed",size:"small",onClick:d=>st(n.query)},{default:l(()=>[...e[90]||(e[90]=[r(" Add query param ",-1)])]),_:1},8,["onClick"])]),t(ee,{orientation:"left"},{default:l(()=>[...e[91]||(e[91]=[r(" Headers ",-1)])]),_:1}),f("div",zn,[(p(!0),b(E,null,K(n.headers,(d,S)=>(p(),b("div",{class:"kv-row",key:`hd-${n.id}-${S}`},[t(_,{value:d.key,"onUpdate:value":$=>d.key=$,placeholder:"x-api-key",onChange:v},null,8,["value","onUpdate:value"]),t(_,{value:d.value,"onUpdate:value":$=>d.value=$,placeholder:"secret",onChange:v},null,8,["value","onUpdate:value"]),t(s,{size:"small",type:"text",danger:"",onClick:$=>ut(n.headers,S)},{default:l(()=>[...e[92]||(e[92]=[r("Remove",-1)])]),_:1},8,["onClick"])]))),128)),t(s,{type:"dashed",size:"small",onClick:d=>st(n.headers)},{default:l(()=>[...e[93]||(e[93]=[r(" Add header ",-1)])]),_:1},8,["onClick"])]),t(B,{gutter:12},{default:l(()=>[t(N,{md:8,xs:24},{default:l(()=>[t(g,{label:"Auth"},{default:l(()=>[t(P,{value:n.auth.type,"onUpdate:value":d=>n.auth.type=d,options:[{label:"None",value:"none"},{label:"Bearer",value:"bearer"}],onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),n.auth?.type==="bearer"?(p(),U(N,{key:0,md:16,xs:24},{default:l(()=>[t(g,{label:"Bearer token"},{default:l(()=>[t(_,{value:n.auth.token,"onUpdate:value":d=>n.auth.token=d,placeholder:"eyJhbGci...",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)):I("",!0)]),_:2},1024),t(ee,{orientation:"left"},{default:l(()=>[...e[94]||(e[94]=[r(" Expectations ",-1)])]),_:1}),t(B,{gutter:12},{default:l(()=>[t(N,{md:8,xs:24},{default:l(()=>[t(g,{label:"Mode"},{default:l(()=>[t(P,{options:ba,value:n.expectMode,"onUpdate:value":d=>n.expectMode=d,onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:16,xs:24},{default:l(()=>[t(g,{label:"Contains text (comma separated)"},{default:l(()=>[t(_,{value:n.expectTextLine,"onUpdate:value":d=>n.expectTextLine=d,placeholder:"welcome,success",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(g,{label:"Expected JSON (subset or exact)"},{default:l(()=>[t(oe,{value:n.expectJsonStr,"onUpdate:value":d=>n.expectJsonStr=d,rows:4,placeholder:'{"ok":true}',onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024),t(ee,{orientation:"left"},{default:l(()=>[...e[95]||(e[95]=[r(" Args (docs) ",-1)])]),_:1}),f("div",Dn,[(p(!0),b(E,null,K(n.args,(d,S)=>(p(),b("div",{class:"arg-row",key:`arg-${n.id}-${S}`},[t(_,{value:d.name,"onUpdate:value":$=>d.name=$,placeholder:"userId",onChange:v},null,8,["value","onUpdate:value"]),t(P,{options:[{label:"string",value:"string"},{label:"number",value:"number"},{label:"boolean",value:"boolean"},{label:"json",value:"json"}],value:d.type,"onUpdate:value":$=>d.type=$,onChange:v},null,8,["value","onUpdate:value"]),t(Lt,{checked:d.required,"onUpdate:checked":$=>d.required=$,onChange:v},{default:l(()=>[...e[96]||(e[96]=[r("Required",-1)])]),_:1},8,["checked","onUpdate:checked"]),t(_,{value:d.example,"onUpdate:value":$=>d.example=$,placeholder:"42",onChange:v},null,8,["value","onUpdate:value"]),t(s,{size:"small",type:"text",danger:"",onClick:$=>$a(n,S)},{default:l(()=>[...e[97]||(e[97]=[r("Remove",-1)])]),_:1},8,["onClick"])]))),128)),t(s,{type:"dashed",size:"small",onClick:d=>Ua(n)},{default:l(()=>[...e[98]||(e[98]=[r(" Add arg ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)):I("",!0)]),_:2},1032,["header"]))),128))]),_:1})):(p(),U(he,{key:1,description:"No API tests yet",class:"mt-2"}))]),_:1})):I("",!0),u.value.lab?.kind==="BACKEND_NODE"?(p(),U(z,{key:1,class:"mt-2",title:"Run API tests"})):I("",!0),u.value.lab?.kind==="FRONTEND_NUXT"?(p(),U(z,{key:2,class:"mt-2",title:"UI tests"},{default:l(()=>[t(D,{class:"mb-1",wrap:""},{default:l(()=>[t(s,{size:"small",type:"primary",onClick:Ma},{default:l(()=>[t(x(F)),e[99]||(e[99]=r(" Add UI test",-1))]),_:1})]),_:1}),u.value.lab?.uiTests?.length?(p(),U(Ne,{key:0,accordion:""},{default:l(()=>[(p(!0),b(E,null,K(u.value.lab.uiTests||[],(n,k)=>(p(),U(ne,{key:n.id,header:n.name||`UI Test ${k+1}`},{extra:l(()=>[t(s,{size:"small",danger:"",onClick:ze(d=>Oa(k),["stop"])},{default:l(()=>[...e[100]||(e[100]=[r("Remove",-1)])]),_:1},8,["onClick"])]),default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(B,{gutter:12},{default:l(()=>[t(N,{md:12,xs:24},{default:l(()=>[t(g,{label:"Name"},{default:l(()=>[t(_,{value:n.name,"onUpdate:value":d=>n.name=d,onChange:v,placeholder:"Homepage renders"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:6,xs:12},{default:l(()=>[t(g,{label:"Points"},{default:l(()=>[t(se,{value:n.points,"onUpdate:value":d=>n.points=d,min:0,style:{width:"100%"},onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(N,{md:6,xs:12},{default:l(()=>[t(g,{label:"Path"},{default:l(()=>[t(_,{value:n.path,"onUpdate:value":d=>n.path=d,placeholder:"/",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(g,{label:"Expected text (comma separated)"},{default:l(()=>[t(_,{value:n.expectTextLine,"onUpdate:value":d=>n.expectTextLine=d,placeholder:"Welcome,Sign up",onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header"]))),128))]),_:1})):(p(),U(he,{key:1,description:"No UI tests yet",class:"mt-2"}))]),_:1})):I("",!0)]),_:1}),t(N,{md:10,xs:24},{default:l(()=>[t(z,{title:"VS Code (code-server)"},{default:l(()=>[t(Le,{type:"secondary",style:{"margin-bottom":"8px"}},{default:l(()=>[...e[101]||(e[101]=[r(" Starts a ",-1),f("code",null,"codercom/code-server",-1),r(" container. Default password: ",-1),f("b",null,"teacher",-1),r(". ",-1)])]),_:1}),t(oa,{bordered:"",size:"small",column:"1"},{default:l(()=>[t(Ae,{label:"URL"},{default:l(()=>[r(C(u.value.lab?.codeServer?.url||"—"),1)]),_:1}),t(Ae,{label:"Status"},{default:l(()=>[r(C(u.value.lab?.codeServer?.containerId?"RUNNING":"STOPPED"),1)]),_:1})]),_:1}),t(ee),t(s,{block:"",type:"dashed",disabled:!u.value.lab?.codeServer?.url,onClick:e[32]||(e[32]=n=>a.showCodeDrawer=!0)},{default:l(()=>[...e[102]||(e[102]=[r(" Open embedded VS Code ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})],64)):u.value.type==="quiz"?(p(),b(E,{key:4},[t(ke,{type:"info","show-icon":"",message:"Build questions below. MCQ supports multiple options; mark the correct one(s).",class:"mb-2"}),t(D,{class:"mb-2",wrap:""},{default:l(()=>[t(s,{size:"small",onClick:e[33]||(e[33]=n=>Ct("mcq"))},{default:l(()=>[t(x(F)),e[103]||(e[103]=r(" MCQ",-1))]),_:1}),t(s,{size:"small",onClick:e[34]||(e[34]=n=>Ct("tf"))},{default:l(()=>[t(x(F)),e[104]||(e[104]=r(" True/False",-1))]),_:1}),t(s,{size:"small",onClick:e[35]||(e[35]=n=>Ct("short"))},{default:l(()=>[t(x(F)),e[105]||(e[105]=r(" Short",-1))]),_:1})]),_:1}),t(Ne,{activeKey:pt.value,"onUpdate:activeKey":e[36]||(e[36]=n=>pt.value=n)},{default:l(()=>[(p(!0),b(E,null,K(u.value.quiz?.questions||[],(n,k)=>(p(),U(ne,{key:n.id,header:`Q${k+1}: ${n.text||"(empty)"}`},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(g,{label:"Question text"},{default:l(()=>[t(_,{value:n.text,"onUpdate:value":d=>n.text=d,onChange:v},null,8,["value","onUpdate:value"])]),_:2},1024),t(g,{label:"Type"},{default:l(()=>[t(P,{value:n.type,"onUpdate:value":d=>n.type=d,options:Ja,onChange:d=>hl(n)},null,8,["value","onUpdate:value","onChange"])]),_:2},1024),n.type==="mcq"?(p(),b("div",En,[(p(!0),b(E,null,K(n.options||[],(d,S)=>(p(),b("div",{key:S,class:"option-row"},[t(_,{value:d.text,"onUpdate:value":$=>d.text=$,placeholder:"Option text",class:"opt-input",onChange:v},null,8,["value","onUpdate:value"]),t(Lt,{checked:d.correct,"onUpdate:checked":$=>d.correct=$,onChange:v},{default:l(()=>[...e[106]||(e[106]=[r("Correct",-1)])]),_:1},8,["checked","onUpdate:checked"]),t(s,{size:"small",danger:"",onClick:$=>kl(n,S)},{default:l(()=>[...e[107]||(e[107]=[r("Remove",-1)])]),_:1},8,["onClick"])]))),128)),t(s,{size:"small",class:"mt-1",onClick:d=>bl(n)},{default:l(()=>[t(x(F)),e[108]||(e[108]=r(" Add option",-1))]),_:1},8,["onClick"])])):I("",!0),f("div",Mn,[t(D,null,{default:l(()=>[t(s,{size:"small",onClick:d=>Vt(k,-1),disabled:k===0},{default:l(()=>[...e[109]||(e[109]=[r("↑",-1)])]),_:1},8,["onClick","disabled"]),t(s,{size:"small",onClick:d=>Vt(k,1),disabled:k===u.value.quiz.questions.length-1},{default:l(()=>[...e[110]||(e[110]=[r("↓",-1)])]),_:1},8,["onClick","disabled"]),t(At,{title:"Delete question?","ok-text":"Delete",onConfirm:d=>gl(k)},{default:l(()=>[t(s,{size:"small",danger:""},{default:l(()=>[t(x(Dt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)])]),_:2},1024)]),_:2},1032,["header"]))),128))]),_:1},8,["activeKey"])],64)):I("",!0)]),_:1}),t(N,{md:8,xs:24},{default:l(()=>[t(z,{size:"small",title:"Meta"},{default:l(()=>[t(Y,{layout:"vertical"},{default:l(()=>[t(g,{label:"Duration (min)"},{default:l(()=>[t(se,{style:{width:"100%"},min:0,value:u.value.duration,"onUpdate:value":e[37]||(e[37]=n=>u.value.duration=n),onChange:v},null,8,["value"])]),_:1}),t(g,{label:"Tags (comma separated)"},{default:l(()=>[t(_,{value:qe.value,"onUpdate:value":e[38]||(e[38]=n=>qe.value=n),onChange:il,placeholder:"vue, reactivity"},null,8,["value"])]),_:1}),t(g,null,{default:l(()=>[t(Lt,{checked:u.value.preview,"onUpdate:checked":e[39]||(e[39]=n=>u.value.preview=n),onChange:v},{default:l(()=>[...e[111]||(e[111]=[r("Preview (unlocked)",-1)])]),_:1},8,["checked"])]),_:1}),t(g,{label:"Unlock at (ISO)"},{default:l(()=>[t(_,{value:je.value,"onUpdate:value":e[40]||(e[40]=n=>je.value=n),onChange:dl},null,8,["value"])]),_:1}),t(g,{label:"Prerequisites"},{default:l(()=>[t(P,{mode:"multiple",options:_l.value,value:u.value.prerequisites,"onUpdate:value":e[41]||(e[41]=n=>u.value.prerequisites=n),onChange:v},null,8,["options","value"])]),_:1})]),_:1})]),_:1}),t(z,{size:"small",class:"mt-2",title:"Resources"},{default:l(()=>[t(D,{class:"mb-1",wrap:""},{default:l(()=>[t(_,{value:Fe.value,"onUpdate:value":e[42]||(e[42]=n=>Fe.value=n),placeholder:"Title"},null,8,["value"]),t(_,{value:Ge.value,"onUpdate:value":e[43]||(e[43]=n=>Ge.value=n),placeholder:"URL"},null,8,["value"]),t(s,{onClick:Kt},{default:l(()=>[t(x(F)),e[112]||(e[112]=r(" Add",-1))]),_:1})]),_:1}),t(ce,{"data-source":u.value.resources||[],bordered:""},{renderItem:l(({item:n,index:k})=>[t(be,null,{actions:l(()=>[t(s,{size:"small",danger:"",onClick:d=>Qt(k)},{default:l(()=>[...e[113]||(e[113]=[r("Remove",-1)])]),_:1},8,["onClick"])]),default:l(()=>[t(lt,{title:n.title||n.name||"Resource",description:n.url},null,8,["title","description"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1}),t(z,{size:"small",class:"mt-2",title:"Attachments"},{default:l(()=>[t(D,{class:"mb-1",wrap:""},{default:l(()=>[t(_,{value:Je.value,"onUpdate:value":e[44]||(e[44]=n=>Je.value=n),placeholder:"Name"},null,8,["value"]),t(_,{value:Be.value,"onUpdate:value":e[45]||(e[45]=n=>Be.value=n),placeholder:"URL"},null,8,["value"]),t(s,{onClick:cl},{default:l(()=>[t(x(F)),e[114]||(e[114]=r(" Add",-1))]),_:1})]),_:1}),t(ce,{"data-source":u.value.attachments||[],bordered:""},{renderItem:l(({item:n,index:k})=>[t(be,null,{actions:l(()=>[t(s,{size:"small",danger:"",onClick:d=>vl(k)},{default:l(()=>[...e[115]||(e[115]=[r("Remove",-1)])]),_:1},8,["onClick"])]),default:l(()=>[t(lt,{title:n.name||"Attachment",description:n.url},null,8,["title","description"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])):(p(),U(ke,{key:0,type:"warning",message:"Select or create a lesson from the left outline.","show-icon":""}))]),_:1}),t(te,{key:"preview",tab:"Preview (learner)"},{default:l(()=>[t(z,{title:u.value?.title||"Select a lesson"},{default:l(()=>[u.value?(p(),b(E,{key:0},[f("div",On,[t(o,null,{default:l(()=>[r(C(u.value.type),1)]),_:1}),u.value.preview?(p(),U(o,{key:0,color:"cyan"},{default:l(()=>[...e[116]||(e[116]=[r("Preview",-1)])]),_:1})):I("",!0),f("span",Pn,[t(x(pa)),r(" "+C(u.value.duration||0)+" min",1)])]),u.value.type==="video"?(p(),b("div",Rn,[Et(u.value.videoUrl)?(p(),b("div",qn,[f("iframe",{src:Et(u.value.videoUrl),frameborder:"0",allowfullscreen:""},null,8,jn)])):(p(),b("div",Fn,[t(Le,null,{default:l(()=>[e[117]||(e[117]=r(" Video URL: ",-1)),f("a",{href:u.value.videoUrl,target:"_blank"},C(u.value.videoUrl||"—"),9,Gn)]),_:1})])),t(ee,null,{default:l(()=>[...e[118]||(e[118]=[r("Notes",-1)])]),_:1}),t(Le,{style:{"white-space":"pre-wrap"}},{default:l(()=>[r(C(u.value.content),1)]),_:1})])):u.value.type==="reading"?(p(),b("div",Jn,[t(Le,{style:{"white-space":"pre-wrap"}},{default:l(()=>[r(C(u.value.content||"No content"),1)]),_:1})])):u.value.type==="assignment"?(p(),b("div",Bn,[t(Le,{style:{"white-space":"pre-wrap"}},{default:l(()=>[r(C(u.value.content||"No brief"),1)]),_:1}),u.value.rubric?(p(),U(ke,{key:0,type:"info","show-icon":"",message:"Rubric",description:u.value.rubric,class:"mt-1"},null,8,["description"])):I("",!0)])):u.value.type==="quiz"?(p(),b("div",Kn,[t(ce,{"data-source":u.value.quiz?.questions||[],renderItem:n=>n},{renderItem:l(({item:n,index:k})=>[t(be,null,{default:l(()=>[f("b",null,"Q"+C(k+1),1),r(": "+C(n.text||"(empty)")+" ",1),n.type==="mcq"?(p(),b("div",Qn,[f("ul",Hn,[(p(!0),b(E,null,K(n.options||[],(d,S)=>(p(),b("li",{key:S},[r(C(d.text||`Option ${S+1}`)+" ",1),d.correct?(p(),b("span",Vn,"✔")):I("",!0)]))),128))])])):n.type==="tf"?(p(),b("div",Wn," True/False ")):(p(),b("div",Zn,"Short answer"))]),_:2},1024)]),_:1},8,["data-source","renderItem"])])):I("",!0)],64)):(p(),U(he,{key:1,description:"Pick a lesson"}))]),_:1},8,["title"])]),_:1}),t(te,{key:"university",tab:"University Mode","force-render":""},{default:l(()=>[t(z,{bordered:!1,class:"uni-mode-card",loading:It.value},{title:l(()=>[f("div",Xn,[e[121]||(e[121]=f("span",null,"University Mode",-1)),ta.value?.name?(p(),U(o,{key:0,color:"blue"},{default:l(()=>[r(C(ta.value.name),1)]),_:1})):I("",!0),t(Jl,{placement:"bottom"},{content:l(()=>[...e[119]||(e[119]=[f("div",{style:{"max-width":"320px"}},[f("p",{class:"mb-1"},[f("strong",null,"Cohorts:"),r(" Group students per semester. ")]),f("p",{class:"mb-1"},[f("strong",null,"Assignments:"),r(" Manage tasks and deadlines. ")]),f("p",{class:"mb-1"},[f("strong",null,"Gradebook:"),r(" Export CSV for LMS/SIS. ")]),f("p",{class:"mb-1"},[f("strong",null,"Enrollments:"),r(" Quick roster overview. ")])],-1)])]),default:l(()=>[t(s,{type:"text",size:"small"},{default:l(()=>[...e[120]||(e[120]=[r("What is this?",-1)])]),_:1})]),_:1})])]),default:l(()=>[t(ua,{activeKey:re.value,"onUpdate:activeKey":e[52]||(e[52]=n=>re.value=n),type:"card",destroyInactiveTabPane:""},{default:l(()=>[t(te,{key:"cohorts",tab:"Cohorts"},{default:l(()=>[f("div",Yn,[t(na,{value:Ve.value,"onUpdate:value":e[46]||(e[46]=n=>Ve.value=n),placeholder:"Filter cohorts...",style:{"max-width":"260px"}},null,8,["value"]),t(P,{value:L.value,"onUpdate:value":e[47]||(e[47]=n=>L.value=n),placeholder:"Select cohort",style:{"min-width":"240px"},options:Ze.value,onChange:Pl},null,8,["value","options"]),t(s,{onClick:la,loading:We.value,icon:"↻"},{default:l(()=>[...e[122]||(e[122]=[r("Refresh",-1)])]),_:1},8,["loading"])]),!ie.value.length&&!We.value?(p(),U(he,{key:0,description:"No cohorts for this course yet."})):I("",!0),t(B,{gutter:[16,16]},{default:l(()=>[(p(!0),b(E,null,K(Ol.value,n=>(p(),U(N,{xs:24,md:12,lg:8,key:n.id},{default:l(()=>[t(z,{title:n.name,size:"small",class:"cohort-card"},{extra:l(()=>[t(o,null,{default:l(()=>[r(C(n.startDate?.slice(0,10))+" → "+C(n.endDate?.slice(0,10)),1)]),_:2},1024)]),default:l(()=>[f("p",eo," Size: "+C(n.size??n.studentsCount??"—"),1),f("div",to,[t(s,{size:"small",onClick:k=>{L.value=n.id,re.value="assignments"}},{default:l(()=>[...e[123]||(e[123]=[r("Assignments",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",onClick:k=>{L.value=n.id,re.value="enrollments"}},{default:l(()=>[...e[124]||(e[124]=[r("Roster",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",onClick:k=>{L.value=n.id,re.value="gradebook"}},{default:l(()=>[...e[125]||(e[125]=[r("Gradebook",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["title"])]),_:2},1024))),128))]),_:1})]),_:1}),t(te,{key:"assignments",tab:"Assignments"},{default:l(()=>[f("div",ao,[t(P,{value:L.value,"onUpdate:value":e[48]||(e[48]=n=>L.value=n),placeholder:"Select cohort",style:{"min-width":"240px"},options:Ze.value,onChange:et},null,8,["value","options"]),t(Bl,{value:Ye.value,"onUpdate:value":e[49]||(e[49]=n=>Ye.value=n),placeholder:"Due after"},null,8,["value"]),t(s,{onClick:et,loading:Xe.value,icon:"↻"},{default:l(()=>[...e[126]||(e[126]=[r("Refresh",-1)])]),_:1},8,["loading"])]),ye.value.length?(p(),U(sa,{key:0,"data-source":ye.value,columns:Rl,size:"small","row-key":"id",pagination:{pageSize:10}},null,8,["data-source"])):Xe.value?I("",!0):(p(),U(he,{key:1,description:"No assignments"}))]),_:1}),t(te,{key:"enrollments",tab:"Enrollments"},{default:l(()=>[f("div",lo,[t(P,{value:L.value,"onUpdate:value":e[50]||(e[50]=n=>L.value=n),placeholder:"Select cohort",style:{"min-width":"240px"},options:Ze.value,onChange:at},null,8,["value","options"]),t(s,{onClick:at,loading:tt.value,icon:"↻"},{default:l(()=>[...e[127]||(e[127]=[r("Refresh",-1)])]),_:1},8,["loading"])]),ge.value.length?(p(),U(sa,{key:0,"data-source":ge.value,columns:ql,size:"small","row-key":"id",pagination:{pageSize:10}},null,8,["data-source"])):tt.value?I("",!0):(p(),U(he,{key:1,description:"No enrollments found"}))]),_:1}),t(te,{key:"gradebook",tab:"Gradebook"},{default:l(()=>[f("div",no,[t(P,{value:L.value,"onUpdate:value":e[51]||(e[51]=n=>L.value=n),placeholder:"Select cohort",style:{"min-width":"240px"},options:Ze.value},null,8,["value","options"]),t(s,{type:"primary",onClick:jl,disabled:!L.value,loading:Nt.value},{default:l(()=>[...e[128]||(e[128]=[r("Download CSV",-1)])]),_:1},8,["disabled","loading"]),Tt.value?(p(),b("small",oo,"Last export: "+C(Tt.value),1)):I("",!0)]),t(ke,{type:"info","show-icon":"",message:"Gradebook exports a CSV generated by server GraphQL 'gradebookCsv'."})]),_:1}),t(te,{key:"analytics",tab:"Analytics"},{default:l(()=>[f("div",so,[t(z,{size:"small",title:"Completion Rate"},{default:l(()=>[f("div",uo,C(de.completionRate??0)+"%",1),e[129]||(e[129]=f("div",{class:"dim"},"Across active cohort",-1))]),_:1}),t(z,{size:"small",title:"Average Grade"},{default:l(()=>[f("div",ro,C((de.avgGrade??0).toFixed?de.avgGrade.toFixed(1):de.avgGrade),1),e[130]||(e[130]=f("div",{class:"dim"},"Weighted by submissions",-1))]),_:1}),t(z,{size:"small",title:"Active this week"},{default:l(()=>[f("div",io,C(de.activeThisWeek??0),1),e[131]||(e[131]=f("div",{class:"dim"},"Unique students",-1))]),_:1})])]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["loading"])]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1}),t(Ne,{class:"byway-study-toolkit",accordion:"",style:{"margin-top":"16px"}},{default:l(()=>[t(ne,{key:"notes",header:"📝 Study Notes"},{default:l(()=>[t(oe,{value:O.notes,"onUpdate:value":e[54]||(e[54]=n=>O.notes=n),rows:6,placeholder:"Type notes for this module..."},null,8,["value"]),f("div",co,[t(s,{size:"small",onClick:_t},{default:l(()=>[...e[132]||(e[132]=[r("Save",-1)])]),_:1}),t(Hl,{type:"secondary"},{default:l(()=>[...e[133]||(e[133]=[r("Autosaves every 10s",-1)])]),_:1})])]),_:1}),t(ne,{key:"tasks",header:"✅ Checklist"},{default:l(()=>[f("div",vo,[t(_,{value:He.value,"onUpdate:value":e[55]||(e[55]=n=>He.value=n),placeholder:"Add a task…",style:{"max-width":"340px"},onKeyup:pn(Yt,["enter"])},null,8,["value"]),t(s,{type:"primary",onClick:Yt},{default:l(()=>[...e[134]||(e[134]=[r("Add",-1)])]),_:1})]),t(ce,{"data-source":O.tasks,renderItem:Sl,bordered:""},null,8,["data-source"]),f("div",po,[t(ia,{percent:xl.value,style:{flex:"1"}},null,8,["percent"]),t(s,{size:"small",danger:"",onClick:Il,disabled:!O.tasks.some(n=>n.done)},{default:l(()=>[...e[135]||(e[135]=[r("Clear completed",-1)])]),_:1},8,["disabled"])])]),_:1}),t(ne,{key:"focus",header:"⏱️ Focus Timer (Pomodoro)"},{default:l(()=>[f("div",fo,[t(Vl,{value:Z.value,"onUpdate:value":e[56]||(e[56]=n=>Z.value=n),options:Tl},null,8,["value"]),t(se,{value:Se.value,"onUpdate:value":e[57]||(e[57]=n=>Se.value=n),min:1,max:120,"addon-after":"min"},null,8,["value"]),t(s,{type:"primary",onClick:Nl},{default:l(()=>[...e[136]||(e[136]=[r("Start",-1)])]),_:1}),t(s,{onClick:Al},{default:l(()=>[r(C(me.value?"Pause":"Resume"),1)]),_:1}),t(s,{onClick:Ll},{default:l(()=>[...e[137]||(e[137]=[r("Reset",-1)])]),_:1}),t(Wl,{level:4,style:{margin:"0 0 0 auto"}},{default:l(()=>[r(C(zl.value)+":"+C(Dl.value),1)]),_:1})]),t(ia,{percent:El.value,style:{"margin-top":"8px"}},null,8,["percent"])]),_:1}),t(ne,{key:"resources",header:"🔗 Quick Resources"},{default:l(()=>[f("div",mo,[t(_,{value:ea.value,"onUpdate:value":e[58]||(e[58]=n=>ea.value=n),placeholder:"Label"},null,8,["value"]),t(_,{value:$t.value,"onUpdate:value":e[59]||(e[59]=n=>$t.value=n),placeholder:"https://link",style:{"min-width":"280px"}},null,8,["value"]),t(s,{type:"primary",onClick:Kt,disabled:!$t.value},{default:l(()=>[...e[138]||(e[138]=[r("Add",-1)])]),_:1},8,["disabled"])]),t(ce,{bordered:"","data-source":O.resources},{renderItem:l(({item:n,index:k})=>[t(be,null,{actions:l(()=>[f("a",{onClick:ze(d=>Qt(k),["prevent"])},"remove",8,yo)]),default:l(()=>[t(D,null,{default:l(()=>[t(Zl,{href:n.url,target:"_blank"},{default:l(()=>[r(C(n.label||n.url),1)]),_:2},1032,["href"]),n.url?.startsWith("http")?I("",!0):(p(),U(o,{key:0,color:"warning"},{default:l(()=>[...e[139]||(e[139]=[r("local",-1)])]),_:1}))]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})}}}),Uo=mn(Co,[["__scopeId","data-v-bf560cf6"]]);export{Uo as default};
