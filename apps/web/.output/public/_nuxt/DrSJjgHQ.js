import{g as U,r,k as j,c as _,b as a,w as o,n as c,p as s,o as d,a as u,K as b,d as S,q as A,m as k}from"./DQDUwbr-.js";const M={class:"p-4"},V={key:0,class:"mt-4"},B={class:"mb-2"},D={key:0,class:"mb-2"},E=U({__name:"index",setup(L){const i=r(""),n=r(null),p=r(!1),m=r(!1),h=r([]),x=[{title:"Challenge",dataIndex:["challenge","title"],key:"challenge"},{title:"Status",dataIndex:"status",key:"status"},{title:"Code-Server",key:"codeServer",customRender:({record:t})=>t.codeServerUrl?k("a",{href:t.codeServerUrl,target:"_blank"},"Open"):k("span",{style:"color: #999"},"Not started")},{title:"Last Result",dataIndex:["lastSubmission","status"],key:"lastStatus"},{title:"Grade %",dataIndex:["lastSubmission","gradePct"],key:"gradePct"},{title:"Attempts",dataIndex:"attempts",key:"attempts"},{title:"Started",dataIndex:"createdAt",key:"createdAt"}];async function g(){m.value=!0;try{const t=await fetch("http://localhost:4000/api/teacher-course-lab/sessions/me",{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh5dmN4cjgwMDAwdHcwa3JyODR5eHk4IiwiaWF0IjoxNzYzMTI1NTc1LCJleHAiOjE3NjM3MzAzNzV9.Q7ZrBeM8oZlFUQLKp5YtJsObOQ9AeChhXV3ZXc6797U"}});if(!t.ok)throw new Error(await t.text());const e=await t.json();h.value=(e.sessions||[]).map(l=>{const y=l.submissions&&l.submissions[0]||null;return{...l,lastSubmission:y,attempts:l.submissions?l.submissions.length:0}})}catch(t){console.error(t),c.error(t?.message||"Failed to load sessions")}finally{m.value=!1}}async function C(){if(!i.value)return c.warn("Enter a challenge ID to start");p.value=!0;try{const t=await fetch("http://localhost:4000/api/teacher-course-lab/session/start",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh5dmN4cjgwMDAwdHcwa3JyODR5eHk4IiwiaWF0IjoxNzYzMTI1NTc1LCJleHAiOjE3NjM3MzAzNzV9.Q7ZrBeM8oZlFUQLKp5YtJsObOQ9AeChhXV3ZXc6797U","Content-Type":"application/json"},body:JSON.stringify({challengeId:i.value})}),e=await t.json();if(!t.ok)throw new Error(e?.error||"Failed to start lab session");n.value=e.session,c.success("Lab session started"),await g()}catch(t){console.error(t),c.error(t?.message||"Failed to start lab session")}finally{p.value=!1}}return j(()=>{g()}),(t,e)=>{const l=s("a-page-header"),y=s("a-input"),v=s("a-button"),f=s("a-typography-paragraph"),N=s("a-result"),I=s("a-card"),w=s("a-col"),J=s("a-table"),O=s("a-row");return d(),_("div",M,[a(l,{title:"Student â€¢ Course Labs","sub-title":"Start a lab session, open code-server, and review your progress"}),a(O,{gutter:16},{default:o(()=>[a(w,{xs:24,md:10},{default:o(()=>[a(I,{title:"Start new lab session"},{default:o(()=>[e[5]||(e[5]=u("p",{class:"mb-2 text-sm text-gray-600"}," Paste a challenge ID assigned by your teacher to start a new lab session. ",-1)),a(y,{value:i.value,"onUpdate:value":e[0]||(e[0]=z=>i.value=z),placeholder:"Enter Challenge ID",style:{"max-width":"320px"}},null,8,["value"]),a(v,{loading:p.value,class:"ml-2 mt-2",type:"primary",onClick:C},{default:o(()=>[...e[1]||(e[1]=[S(" Start Session ",-1)])]),_:1},8,["loading"]),n.value?(d(),_("div",V,[a(N,{status:"success",title:"Session started"},{extra:o(()=>[u("div",B,[e[2]||(e[2]=u("strong",null,"Session ID:",-1)),a(f,{style:{display:"inline-block","margin-left":"4px"},copyable:"",content:n.value.id},null,8,["content"])]),n.value.codeServerUrl?(d(),_("div",D,[e[3]||(e[3]=u("strong",null,"Code-Server URL:",-1)),a(f,{style:{display:"inline-block","margin-left":"4px"},copyable:"",content:n.value.codeServerUrl},null,8,["content"])])):b("",!0),n.value.codeServerUrl?(d(),A(v,{key:1,type:"primary",href:n.value.codeServerUrl,target:"_blank"},{default:o(()=>[...e[4]||(e[4]=[S(" Open code-server in new tab ",-1)])]),_:1},8,["href"])):b("",!0)]),_:1})])):b("",!0)]),_:1})]),_:1}),a(w,{xs:24,md:14},{default:o(()=>[a(I,{title:"My lab sessions"},{default:o(()=>[a(J,{columns:x,"data-source":h.value,loading:m.value,size:"small","row-key":"id"},null,8,["data-source","loading"])]),_:1})]),_:1})]),_:1})])}}});export{E as default};
